var Dn=Object.defineProperty;var Ft=e=>{throw TypeError(e)};var Un=(e,t,n)=>t in e?Dn(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var se=(e,t,n)=>Un(e,typeof t!="symbol"?t+"":t,n),Rt=(e,t,n)=>t.has(e)||Ft("Cannot "+n);var I=(e,t,n)=>(Rt(e,t,"read from private field"),n?n.call(e):t.get(e)),Q=(e,t,n)=>t.has(e)?Ft("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,n);var Dt=(e,t,n)=>(Rt(e,t,"access private method"),n);import{b as Re,t as Ve}from"../chunks/J7Q27kaP.js";import{x as kn,z as xn,q as Ut,Y as ot,M as d,_ as N,aM as jt,az as R,aL as Bn,p as he,J as W,t as pe,P as D,ag as Vn,aN as Gn,ah as at,ax as kt,ay as Ae,aj as zn,ai as ut}from"../chunks/Cn4A9jBL.js";import{a as A,p as g}from"../chunks/ExfUo834.js";import{i as rt,m as ae,g as Qt}from"../chunks/bo7kNgaP.js";import{f as Jn}from"../chunks/DiZlyAPf.js";import{i as xt}from"../chunks/Dzwx5xMZ.js";import{s as qn,c as Yn}from"../chunks/B2P-shek.js";import{b as Zn}from"../chunks/x2b1Vvqr.js";import{a as Ge}from"../chunks/kpXueyij.js";function Wn(e,t,n){kn(()=>{var o=xn(()=>t(e,n==null?void 0:n())||{});if(o!=null&&o.destroy)return()=>o.destroy()})}function Hn(e,t,n){var o=e.__className,r=Xn(t,n);Ut&&e.className===r?e.__className=r:(o!==r||Ut&&e.className!==r)&&(t==null&&!n?e.removeAttribute("class"):e.className=r,e.__className=r)}function Xn(e,t){return(e??"")+(" "+t)}function Kn(e,t,n){if(n){if(e.classList.contains(t))return;e.classList.add(t)}else{if(!e.classList.contains(t))return;e.classList.remove(t)}}var jn=["forEach","isDisjointFrom","isSubsetOf","isSupersetOf"],Qn=["difference","intersection","symmetricDifference","union"],Bt=!1,ce,Z,te,xe,$t;const Be=class Be extends Set{constructor(n){super();Q(this,xe);Q(this,ce,new Map);Q(this,Z,ot(0));Q(this,te,ot(0));if(n){for(var o of n)super.add(o);I(this,te).v=super.size}Bt||Dt(this,xe,$t).call(this)}has(n){var o=super.has(n),r=I(this,ce),i=r.get(n);if(i===void 0){if(!o)return d(I(this,Z)),!1;i=ot(!0),r.set(n,i)}return d(i),o}add(n){return super.has(n)||(super.add(n),N(I(this,te),super.size),rt(I(this,Z))),this}delete(n){var o=super.delete(n),r=I(this,ce),i=r.get(n);return i!==void 0&&(r.delete(n),N(i,!1)),o&&(N(I(this,te),super.size),rt(I(this,Z))),o}clear(){if(super.size!==0){super.clear();var n=I(this,ce);for(var o of n.values())N(o,!1);n.clear(),N(I(this,te),0),rt(I(this,Z))}}keys(){return this.values()}values(){return d(I(this,Z)),super.values()}entries(){return d(I(this,Z)),super.entries()}[Symbol.iterator](){return this.keys()}get size(){return d(I(this,te))}};ce=new WeakMap,Z=new WeakMap,te=new WeakMap,xe=new WeakSet,$t=function(){Bt=!0;var n=Be.prototype,o=Set.prototype;for(const r of jn)n[r]=function(...i){return d(I(this,Z)),o[r].apply(this,i)};for(const r of Qn)n[r]=function(...i){d(I(this,Z));var s=o[r].apply(this,i);return new Be(s)}};let lt=Be;var Ee;class $n{constructor(t){Q(this,Ee,R());this.value=t}get value(){return d(I(this,Ee))}set value(t){N(I(this,Ee),A(t))}}Ee=new WeakMap;var Ce,Se,Te,_e;class eo{constructor(){Q(this,Ce,R());Q(this,Se,R(!1));se(this,"loadedImages",new lt);Q(this,Te,R(0));Q(this,_e,R(24));se(this,"layerInfo",new Map);se(this,"eventTracker",new WeakMap);se(this,"eventTopMost");se(this,"markerClickManager",new ro);this.eventTopMost=this._eventTopMost.bind(this)}get map(){return d(I(this,Ce))}set map(t){N(I(this,Ce),A(t))}get loaded(){return d(I(this,Se))}set loaded(t){N(I(this,Se),A(t))}get minzoom(){return d(I(this,Te))}set minzoom(t){N(I(this,Te),A(t))}get maxzoom(){return d(I(this,_e))}set maxzoom(t){N(I(this,_e),A(t))}_eventTopMost(t){var i;let n=this.eventTracker.get(t.originalEvent);if(n!==void 0)return n;let r=(i=t.target.queryRenderedFeatures(t.point).find(s=>{var a;return(a=this.layerInfo.get(s.layer.id))==null?void 0:a.interactive}))==null?void 0:i.layer.id;return this.eventTracker.set(t.originalEvent,r),r}}Ce=new WeakMap,Se=new WeakMap,Te=new WeakMap,_e=new WeakMap;function to(e){jt(no,e)}const en=Symbol.for("svelte-maplibre"),no=Symbol.for("svelte-maplibre.layer-event");function ze(){return Bn(en)}function oo(){return jt(en,new eo)}class ro{constructor(){se(this,"_handlers",new Set)}add(t){this._handlers.add(t)}remove(t){this._handlers.delete(t)}handleClick(t){for(const n of this._handlers)n(t)}}function io(e){return Object.fromEntries(Object.entries(e).filter(([t,n])=>n!=null))}function so(e,t){he(t,!0);const n=D(ze),o=D(()=>d(n).map),r=D(()=>d(n).loaded);let i=g(t,"position",3,"top-left"),s=g(t,"container",3,void 0),a=R(void 0),l=D(()=>typeof s()=="string"?document.querySelector(s())??void 0:s());W(()=>{d(a)||(d(l)?N(a,A(new ae.FullscreenControl({container:d(l)}))):N(a,A(new ae.FullscreenControl)),d(o).addControl(d(a),i()))}),Ge(()=>{d(r)&&d(a)&&d(o).removeControl(d(a))}),pe()}function ao(e,t){he(t,!0);const n=D(ze),o=D(()=>d(n).map),r=D(()=>d(n).loaded);let i=g(t,"position",3,"top-left"),s=g(t,"positionOptions",3,void 0),a=g(t,"fitBoundsOptions",3,void 0),l=g(t,"trackUserLocation",3,!1),c=g(t,"showAccuracyCircle",3,!0),E=g(t,"showUserLocation",3,!0),T=g(t,"control",15);W(()=>{d(o)&&!T()&&(T(new ae.GeolocateControl({positionOptions:s(),fitBoundsOptions:a(),trackUserLocation:l(),showAccuracyCircle:c(),showUserLocation:E()})),d(o).addControl(T(),i()))}),Ge(()=>{d(r)&&T()&&d(o).removeControl(T())}),pe()}function uo(e){let t=e.getCenter(),n=Math.round(e.getZoom()*100)/100,o=Math.ceil((n*Math.LN2+Math.log(512/360/.5))/Math.LN10),r=Math.pow(10,o),i=Math.round(t.lat*r)/r,s=Math.round(t.lng*r)/r,a=`${n}/${i}/${s}`,l=e.getBearing(),c=e.getPitch();return(l||c)&&(a+=`/${Math.round(l*10)/10}`),c&&(a+=`/${Math.round(c)}`),`#${a}`}function lo(e){return e.replace("#","").split("/").map(parseFloat)}var me=mt;function mt(e,t){return e===t||e!==e&&t!==t?!0:typeof e!=typeof t||{}.toString.call(e)!={}.toString.call(t)||e!==Object(e)||!e?!1:Array.isArray(e)?Vt(e,t):{}.toString.call(e)=="[object Set]"?Vt(Array.from(e),Array.from(t)):{}.toString.call(e)=="[object Object]"?fo(e,t):co(e,t)}function co(e,t){return e.toString()===t.toString()}function Vt(e,t){var n=e.length;if(n!=t.length)return!1;for(var o=0;o<n;o++)if(!mt(e[o],t[o]))return!1;return!0}function fo(e,t){var n=Object.keys(e),o=n.length;if(o!=Object.keys(t).length)return!1;for(var r=0;r<o;r++){var i=n[r];if(!(t.hasOwnProperty(i)&&mt(e[i],t[i])))return!1}return!0}const{LngLatBounds:ho,LngLat:po}=ae;function Pe(e,t){return Math.abs(e-t)<1e-6}function go(e,t){let n=ho.convert(e);if(!t)return{equal:!1,bounds:n};let o=n.getNorthEast(),r=t.getNorthEast();if(!Pe(o.lat,r.lat)||!Pe(o.wrap().lng,r.wrap().lng))return{equal:!1,bounds:n};let i=n.getSouthWest(),s=t.getSouthWest();return!Pe(i.lat,s.lat)||!Pe(i.wrap().lng,s.wrap().lng)?{equal:!1,bounds:n}:{equal:!0,bounds:n}}function mo(e,t){const n=e.getSouthWest(),o=e.getNorthEast();if(Array.isArray(t)){if(t.length===4)return[n.lng,n.lat,o.lng,o.lat];if(t.length===2)return t[0]instanceof po?[n,o]:[[n.lng,n.lat],[o.lng,o.lat]]}return e}function yo(e,t){he(t,!0);const n=D(ze),o=D(()=>d(n).map),r=D(()=>d(n).loaded);let i=g(t,"position",3,"top-left"),s=g(t,"showCompass",3,!0),a=g(t,"showZoom",3,!0),l=g(t,"visualizePitch",3,!1),c=R(void 0);W(()=>{d(o)&&!d(c)&&(N(c,A(new ae.NavigationControl({showCompass:s(),showZoom:a(),visualizePitch:l()}))),d(o).addControl(d(c),i()))}),Ge(()=>{d(r)&&d(c)&&d(o).removeControl(d(c))}),pe()}function Eo(e,t){he(t,!0);const n=D(ze),o=D(()=>d(n).map),r=D(()=>d(n).loaded);let i=g(t,"position",3,"bottom-left"),s=g(t,"maxWidth",3,void 0),a=g(t,"unit",3,"metric"),l=R(void 0);W(()=>{d(o)&&!d(l)&&(N(l,A(new ae.ScaleControl({maxWidth:s(),unit:a()}))),d(o).addControl(d(l),i()))}),Ge(()=>{d(r)&&d(l)&&d(o).removeControl(d(l))}),pe()}var Co=Ve("<!> <!> <!> <!>",1),So=Ve("<!> <!>",1),To=Ve('<div data-testid="map-container"><!></div>');function _o(e,t){he(t,!0);let n=g(t,"map",15,void 0),o=g(t,"mapContainer",15,void 0),r=g(t,"class",3,void 0),i=g(t,"diffStyleUpdates",3,!1),s=g(t,"center",15,void 0),a=g(t,"zoom",15,void 0),l=g(t,"pitch",15,0),c=g(t,"bearing",15,0),E=g(t,"bearingSnap",3,7),T=g(t,"bounds",15,void 0),u=g(t,"hash",3,!1),f=g(t,"projection",3,void 0),m=g(t,"updateHash",3,h=>{window.history.replaceState(window.history.state,"",h)}),_=g(t,"loaded",15,!1),G=g(t,"minZoom",3,0),re=g(t,"maxZoom",3,22),le=g(t,"minPitch",3,0),Me=g(t,"maxPitch",3,60),yn=g(t,"renderWorldCopies",3,void 0),En=g(t,"dragPan",3,void 0),Cn=g(t,"dragRotate",3,void 0),Sn=g(t,"pitchWithRotate",3,void 0),Tn=g(t,"antialias",3,void 0),_n=g(t,"zoomOnDoubleClick",3,!0),In=g(t,"locale",3,void 0),vn=g(t,"interactive",3,!0),On=g(t,"attributionControl",3,void 0),Mn=g(t,"cooperativeGestures",3,!1),Ln=g(t,"preserveDrawingBuffer",3,!1),bn=g(t,"maxBounds",3,void 0),je=g(t,"images",19,()=>[]),Qe=g(t,"standardControls",3,!1),Ot=g(t,"filterLayers",3,void 0),Nn=g(t,"transformRequest",3,void 0),Le=D(()=>typeof Qe()=="boolean"?void 0:Qe());const j=oo();to(new $n(void 0));let be=R(A(new Set));async function Mt(h,C=!1){var b;if(n()&&!(!((b=n())!=null&&b.loaded())&&!C))if("url"in h){d(be).add(h.id);try{let w=await n().loadImage(h.url);n().addImage(h.id,w.data,h.options),j.loadedImages.add(h.id)}catch(w){t.onerror?t.onerror({error:w}):console.error(w)}finally{d(be).delete(h.id)}}else n().addImage(h.id,h.data,h.options),j.loadedImages.add(h.id)}W(()=>{var h;if(_()&&((h=n())!=null&&h.loaded()))for(let C of je())!j.loadedImages.has(C.id)&&!d(be).has(C.id)&&!n().hasImage(C.id)&&Mt(C)});let An=D(()=>je().every(h=>j.loadedImages.has(h.id))),$e=R(void 0),et=R(void 0),tt=R(void 0),Ne=R(void 0);function Pn(h){t.onerror?t.onerror(h):h.error.name!=="AbortError"&&console.error(h.error)}function nt(h){return bt(),n(j.map=new ae.Map(io({container:h,style:t.style,locale:In(),center:s(),zoom:a(),pitch:l(),bearing:c(),bearingSnap:E(),minZoom:G(),maxZoom:re(),minPitch:le(),maxPitch:Me(),renderWorldCopies:yn(),dragPan:En(),dragRotate:Cn(),pitchWithRotate:Sn(),antialias:Tn(),interactive:vn(),preserveDrawingBuffer:Ln(),maxBounds:bn(),bounds:T(),attributionControl:On(),transformRequest:Nn(),cooperativeGestures:Mn()}))),n().on("load",C=>{C.target.getContainer().setAttribute("data-testid","map"),C.target.getCanvas().setAttribute("data-testid","map-canvas"),t.onload&&t.onload(n()),j.loaded=!0,_(!0)}),n().on("error",Pn),t.onmovestart&&n().on("movestart",t.onmovestart),n().on("moveend",C=>{var b;if(s(C.target.getCenter()),a(C.target.getZoom()),l(C.target.getPitch()),c(C.target.getBearing()),T(mo(C.target.getBounds(),T())),(b=t.onmoveend)==null||b.call(t,C),u()){let w=new URL(window.location.href.replace(/(#.+)?$/,uo(C.target)));m()(w)}}),t.onclick&&n().on("click",t.onclick),t.ondblclick&&n().on("dblclick",t.ondblclick),t.oncontextmenu&&n().on("contextmenu",t.oncontextmenu),t.onmousemove&&n().on("mousemove",t.onmousemove),t.onzoomstart&&n().on("zoomstart",t.onzoomstart),t.onzoom&&n().on("zoom",t.onzoom),t.onzoomend&&n().on("zoomend",t.onzoomend),t.onpitch&&n().on("pitch",t.onpitch),t.onrotate&&n().on("rotate",t.onrotate),t.onwheel&&n().on("wheel",t.onwheel),t.ondata&&n().on("data",t.ondata),t.onidle&&n().on("idle",t.onidle),n().on("style.load",C=>{var b;if(n()){f()&&n().setProjection(f()),j.loaded=!0,_(!0);const w=n().getStyle();if(N($e,A(w.layers.map(J=>J.id))),N(et,A(Object.keys(w.sources))),d(Ne))for(const[J,ge]of Object.entries(d(Ne)))n().addSource(J,ge);if(d(tt))for(const J of d(tt))n().addLayer(J);for(const J of je())Mt(J,!0);(b=t.onstyleload)==null||b.call(t,C)}}),n().on("styledata",C=>{var b;if(n()&&Ot()){const w=n().getStyle().layers;if(w)for(let J of w)Ot()(J)||n().setLayoutProperty(J.id,"visibility","none")}(b=t.onstyledata)==null||b.call(t,C)}),{destroy(){var C;_(!1),j.loaded=!1,(C=n())==null||C.remove()}}}let Lt=R(A(t.style));W(()=>{if(n()&&!me(t.style,d(Lt))){const h=n().getStyle();if(d($e)&&N(tt,A(h.layers.filter(C=>!d($e).includes(C.id)))),d(et)){const C=Object.keys(h.sources).filter(b=>!d(et).includes(b));N(Ne,A({}));for(const b of C)d(Ne)[b]=h.sources[b]}N(Lt,A(t.style)),n().setStyle(t.style,{diff:i()}),j.loadedImages.clear(),N(be,A(new Set))}}),W(()=>{if(n()){let h={};s()!=null&&!me(s(),n().getCenter())&&(h.center=s()),a()!=null&&!me(a(),n().getZoom())&&(h.zoom=a()),c()!=null&&!me(c(),n().getBearing())&&(h.bearing=c()),l()!=null&&!me(l(),n().getPitch())&&(h.pitch=l()),Object.keys(h).length&&n().easeTo(h)}}),W(()=>{var h;f()&&_()&&((h=n())==null||h.setProjection(f()))}),W(()=>{var h,C;if(T()){const{equal:b,bounds:w}=go(T(),(h=n())==null?void 0:h.getBounds());b||(C=n())==null||C.fitBounds(w)}}),W(()=>{var h,C;_n()?(h=n())==null||h.doubleClickZoom.enable():(C=n())==null||C.doubleClickZoom.disable()});function bt(){if(u()){let h=lo(window.location.hash);h.length>=3&&(a(h[0]),s([h[2],h[1]])),h.length==5&&(c(h[3]),l(h[4]))}}var ie=To();Jn("hashchange",Gn,bt);var wn=at(ie);{var Fn=h=>{var C=So(),b=kt(C);{var w=ge=>{var Nt=Co(),At=kt(Nt);yo(At,{get position(){return d(Le)}});var Pt=Ae(At,2);ao(Pt,{get position(){return d(Le)},fitBoundsOptions:{maxZoom:12}});var wt=Ae(Pt,2);so(wt,{get position(){return d(Le)}});var Rn=Ae(wt,2);Eo(Rn,{get position(){return d(Le)}}),Re(ge,Nt)};xt(b,ge=>{Qe()&&ge(w)})}var J=Ae(b,2);qn(J,()=>t.children??zn,()=>({map:n(),loaded:_(),loadedImages:j.loadedImages,allImagesLoaded:d(An)})),Re(h,C)};xt(wn,h=>{n()&&h(Fn)})}ut(ie),Zn(ie,h=>o(h),()=>o()),Wn(ie,h=>nt==null?void 0:nt(h)),Vn(()=>{Hn(ie,Yn(r()),"svelte-p00lfq"),Kn(ie,"expand-map",!r())}),Re(e,ie),pe()}const ct=function(e,t){const n={drag:[],click:[],mousemove:[],mousedown:[],mouseup:[],mouseout:[],keydown:[],keyup:[],touchstart:[],touchmove:[],touchend:[],tap:[]},o={on(i,s,a){if(n[i]===void 0)throw new Error(`Invalid event type: ${i}`);n[i].push({selector:s,fn:a})},render(i){t.store.featureChanged(i)}},r=function(i,s){const a=n[i];let l=a.length;for(;l--;){const c=a[l];if(c.selector(s)){c.fn.call(o,s)||t.store.render(),t.ui.updateMapClasses();break}}};return e.start.call(o),{render:e.render,stop(){e.stop&&e.stop()},trash(){e.trash&&(e.trash(),t.store.render())},combineFeatures(){e.combineFeatures&&e.combineFeatures()},uncombineFeatures(){e.uncombineFeatures&&e.uncombineFeatures()},drag(i){r("drag",i)},click(i){r("click",i)},mousemove(i){r("mousemove",i)},mousedown(i){r("mousedown",i)},mouseup(i){r("mouseup",i)},mouseout(i){r("mouseout",i)},keydown(i){r("keydown",i)},keyup(i){r("keyup",i)},touchstart(i){r("touchstart",i)},touchmove(i){r("touchmove",i)},touchend(i){r("touchend",i)},tap(i){r("tap",i)}}};var yt={},Je={};Je.RADIUS=6378137;Je.FLATTENING=1/298.257223563;Je.POLAR_RADIUS=63567523142e-4;var Gt=Je;yt.geometry=tn;yt.ring=dt;function tn(e){var t=0,n;switch(e.type){case"Polygon":return zt(e.coordinates);case"MultiPolygon":for(n=0;n<e.coordinates.length;n++)t+=zt(e.coordinates[n]);return t;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0;case"GeometryCollection":for(n=0;n<e.geometries.length;n++)t+=tn(e.geometries[n]);return t}}function zt(e){var t=0;if(e&&e.length>0){t+=Math.abs(dt(e[0]));for(var n=1;n<e.length;n++)t-=Math.abs(dt(e[n]))}return t}function dt(e){var t,n,o,r,i,s,a,l=0,c=e.length;if(c>2){for(a=0;a<c;a++)a===c-2?(r=c-2,i=c-1,s=0):a===c-1?(r=c-1,i=0,s=1):(r=a,i=a+1,s=a+2),t=e[r],n=e[i],o=e[s],l+=(it(o[0])-it(t[0]))*Math.sin(it(n[1]));l=l*Gt.RADIUS*Gt.RADIUS/2}return l}function it(e){return e*Math.PI/180}const B={CANVAS:"mapboxgl-canvas",CONTROL_BASE:"mapboxgl-ctrl",CONTROL_PREFIX:"mapboxgl-ctrl-",CONTROL_BUTTON:"mapbox-gl-draw_ctrl-draw-btn",CONTROL_BUTTON_LINE:"mapbox-gl-draw_line",CONTROL_BUTTON_POLYGON:"mapbox-gl-draw_polygon",CONTROL_BUTTON_POINT:"mapbox-gl-draw_point",CONTROL_BUTTON_TRASH:"mapbox-gl-draw_trash",CONTROL_BUTTON_COMBINE_FEATURES:"mapbox-gl-draw_combine",CONTROL_BUTTON_UNCOMBINE_FEATURES:"mapbox-gl-draw_uncombine",CONTROL_GROUP:"mapboxgl-ctrl-group",ATTRIBUTION:"mapboxgl-ctrl-attrib",ACTIVE_BUTTON:"active",BOX_SELECT:"mapbox-gl-draw_boxselect"},q={HOT:"mapbox-gl-draw-hot",COLD:"mapbox-gl-draw-cold"},L={ADD:"add",MOVE:"move",DRAG:"drag",POINTER:"pointer",NONE:"none"},V={POLYGON:"polygon",LINE:"line_string",POINT:"point"},p={FEATURE:"Feature",POLYGON:"Polygon",LINE_STRING:"LineString",POINT:"Point",FEATURE_COLLECTION:"FeatureCollection",MULTI_PREFIX:"Multi",MULTI_POINT:"MultiPoint",MULTI_LINE_STRING:"MultiLineString",MULTI_POLYGON:"MultiPolygon"},S={DRAW_LINE_STRING:"draw_line_string",DRAW_POLYGON:"draw_polygon",DRAW_POINT:"draw_point",SIMPLE_SELECT:"simple_select",DIRECT_SELECT:"direct_select"},k={CREATE:"draw.create",DELETE:"draw.delete",UPDATE:"draw.update",SELECTION_CHANGE:"draw.selectionchange",MODE_CHANGE:"draw.modechange",ACTIONABLE:"draw.actionable",RENDER:"draw.render",COMBINE_FEATURES:"draw.combine",UNCOMBINE_FEATURES:"draw.uncombine"},Ie={MOVE:"move",CHANGE_PROPERTIES:"change_properties",CHANGE_COORDINATES:"change_coordinates"},F={FEATURE:"feature",MIDPOINT:"midpoint",VERTEX:"vertex"},P={ACTIVE:"true",INACTIVE:"false"},nn=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate"],Io=-90,ft=-85,vo=90,ht=85,Oo=-270,Mo=270,on=Object.freeze(Object.defineProperty({__proto__:null,LAT_MAX:vo,LAT_MIN:Io,LAT_RENDERED_MAX:ht,LAT_RENDERED_MIN:ft,LNG_MAX:Mo,LNG_MIN:Oo,activeStates:P,classes:B,cursors:L,events:k,geojsonTypes:p,interactions:nn,meta:F,modes:S,sources:q,types:V,updateActions:Ie},Symbol.toStringTag,{value:"Module"})),Jt={Point:0,LineString:1,MultiLineString:1,Polygon:2};function Lo(e,t){const n=Jt[e.geometry.type]-Jt[t.geometry.type];return n===0&&e.geometry.type===p.POLYGON?e.area-t.area:n}function rn(e){return e.map(t=>(t.geometry.type===p.POLYGON&&(t.area=yt.geometry({type:p.FEATURE,property:{},geometry:t.geometry})),t)).sort(Lo).map(t=>(delete t.area,t))}function sn(e,t=0){return[[e.point.x-t,e.point.y-t],[e.point.x+t,e.point.y+t]]}function Y(e){if(this._items={},this._nums={},this._length=e?e.length:0,!!e)for(let t=0,n=e.length;t<n;t++)this.add(e[t]),e[t]!==void 0&&(typeof e[t]=="string"?this._items[e[t]]=t:this._nums[e[t]]=t)}Y.prototype.add=function(e){return this.has(e)?this:(this._length++,typeof e=="string"?this._items[e]=this._length:this._nums[e]=this._length,this)};Y.prototype.delete=function(e){return this.has(e)===!1?this:(this._length--,delete this._items[e],delete this._nums[e],this)};Y.prototype.has=function(e){return typeof e!="string"&&typeof e!="number"?!1:this._items[e]!==void 0||this._nums[e]!==void 0};Y.prototype.values=function(){const e=[];return Object.keys(this._items).forEach(t=>{e.push({k:t,v:this._items[t]})}),Object.keys(this._nums).forEach(t=>{e.push({k:JSON.parse(t),v:this._nums[t]})}),e.sort((t,n)=>t.v-n.v).map(t=>t.k)};Y.prototype.clear=function(){return this._length=0,this._items={},this._nums={},this};const bo=[F.FEATURE,F.MIDPOINT,F.VERTEX],de={click:No,touch:Ao};function No(e,t,n){return an(e,t,n,n.options.clickBuffer)}function Ao(e,t,n){return an(e,t,n,n.options.touchBuffer)}function an(e,t,n,o){if(n.map===null)return[];const r=e?sn(e,o):t,i={};n.options.styles&&(i.layers=n.options.styles.map(c=>c.id).filter(c=>n.map.getLayer(c)!=null));const s=n.map.queryRenderedFeatures(r,i).filter(c=>bo.indexOf(c.properties.meta)!==-1),a=new Y,l=[];return s.forEach(c=>{const E=c.properties.id;a.has(E)||(a.add(E),l.push(c))}),rn(l)}function De(e,t){const n=de.click(e,null,t),o={mouse:L.NONE};return n[0]&&(o.mouse=n[0].properties.active===P.ACTIVE?L.MOVE:L.POINTER,o.feature=n[0].properties.meta),t.events.currentModeName().indexOf("draw")!==-1&&(o.mouse=L.ADD),t.ui.queueMapClasses(o),t.ui.updateMapClasses(),n[0]}function Et(e,t){const n=e.x-t.x,o=e.y-t.y;return Math.sqrt(n*n+o*o)}const Po=4,wo=12,Fo=500;function pt(e,t,n={}){const o=n.fineTolerance!=null?n.fineTolerance:Po,r=n.grossTolerance!=null?n.grossTolerance:wo,i=n.interval!=null?n.interval:Fo;e.point=e.point||t.point,e.time=e.time||t.time;const s=Et(e.point,t.point);return s<o||s<r&&t.time-e.time<i}const Ro=25,Do=250;function gt(e,t,n={}){const o=n.tolerance!=null?n.tolerance:Ro,r=n.interval!=null?n.interval:Do;return e.point=e.point||t.point,e.time=e.time||t.time,Et(e.point,t.point)<o&&t.time-e.time<r}let Uo=(e,t=21)=>(n=t)=>{let o="",r=n|0;for(;r--;)o+=e[Math.random()*e.length|0];return o};const ko=Uo("0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",32);function Ct(){return ko()}const x=function(e,t){this.ctx=e,this.properties=t.properties||{},this.coordinates=t.geometry.coordinates,this.id=t.id||Ct(),this.type=t.geometry.type};x.prototype.changed=function(){this.ctx.store.featureChanged(this.id)};x.prototype.incomingCoords=function(e){this.setCoordinates(e)};x.prototype.setCoordinates=function(e){this.coordinates=e,this.changed()};x.prototype.getCoordinates=function(){return JSON.parse(JSON.stringify(this.coordinates))};x.prototype.setProperty=function(e,t){this.properties[e]=t};x.prototype.toGeoJSON=function(){return JSON.parse(JSON.stringify({id:this.id,type:p.FEATURE,properties:this.properties,geometry:{coordinates:this.getCoordinates(),type:this.type}}))};x.prototype.internal=function(e){const t={id:this.id,meta:F.FEATURE,"meta:type":this.type,active:P.INACTIVE,mode:e};if(this.ctx.options.userProperties)for(const n in this.properties)t[`user_${n}`]=this.properties[n];return{type:p.FEATURE,properties:t,geometry:{coordinates:this.getCoordinates(),type:this.type}}};const oe=function(e,t){x.call(this,e,t)};oe.prototype=Object.create(x.prototype);oe.prototype.isValid=function(){return typeof this.coordinates[0]=="number"&&typeof this.coordinates[1]=="number"};oe.prototype.updateCoordinate=function(e,t,n){arguments.length===3?this.coordinates=[t,n]:this.coordinates=[e,t],this.changed()};oe.prototype.getCoordinate=function(){return this.getCoordinates()};const ee=function(e,t){x.call(this,e,t)};ee.prototype=Object.create(x.prototype);ee.prototype.isValid=function(){return this.coordinates.length>1};ee.prototype.addCoordinate=function(e,t,n){this.changed();const o=parseInt(e,10);this.coordinates.splice(o,0,[t,n])};ee.prototype.getCoordinate=function(e){const t=parseInt(e,10);return JSON.parse(JSON.stringify(this.coordinates[t]))};ee.prototype.removeCoordinate=function(e){this.changed(),this.coordinates.splice(parseInt(e,10),1)};ee.prototype.updateCoordinate=function(e,t,n){const o=parseInt(e,10);this.coordinates[o]=[t,n],this.changed()};const z=function(e,t){x.call(this,e,t),this.coordinates=this.coordinates.map(n=>n.slice(0,-1))};z.prototype=Object.create(x.prototype);z.prototype.isValid=function(){return this.coordinates.length===0?!1:this.coordinates.every(e=>e.length>2)};z.prototype.incomingCoords=function(e){this.coordinates=e.map(t=>t.slice(0,-1)),this.changed()};z.prototype.setCoordinates=function(e){this.coordinates=e,this.changed()};z.prototype.addCoordinate=function(e,t,n){this.changed();const o=e.split(".").map(i=>parseInt(i,10));this.coordinates[o[0]].splice(o[1],0,[t,n])};z.prototype.removeCoordinate=function(e){this.changed();const t=e.split(".").map(o=>parseInt(o,10)),n=this.coordinates[t[0]];n&&(n.splice(t[1],1),n.length<3&&this.coordinates.splice(t[0],1))};z.prototype.getCoordinate=function(e){const t=e.split(".").map(o=>parseInt(o,10)),n=this.coordinates[t[0]];return JSON.parse(JSON.stringify(n[t[1]]))};z.prototype.getCoordinates=function(){return this.coordinates.map(e=>e.concat([e[0]]))};z.prototype.updateCoordinate=function(e,t,n){this.changed();const o=e.split("."),r=parseInt(o[0],10),i=parseInt(o[1],10);this.coordinates[r]===void 0&&(this.coordinates[r]=[]),this.coordinates[r][i]=[t,n]};const xo={MultiPoint:oe,MultiLineString:ee,MultiPolygon:z},qe=(e,t,n,o,r)=>{const i=n.split("."),s=parseInt(i[0],10),a=i[1]?i.slice(1).join("."):null;return e[s][t](a,o,r)},U=function(e,t){if(x.call(this,e,t),delete this.coordinates,this.model=xo[t.geometry.type],this.model===void 0)throw new TypeError(`${t.geometry.type} is not a valid type`);this.features=this._coordinatesToFeatures(t.geometry.coordinates)};U.prototype=Object.create(x.prototype);U.prototype._coordinatesToFeatures=function(e){const t=this.model.bind(this);return e.map(n=>new t(this.ctx,{id:Ct(),type:p.FEATURE,properties:{},geometry:{coordinates:n,type:this.type.replace("Multi","")}}))};U.prototype.isValid=function(){return this.features.every(e=>e.isValid())};U.prototype.setCoordinates=function(e){this.features=this._coordinatesToFeatures(e),this.changed()};U.prototype.getCoordinate=function(e){return qe(this.features,"getCoordinate",e)};U.prototype.getCoordinates=function(){return JSON.parse(JSON.stringify(this.features.map(e=>e.type===p.POLYGON?e.getCoordinates():e.coordinates)))};U.prototype.updateCoordinate=function(e,t,n){qe(this.features,"updateCoordinate",e,t,n),this.changed()};U.prototype.addCoordinate=function(e,t,n){qe(this.features,"addCoordinate",e,t,n),this.changed()};U.prototype.removeCoordinate=function(e){qe(this.features,"removeCoordinate",e),this.changed()};U.prototype.getFeatures=function(){return this.features};function y(e){this.map=e.map,this.drawConfig=JSON.parse(JSON.stringify(e.options||{})),this._ctx=e}y.prototype.setSelected=function(e){return this._ctx.store.setSelected(e)};y.prototype.setSelectedCoordinates=function(e){this._ctx.store.setSelectedCoordinates(e),e.reduce((t,n)=>(t[n.feature_id]===void 0&&(t[n.feature_id]=!0,this._ctx.store.get(n.feature_id).changed()),t),{})};y.prototype.getSelected=function(){return this._ctx.store.getSelected()};y.prototype.getSelectedIds=function(){return this._ctx.store.getSelectedIds()};y.prototype.isSelected=function(e){return this._ctx.store.isSelected(e)};y.prototype.getFeature=function(e){return this._ctx.store.get(e)};y.prototype.select=function(e){return this._ctx.store.select(e)};y.prototype.deselect=function(e){return this._ctx.store.deselect(e)};y.prototype.deleteFeature=function(e,t={}){return this._ctx.store.delete(e,t)};y.prototype.addFeature=function(e,t={}){return this._ctx.store.add(e,t)};y.prototype.clearSelectedFeatures=function(){return this._ctx.store.clearSelected()};y.prototype.clearSelectedCoordinates=function(){return this._ctx.store.clearSelectedCoordinates()};y.prototype.setActionableState=function(e={}){const t={trash:e.trash||!1,combineFeatures:e.combineFeatures||!1,uncombineFeatures:e.uncombineFeatures||!1};return this._ctx.events.actionable(t)};y.prototype.changeMode=function(e,t={},n={}){return this._ctx.events.changeMode(e,t,n)};y.prototype.fire=function(e,t){return this._ctx.events.fire(e,t)};y.prototype.updateUIClasses=function(e){return this._ctx.ui.queueMapClasses(e)};y.prototype.activateUIButton=function(e){return this._ctx.ui.setActiveButton(e)};y.prototype.featuresAt=function(e,t,n="click"){if(n!=="click"&&n!=="touch")throw new Error("invalid buffer type");return de[n](e,t,this._ctx)};y.prototype.newFeature=function(e){const t=e.geometry.type;return t===p.POINT?new oe(this._ctx,e):t===p.LINE_STRING?new ee(this._ctx,e):t===p.POLYGON?new z(this._ctx,e):new U(this._ctx,e)};y.prototype.isInstanceOf=function(e,t){if(e===p.POINT)return t instanceof oe;if(e===p.LINE_STRING)return t instanceof ee;if(e===p.POLYGON)return t instanceof z;if(e==="MultiFeature")return t instanceof U;throw new Error(`Unknown feature class: ${e}`)};y.prototype.doRender=function(e){return this._ctx.store.featureChanged(e)};y.prototype.onSetup=function(){};y.prototype.onDrag=function(){};y.prototype.onClick=function(){};y.prototype.onMouseMove=function(){};y.prototype.onMouseDown=function(){};y.prototype.onMouseUp=function(){};y.prototype.onMouseOut=function(){};y.prototype.onKeyUp=function(){};y.prototype.onKeyDown=function(){};y.prototype.onTouchStart=function(){};y.prototype.onTouchMove=function(){};y.prototype.onTouchEnd=function(){};y.prototype.onTap=function(){};y.prototype.onStop=function(){};y.prototype.onTrash=function(){};y.prototype.onCombineFeature=function(){};y.prototype.onUncombineFeature=function(){};y.prototype.toDisplayFeatures=function(){throw new Error("You must overwrite toDisplayFeatures")};const un={drag:"onDrag",click:"onClick",mousemove:"onMouseMove",mousedown:"onMouseDown",mouseup:"onMouseUp",mouseout:"onMouseOut",keyup:"onKeyUp",keydown:"onKeyDown",touchstart:"onTouchStart",touchmove:"onTouchMove",touchend:"onTouchEnd",tap:"onTap"},Bo=Object.keys(un);function Vo(e){const t=Object.keys(e);return function(n,o={}){let r={};const i=t.reduce((a,l)=>(a[l]=e[l],a),new y(n));function s(a){return l=>i[a](r,l)}return{start(){r=i.onSetup(o),Bo.forEach(a=>{const l=un[a];let c=()=>!1;e[l]&&(c=()=>!0),this.on(a,c,s(l))})},stop(){i.onStop(r)},trash(){i.onTrash(r)},combineFeatures(){i.onCombineFeatures(r)},uncombineFeatures(){i.onUncombineFeatures(r)},render(a,l){i.toDisplayFeatures(r,a,l)}}}}function Go(e){const t=Object.keys(e.options.modes).reduce((u,f)=>(u[f]=Vo(e.options.modes[f]),u),{});let n={},o={};const r={};let i=null,s=null;r.drag=function(u,f){f({point:u.point,time:new Date().getTime()})?(e.ui.queueMapClasses({mouse:L.DRAG}),s.drag(u)):u.originalEvent.stopPropagation()},r.mousedrag=function(u){r.drag(u,f=>!pt(n,f))},r.touchdrag=function(u){r.drag(u,f=>!gt(o,f))},r.mousemove=function(u){if((u.originalEvent.buttons!==void 0?u.originalEvent.buttons:u.originalEvent.which)===1)return r.mousedrag(u);const m=De(u,e);u.featureTarget=m,s.mousemove(u)},r.mousedown=function(u){n={time:new Date().getTime(),point:u.point};const f=De(u,e);u.featureTarget=f,s.mousedown(u)},r.mouseup=function(u){const f=De(u,e);u.featureTarget=f,pt(n,{point:u.point,time:new Date().getTime()})?s.click(u):s.mouseup(u)},r.mouseout=function(u){s.mouseout(u)},r.touchstart=function(u){if(!e.options.touchEnabled)return;o={time:new Date().getTime(),point:u.point};const f=de.touch(u,null,e)[0];u.featureTarget=f,s.touchstart(u)},r.touchmove=function(u){if(e.options.touchEnabled)return s.touchmove(u),r.touchdrag(u)},r.touchend=function(u){if(u.originalEvent.preventDefault(),!e.options.touchEnabled)return;const f=de.touch(u,null,e)[0];u.featureTarget=f,gt(o,{time:new Date().getTime(),point:u.point})?s.tap(u):s.touchend(u)};const a=u=>!(u===8||u===46||u>=48&&u<=57);r.keydown=function(u){(u.srcElement||u.target).classList.contains(B.CANVAS)&&((u.keyCode===8||u.keyCode===46)&&e.options.controls.trash?(u.preventDefault(),s.trash()):a(u.keyCode)?s.keydown(u):u.keyCode===49&&e.options.controls.point?l(S.DRAW_POINT):u.keyCode===50&&e.options.controls.line_string?l(S.DRAW_LINE_STRING):u.keyCode===51&&e.options.controls.polygon&&l(S.DRAW_POLYGON))},r.keyup=function(u){a(u.keyCode)&&s.keyup(u)},r.zoomend=function(){e.store.changeZoom()},r.data=function(u){if(u.dataType==="style"){const{setup:f,map:m,options:_,store:G}=e;_.styles.some(le=>m.getLayer(le.id))||(f.addLayers(),G.setDirty(),G.render())}};function l(u,f,m={}){s.stop();const _=t[u];if(_===void 0)throw new Error(`${u} is not valid`);i=u;const G=_(e,f);s=ct(G,e),m.silent||e.map.fire(k.MODE_CHANGE,{mode:u}),e.store.setDirty(),e.store.render()}const c={trash:!1,combineFeatures:!1,uncombineFeatures:!1};function E(u){let f=!1;Object.keys(u).forEach(m=>{if(c[m]===void 0)throw new Error("Invalid action type");c[m]!==u[m]&&(f=!0),c[m]=u[m]}),f&&e.map.fire(k.ACTIONABLE,{actions:c})}return{start(){i=e.options.defaultMode,s=ct(t[i](e),e)},changeMode:l,actionable:E,currentModeName(){return i},currentModeRender(u,f){return s.render(u,f)},fire(u,f){e.map&&e.map.fire(u,f)},addEventListeners(){e.map.on("mousemove",r.mousemove),e.map.on("mousedown",r.mousedown),e.map.on("mouseup",r.mouseup),e.map.on("data",r.data),e.map.on("touchmove",r.touchmove),e.map.on("touchstart",r.touchstart),e.map.on("touchend",r.touchend),e.container.addEventListener("mouseout",r.mouseout),e.options.keybindings&&(e.container.addEventListener("keydown",r.keydown),e.container.addEventListener("keyup",r.keyup))},removeEventListeners(){e.map.off("mousemove",r.mousemove),e.map.off("mousedown",r.mousedown),e.map.off("mouseup",r.mouseup),e.map.off("data",r.data),e.map.off("touchmove",r.touchmove),e.map.off("touchstart",r.touchstart),e.map.off("touchend",r.touchend),e.container.removeEventListener("mouseout",r.mouseout),e.options.keybindings&&(e.container.removeEventListener("keydown",r.keydown),e.container.removeEventListener("keyup",r.keyup))},trash(u){s.trash(u)},combineFeatures(){s.combineFeatures()},uncombineFeatures(){s.uncombineFeatures()},getMode(){return i}}}function ve(e){return[].concat(e).filter(t=>t!==void 0)}function zo(){const e=this;if(!(e.ctx.map&&e.ctx.map.getSource(q.HOT)!==void 0))return l();const n=e.ctx.events.currentModeName();e.ctx.ui.queueMapClasses({mode:n});let o=[],r=[];e.isDirty?r=e.getAllIds():(o=e.getChangedIds().filter(c=>e.get(c)!==void 0),r=e.sources.hot.filter(c=>c.properties.id&&o.indexOf(c.properties.id)===-1&&e.get(c.properties.id)!==void 0).map(c=>c.properties.id)),e.sources.hot=[];const i=e.sources.cold.length;e.sources.cold=e.isDirty?[]:e.sources.cold.filter(c=>{const E=c.properties.id||c.properties.parent;return o.indexOf(E)===-1});const s=i!==e.sources.cold.length||r.length>0;o.forEach(c=>a(c,"hot")),r.forEach(c=>a(c,"cold"));function a(c,E){const u=e.get(c).internal(n);e.ctx.events.currentModeRender(u,f=>{f.properties.mode=n,e.sources[E].push(f)})}s&&e.ctx.map.getSource(q.COLD).setData({type:p.FEATURE_COLLECTION,features:e.sources.cold}),e.ctx.map.getSource(q.HOT).setData({type:p.FEATURE_COLLECTION,features:e.sources.hot}),l();function l(){e.isDirty=!1,e.clearChangedIds()}}function M(e){this._features={},this._featureIds=new Y,this._selectedFeatureIds=new Y,this._selectedCoordinates=[],this._changedFeatureIds=new Y,this._emitSelectionChange=!1,this._mapInitialConfig={},this.ctx=e,this.sources={hot:[],cold:[]};let t;this.render=()=>{t||(t=requestAnimationFrame(()=>{t=null,zo.call(this),this._emitSelectionChange&&(this.ctx.events.fire(k.SELECTION_CHANGE,{features:this.getSelected().map(n=>n.toGeoJSON()),points:this.getSelectedCoordinates().map(n=>({type:p.FEATURE,properties:{},geometry:{type:p.POINT,coordinates:n.coordinates}}))}),this._emitSelectionChange=!1),this.ctx.events.fire(k.RENDER,{})}))},this.isDirty=!1}M.prototype.createRenderBatch=function(){const e=this.render;let t=0;return this.render=function(){t++},()=>{this.render=e,t>0&&this.render()}};M.prototype.setDirty=function(){return this.isDirty=!0,this};M.prototype.featureCreated=function(e,t={}){if(this._changedFeatureIds.add(e),(t.silent!=null?t.silent:this.ctx.options.suppressAPIEvents)!==!0){const o=this.get(e);this.ctx.events.fire(k.CREATE,{features:[o.toGeoJSON()]})}return this};M.prototype.featureChanged=function(e,t={}){return this._changedFeatureIds.add(e),(t.silent!=null?t.silent:this.ctx.options.suppressAPIEvents)!==!0&&this.ctx.events.fire(k.UPDATE,{action:t.action?t.action:Ie.CHANGE_COORDINATES,features:[this.get(e).toGeoJSON()]}),this};M.prototype.getChangedIds=function(){return this._changedFeatureIds.values()};M.prototype.clearChangedIds=function(){return this._changedFeatureIds.clear(),this};M.prototype.getAllIds=function(){return this._featureIds.values()};M.prototype.add=function(e,t={}){return this._features[e.id]=e,this._featureIds.add(e.id),this.featureCreated(e.id,{silent:t.silent}),this};M.prototype.delete=function(e,t={}){const n=[];return ve(e).forEach(o=>{this._featureIds.has(o)&&(this._featureIds.delete(o),this._selectedFeatureIds.delete(o),t.silent||n.indexOf(this._features[o])===-1&&n.push(this._features[o].toGeoJSON()),delete this._features[o],this.isDirty=!0)}),n.length&&this.ctx.events.fire(k.DELETE,{features:n}),ln(this,t),this};M.prototype.get=function(e){return this._features[e]};M.prototype.getAll=function(){return Object.keys(this._features).map(e=>this._features[e])};M.prototype.select=function(e,t={}){return ve(e).forEach(n=>{this._selectedFeatureIds.has(n)||(this._selectedFeatureIds.add(n),this._changedFeatureIds.add(n),t.silent||(this._emitSelectionChange=!0))}),this};M.prototype.deselect=function(e,t={}){return ve(e).forEach(n=>{this._selectedFeatureIds.has(n)&&(this._selectedFeatureIds.delete(n),this._changedFeatureIds.add(n),t.silent||(this._emitSelectionChange=!0))}),ln(this,t),this};M.prototype.clearSelected=function(e={}){return this.deselect(this._selectedFeatureIds.values(),{silent:e.silent}),this};M.prototype.setSelected=function(e,t={}){return e=ve(e),this.deselect(this._selectedFeatureIds.values().filter(n=>e.indexOf(n)===-1),{silent:t.silent}),this.select(e.filter(n=>!this._selectedFeatureIds.has(n)),{silent:t.silent}),this};M.prototype.setSelectedCoordinates=function(e){return this._selectedCoordinates=e,this._emitSelectionChange=!0,this};M.prototype.clearSelectedCoordinates=function(){return this._selectedCoordinates=[],this._emitSelectionChange=!0,this};M.prototype.getSelectedIds=function(){return this._selectedFeatureIds.values()};M.prototype.getSelected=function(){return this.getSelectedIds().map(e=>this.get(e))};M.prototype.getSelectedCoordinates=function(){return this._selectedCoordinates.map(t=>({coordinates:this.get(t.feature_id).getCoordinate(t.coord_path)}))};M.prototype.isSelected=function(e){return this._selectedFeatureIds.has(e)};M.prototype.setFeatureProperty=function(e,t,n,o={}){this.get(e).setProperty(t,n),this.featureChanged(e,{silent:o.silent,action:Ie.CHANGE_PROPERTIES})};function ln(e,t={}){const n=e._selectedCoordinates.filter(o=>e._selectedFeatureIds.has(o.feature_id));e._selectedCoordinates.length!==n.length&&!t.silent&&(e._emitSelectionChange=!0),e._selectedCoordinates=n}M.prototype.storeMapConfig=function(){nn.forEach(e=>{this.ctx.map[e]&&(this._mapInitialConfig[e]=this.ctx.map[e].isEnabled())})};M.prototype.restoreMapConfig=function(){Object.keys(this._mapInitialConfig).forEach(e=>{this._mapInitialConfig[e]?this.ctx.map[e].enable():this.ctx.map[e].disable()})};M.prototype.getInitialConfigValue=function(e){return this._mapInitialConfig[e]!==void 0?this._mapInitialConfig[e]:!0};const Jo=["mode","feature","mouse"];function qo(e){const t={};let n=null,o={mode:null,feature:null,mouse:null},r={mode:null,feature:null,mouse:null};function i(){s({mode:null,feature:null,mouse:null}),a()}function s(f){r=Object.assign(r,f)}function a(){if(!e.container)return;const f=[],m=[];Jo.forEach(_=>{r[_]!==o[_]&&(f.push(`${_}-${o[_]}`),r[_]!==null&&m.push(`${_}-${r[_]}`))}),f.length>0&&e.container.classList.remove(...f),m.length>0&&e.container.classList.add(...m),o=Object.assign(o,r)}function l(f,m={}){const _=document.createElement("button");return _.className=`${B.CONTROL_BUTTON} ${m.className}`,_.setAttribute("title",m.title),m.container.appendChild(_),_.addEventListener("click",G=>{if(G.preventDefault(),G.stopPropagation(),G.target===n){c(),m.onDeactivate();return}E(f),m.onActivate()},!0),_}function c(){n&&(n.classList.remove(B.ACTIVE_BUTTON),n=null)}function E(f){c();const m=t[f];m&&m&&f!=="trash"&&(m.classList.add(B.ACTIVE_BUTTON),n=m)}function T(){const f=e.options.controls,m=document.createElement("div");return m.className=`${B.CONTROL_GROUP} ${B.CONTROL_BASE}`,f&&(f[V.LINE]&&(t[V.LINE]=l(V.LINE,{container:m,className:B.CONTROL_BUTTON_LINE,title:`LineString tool ${e.options.keybindings?"(l)":""}`,onActivate:()=>e.events.changeMode(S.DRAW_LINE_STRING),onDeactivate:()=>e.events.trash()})),f[V.POLYGON]&&(t[V.POLYGON]=l(V.POLYGON,{container:m,className:B.CONTROL_BUTTON_POLYGON,title:`Polygon tool ${e.options.keybindings?"(p)":""}`,onActivate:()=>e.events.changeMode(S.DRAW_POLYGON),onDeactivate:()=>e.events.trash()})),f[V.POINT]&&(t[V.POINT]=l(V.POINT,{container:m,className:B.CONTROL_BUTTON_POINT,title:`Marker tool ${e.options.keybindings?"(m)":""}`,onActivate:()=>e.events.changeMode(S.DRAW_POINT),onDeactivate:()=>e.events.trash()})),f.trash&&(t.trash=l("trash",{container:m,className:B.CONTROL_BUTTON_TRASH,title:"Delete",onActivate:()=>{e.events.trash()}})),f.combine_features&&(t.combine_features=l("combineFeatures",{container:m,className:B.CONTROL_BUTTON_COMBINE_FEATURES,title:"Combine",onActivate:()=>{e.events.combineFeatures()}})),f.uncombine_features&&(t.uncombine_features=l("uncombineFeatures",{container:m,className:B.CONTROL_BUTTON_UNCOMBINE_FEATURES,title:"Uncombine",onActivate:()=>{e.events.uncombineFeatures()}}))),m}function u(){Object.keys(t).forEach(f=>{const m=t[f];m.parentNode&&m.parentNode.removeChild(m),delete t[f]})}return{setActiveButton:E,queueMapClasses:s,updateMapClasses:a,clearMapClasses:i,addButtons:T,removeButtons:u}}function Yo(e){let t=null,n=null;const o={onRemove(){return e.map.off("load",o.connect),clearInterval(n),o.removeLayers(),e.store.restoreMapConfig(),e.ui.removeButtons(),e.events.removeEventListeners(),e.ui.clearMapClasses(),e.boxZoomInitial&&e.map.boxZoom.enable(),e.map=null,e.container=null,e.store=null,t&&t.parentNode&&t.parentNode.removeChild(t),t=null,this},connect(){e.map.off("load",o.connect),clearInterval(n),o.addLayers(),e.store.storeMapConfig(),e.events.addEventListeners()},onAdd(r){if(e.map=r,e.events=Go(e),e.ui=qo(e),e.container=r.getContainer(),e.store=new M(e),t=e.ui.addButtons(),e.options.boxSelect){e.boxZoomInitial=r.boxZoom.isEnabled(),r.boxZoom.disable();const i=r.dragPan.isEnabled();r.dragPan.disable(),r.dragPan.enable(),i||r.dragPan.disable()}return r.loaded()?o.connect():(r.on("load",o.connect),n=setInterval(()=>{r.loaded()&&o.connect()},16)),e.events.start(),t},addLayers(){e.map.addSource(q.COLD,{data:{type:p.FEATURE_COLLECTION,features:[]},type:"geojson"}),e.map.addSource(q.HOT,{data:{type:p.FEATURE_COLLECTION,features:[]},type:"geojson"}),e.options.styles.forEach(r=>{e.map.addLayer(r)}),e.store.setDirty(!0),e.store.render()},removeLayers(){e.options.styles.forEach(r=>{e.map.getLayer(r.id)&&e.map.removeLayer(r.id)}),e.map.getSource(q.COLD)&&e.map.removeSource(q.COLD),e.map.getSource(q.HOT)&&e.map.removeSource(q.HOT)}};return e.setup=o,o}const st="#3bb2d0",ye="#fbb03b",qt="#fff",cn=[{id:"gl-draw-polygon-fill",type:"fill",filter:["all",["==","$type","Polygon"]],paint:{"fill-color":["case",["==",["get","active"],"true"],ye,st],"fill-opacity":.1}},{id:"gl-draw-lines",type:"line",filter:["any",["==","$type","LineString"],["==","$type","Polygon"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":["case",["==",["get","active"],"true"],ye,st],"line-dasharray":["case",["==",["get","active"],"true"],[.2,2],[2,0]],"line-width":2}},{id:"gl-draw-point-outer",type:"circle",filter:["all",["==","$type","Point"],["==","meta","feature"]],paint:{"circle-radius":["case",["==",["get","active"],"true"],7,5],"circle-color":qt}},{id:"gl-draw-point-inner",type:"circle",filter:["all",["==","$type","Point"],["==","meta","feature"]],paint:{"circle-radius":["case",["==",["get","active"],"true"],5,3],"circle-color":["case",["==",["get","active"],"true"],ye,st]}},{id:"gl-draw-vertex-outer",type:"circle",filter:["all",["==","$type","Point"],["==","meta","vertex"],["!=","mode","simple_select"]],paint:{"circle-radius":["case",["==",["get","active"],"true"],7,5],"circle-color":qt}},{id:"gl-draw-vertex-inner",type:"circle",filter:["all",["==","$type","Point"],["==","meta","vertex"],["!=","mode","simple_select"]],paint:{"circle-radius":["case",["==",["get","active"],"true"],5,3],"circle-color":ye}},{id:"gl-draw-midpoint",type:"circle",filter:["all",["==","meta","midpoint"]],paint:{"circle-radius":3,"circle-color":ye}}];function Ye(e){return function(t){const n=t.featureTarget;return!n||!n.properties?!1:n.properties.meta===e}}function dn(e){return!e.originalEvent||!e.originalEvent.shiftKey?!1:e.originalEvent.button===0}function ue(e){return!e.featureTarget||!e.featureTarget.properties?!1:e.featureTarget.properties.active===P.ACTIVE&&e.featureTarget.properties.meta===F.FEATURE}function St(e){return!e.featureTarget||!e.featureTarget.properties?!1:e.featureTarget.properties.active===P.INACTIVE&&e.featureTarget.properties.meta===F.FEATURE}function Ze(e){return e.featureTarget===void 0}function Tt(e){return!e.featureTarget||!e.featureTarget.properties?!1:e.featureTarget.properties.meta===F.FEATURE}function Oe(e){const t=e.featureTarget;return!t||!t.properties?!1:t.properties.meta===F.VERTEX}function Ue(e){return e.originalEvent?e.originalEvent.shiftKey===!0:!1}function We(e){return e.keyCode===27}function He(e){return e.keyCode===13}function Zo(){return!0}const Wo=Object.freeze(Object.defineProperty({__proto__:null,isActiveFeature:ue,isEnterKey:He,isEscapeKey:We,isFeature:Tt,isInactiveFeature:St,isOfMetaType:Ye,isShiftDown:Ue,isShiftMousedown:dn,isTrue:Zo,isVertex:Oe,noTarget:Ze},Symbol.toStringTag,{value:"Module"}));function ne(e,t){this.x=e,this.y=t}ne.prototype={clone(){return new ne(this.x,this.y)},add(e){return this.clone()._add(e)},sub(e){return this.clone()._sub(e)},multByPoint(e){return this.clone()._multByPoint(e)},divByPoint(e){return this.clone()._divByPoint(e)},mult(e){return this.clone()._mult(e)},div(e){return this.clone()._div(e)},rotate(e){return this.clone()._rotate(e)},rotateAround(e,t){return this.clone()._rotateAround(e,t)},matMult(e){return this.clone()._matMult(e)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(e){return this.x===e.x&&this.y===e.y},dist(e){return Math.sqrt(this.distSqr(e))},distSqr(e){const t=e.x-this.x,n=e.y-this.y;return t*t+n*n},angle(){return Math.atan2(this.y,this.x)},angleTo(e){return Math.atan2(this.y-e.y,this.x-e.x)},angleWith(e){return this.angleWithSep(e.x,e.y)},angleWithSep(e,t){return Math.atan2(this.x*t-this.y*e,this.x*e+this.y*t)},_matMult(e){const t=e[0]*this.x+e[1]*this.y,n=e[2]*this.x+e[3]*this.y;return this.x=t,this.y=n,this},_add(e){return this.x+=e.x,this.y+=e.y,this},_sub(e){return this.x-=e.x,this.y-=e.y,this},_mult(e){return this.x*=e,this.y*=e,this},_div(e){return this.x/=e,this.y/=e,this},_multByPoint(e){return this.x*=e.x,this.y*=e.y,this},_divByPoint(e){return this.x/=e.x,this.y/=e.y,this},_unit(){return this._div(this.mag()),this},_perp(){const e=this.y;return this.y=this.x,this.x=-e,this},_rotate(e){const t=Math.cos(e),n=Math.sin(e),o=t*this.x-n*this.y,r=n*this.x+t*this.y;return this.x=o,this.y=r,this},_rotateAround(e,t){const n=Math.cos(e),o=Math.sin(e),r=t.x+n*(this.x-t.x)-o*(this.y-t.y),i=t.y+o*(this.x-t.x)+n*(this.y-t.y);return this.x=r,this.y=i,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:ne};ne.convert=function(e){if(e instanceof ne)return e;if(Array.isArray(e))return new ne(+e[0],+e[1]);if(e.x!==void 0&&e.y!==void 0)return new ne(+e.x,+e.y);throw new Error("Expected [x, y] or {x, y} point format")};function _t(e,t){const n=t.getBoundingClientRect();return new ne(e.clientX-n.left-(t.clientLeft||0),e.clientY-n.top-(t.clientTop||0))}function fe(e,t,n,o){return{type:p.FEATURE,properties:{meta:F.VERTEX,parent:e,coord_path:n,active:o?P.ACTIVE:P.INACTIVE},geometry:{type:p.POINT,coordinates:t}}}function fn(e,t,n){const o=t.geometry.coordinates,r=n.geometry.coordinates;if(o[1]>ht||o[1]<ft||r[1]>ht||r[1]<ft)return null;const i={lng:(o[0]+r[0])/2,lat:(o[1]+r[1])/2};return{type:p.FEATURE,properties:{meta:F.MIDPOINT,parent:e,lng:i.lng,lat:i.lat,coord_path:n.properties.coord_path},geometry:{type:p.POINT,coordinates:[i.lng,i.lat]}}}function Xe(e,t={},n=null){const{type:o,coordinates:r}=e.geometry,i=e.properties&&e.properties.id;let s=[];o===p.POINT?s.push(fe(i,r,n,l(n))):o===p.POLYGON?r.forEach((E,T)=>{a(E,n!==null?`${n}.${T}`:String(T))}):o===p.LINE_STRING?a(r,n):o.indexOf(p.MULTI_PREFIX)===0&&c();function a(E,T){let u="",f=null;E.forEach((m,_)=>{const G=T!=null?`${T}.${_}`:String(_),re=fe(i,m,G,l(G));if(t.midpoints&&f){const Me=fn(i,f,re);Me&&s.push(Me)}f=re;const le=JSON.stringify(m);u!==le&&s.push(re),_===0&&(u=le)})}function l(E){return t.selectedPaths?t.selectedPaths.indexOf(E)!==-1:!1}function c(){const E=o.replace(p.MULTI_PREFIX,"");r.forEach((T,u)=>{const f={type:p.FEATURE,properties:e.properties,geometry:{type:E,coordinates:T}};s=s.concat(Xe(f,t,u))})}return s}const H={enable(e){setTimeout(()=>{!e.map||!e.map.doubleClickZoom||!e._ctx||!e._ctx.store||!e._ctx.store.getInitialConfigValue||e._ctx.store.getInitialConfigValue("doubleClickZoom")&&e.map.doubleClickZoom.enable()},0)},disable(e){setTimeout(()=>{!e.map||!e.map.doubleClickZoom||e.map.doubleClickZoom.disable()},0)}},{LAT_MIN:we,LAT_MAX:Fe,LAT_RENDERED_MIN:Yt,LAT_RENDERED_MAX:Zt,LNG_MIN:Wt,LNG_MAX:Ht}=on;function Ho(e){const t={Point:0,LineString:1,Polygon:2,MultiPoint:1,MultiLineString:2,MultiPolygon:3}[e.geometry.type],n=[e.geometry.coordinates].flat(t),o=n.map(a=>a[0]),r=n.map(a=>a[1]),i=a=>Math.min.apply(null,a),s=a=>Math.max.apply(null,a);return[i(o),i(r),s(o),s(r)]}function It(e,t){let n=we,o=Fe,r=we,i=Fe,s=Ht,a=Wt;e.forEach(c=>{const E=Ho(c),T=E[1],u=E[3],f=E[0],m=E[2];T>n&&(n=T),u<o&&(o=u),u>r&&(r=u),T<i&&(i=T),f<s&&(s=f),m>a&&(a=m)});const l=t;return n+l.lat>Zt&&(l.lat=Zt-n),r+l.lat>Fe&&(l.lat=Fe-r),o+l.lat<Yt&&(l.lat=Yt-o),i+l.lat<we&&(l.lat=we-i),s+l.lng<=Wt&&(l.lng+=Math.ceil(Math.abs(l.lng)/360)*360),a+l.lng>=Ht&&(l.lng-=Math.ceil(Math.abs(l.lng)/360)*360),l}function vt(e,t){const n=It(e.map(o=>o.toGeoJSON()),t);e.forEach(o=>{const r=o.getCoordinates(),i=c=>{const E={lng:c[0]+n.lng,lat:c[1]+n.lat};return[E.lng,E.lat]},s=c=>c.map(E=>i(E)),a=c=>c.map(E=>s(E));let l;o.type===p.POINT?l=i(r):o.type===p.LINE_STRING||o.type===p.MULTI_POINT?l=r.map(i):o.type===p.POLYGON||o.type===p.MULTI_LINE_STRING?l=r.map(s):o.type===p.MULTI_POLYGON&&(l=r.map(a)),o.incomingCoords(l)})}const v={};v.onSetup=function(e){const t={dragMoveLocation:null,boxSelectStartLocation:null,boxSelectElement:void 0,boxSelecting:!1,canBoxSelect:!1,dragMoving:!1,canDragMove:!1,initialDragPanState:this.map.dragPan.isEnabled(),initiallySelectedFeatureIds:e.featureIds||[]};return this.setSelected(t.initiallySelectedFeatureIds.filter(n=>this.getFeature(n)!==void 0)),this.fireActionable(),this.setActionableState({combineFeatures:!0,uncombineFeatures:!0,trash:!0}),t};v.fireUpdate=function(){this.fire(k.UPDATE,{action:Ie.MOVE,features:this.getSelected().map(e=>e.toGeoJSON())})};v.fireActionable=function(){const e=this.getSelected(),t=e.filter(i=>this.isInstanceOf("MultiFeature",i));let n=!1;if(e.length>1){n=!0;const i=e[0].type.replace("Multi","");e.forEach(s=>{s.type.replace("Multi","")!==i&&(n=!1)})}const o=t.length>0,r=e.length>0;this.setActionableState({combineFeatures:n,uncombineFeatures:o,trash:r})};v.getUniqueIds=function(e){return e.length?e.map(n=>n.properties.id).filter(n=>n!==void 0).reduce((n,o)=>(n.add(o),n),new Y).values():[]};v.stopExtendedInteractions=function(e){e.boxSelectElement&&(e.boxSelectElement.parentNode&&e.boxSelectElement.parentNode.removeChild(e.boxSelectElement),e.boxSelectElement=null),(e.canDragMove||e.canBoxSelect)&&e.initialDragPanState===!0&&this.map.dragPan.enable(),e.boxSelecting=!1,e.canBoxSelect=!1,e.dragMoving=!1,e.canDragMove=!1};v.onStop=function(){H.enable(this)};v.onMouseMove=function(e,t){return Tt(t)&&e.dragMoving&&this.fireUpdate(),this.stopExtendedInteractions(e),!0};v.onMouseOut=function(e){return e.dragMoving?this.fireUpdate():!0};v.onTap=v.onClick=function(e,t){if(Ze(t))return this.clickAnywhere(e,t);if(Ye(F.VERTEX)(t))return this.clickOnVertex(e,t);if(Tt(t))return this.clickOnFeature(e,t)};v.clickAnywhere=function(e){const t=this.getSelectedIds();t.length&&(this.clearSelectedFeatures(),t.forEach(n=>this.doRender(n))),H.enable(this),this.stopExtendedInteractions(e)};v.clickOnVertex=function(e,t){this.changeMode(S.DIRECT_SELECT,{featureId:t.featureTarget.properties.parent,coordPath:t.featureTarget.properties.coord_path,startPos:t.lngLat}),this.updateUIClasses({mouse:L.MOVE})};v.startOnActiveFeature=function(e,t){this.stopExtendedInteractions(e),this.map.dragPan.disable(),this.doRender(t.featureTarget.properties.id),e.canDragMove=!0,e.dragMoveLocation=t.lngLat};v.clickOnFeature=function(e,t){H.disable(this),this.stopExtendedInteractions(e);const n=Ue(t),o=this.getSelectedIds(),r=t.featureTarget.properties.id,i=this.isSelected(r);if(!n&&i&&this.getFeature(r).type!==p.POINT)return this.changeMode(S.DIRECT_SELECT,{featureId:r});i&&n?(this.deselect(r),this.updateUIClasses({mouse:L.POINTER}),o.length===1&&H.enable(this)):!i&&n?(this.select(r),this.updateUIClasses({mouse:L.MOVE})):!i&&!n&&(o.forEach(s=>this.doRender(s)),this.setSelected(r),this.updateUIClasses({mouse:L.MOVE})),this.doRender(r)};v.onMouseDown=function(e,t){if(e.initialDragPanState=this.map.dragPan.isEnabled(),ue(t))return this.startOnActiveFeature(e,t);if(this.drawConfig.boxSelect&&dn(t))return this.startBoxSelect(e,t)};v.startBoxSelect=function(e,t){this.stopExtendedInteractions(e),this.map.dragPan.disable(),e.boxSelectStartLocation=_t(t.originalEvent,this.map.getContainer()),e.canBoxSelect=!0};v.onTouchStart=function(e,t){if(ue(t))return this.startOnActiveFeature(e,t)};v.onDrag=function(e,t){if(e.canDragMove)return this.dragMove(e,t);if(this.drawConfig.boxSelect&&e.canBoxSelect)return this.whileBoxSelect(e,t)};v.whileBoxSelect=function(e,t){e.boxSelecting=!0,this.updateUIClasses({mouse:L.ADD}),e.boxSelectElement||(e.boxSelectElement=document.createElement("div"),e.boxSelectElement.classList.add(B.BOX_SELECT),this.map.getContainer().appendChild(e.boxSelectElement));const n=_t(t.originalEvent,this.map.getContainer()),o=Math.min(e.boxSelectStartLocation.x,n.x),r=Math.max(e.boxSelectStartLocation.x,n.x),i=Math.min(e.boxSelectStartLocation.y,n.y),s=Math.max(e.boxSelectStartLocation.y,n.y),a=`translate(${o}px, ${i}px)`;e.boxSelectElement.style.transform=a,e.boxSelectElement.style.WebkitTransform=a,e.boxSelectElement.style.width=`${r-o}px`,e.boxSelectElement.style.height=`${s-i}px`};v.dragMove=function(e,t){e.dragMoving=!0,t.originalEvent.stopPropagation();const n={lng:t.lngLat.lng-e.dragMoveLocation.lng,lat:t.lngLat.lat-e.dragMoveLocation.lat};vt(this.getSelected(),n),e.dragMoveLocation=t.lngLat};v.onTouchEnd=v.onMouseUp=function(e,t){if(e.dragMoving)this.fireUpdate();else if(e.boxSelecting){const n=[e.boxSelectStartLocation,_t(t.originalEvent,this.map.getContainer())],o=this.featuresAt(null,n,"click"),r=this.getUniqueIds(o).filter(i=>!this.isSelected(i));r.length&&(this.select(r),r.forEach(i=>this.doRender(i)),this.updateUIClasses({mouse:L.MOVE}))}this.stopExtendedInteractions(e)};v.toDisplayFeatures=function(e,t,n){t.properties.active=this.isSelected(t.properties.id)?P.ACTIVE:P.INACTIVE,n(t),this.fireActionable(),!(t.properties.active!==P.ACTIVE||t.geometry.type===p.POINT)&&Xe(t).forEach(n)};v.onTrash=function(){this.deleteFeature(this.getSelectedIds()),this.fireActionable()};v.onCombineFeatures=function(){const e=this.getSelected();if(e.length===0||e.length<2)return;const t=[],n=[],o=e[0].type.replace("Multi","");for(let r=0;r<e.length;r++){const i=e[r];if(i.type.replace("Multi","")!==o)return;i.type.includes("Multi")?i.getCoordinates().forEach(s=>{t.push(s)}):t.push(i.getCoordinates()),n.push(i.toGeoJSON())}if(n.length>1){const r=this.newFeature({type:p.FEATURE,properties:n[0].properties,geometry:{type:`Multi${o}`,coordinates:t}});this.addFeature(r),this.deleteFeature(this.getSelectedIds(),{silent:!0}),this.setSelected([r.id]),this.fire(k.COMBINE_FEATURES,{createdFeatures:[r.toGeoJSON()],deletedFeatures:n})}this.fireActionable()};v.onUncombineFeatures=function(){const e=this.getSelected();if(e.length===0)return;const t=[],n=[];for(let o=0;o<e.length;o++){const r=e[o];this.isInstanceOf("MultiFeature",r)&&(r.getFeatures().forEach(i=>{this.addFeature(i),i.properties=r.properties,t.push(i.toGeoJSON()),this.select([i.id])}),this.deleteFeature(r.id,{silent:!0}),n.push(r.toGeoJSON()))}t.length>1&&this.fire(k.UNCOMBINE_FEATURES,{createdFeatures:t,deletedFeatures:n}),this.fireActionable()};const hn=Ye(F.VERTEX),pn=Ye(F.MIDPOINT),O={};O.fireUpdate=function(){this.fire(k.UPDATE,{action:Ie.CHANGE_COORDINATES,features:this.getSelected().map(e=>e.toGeoJSON())})};O.fireActionable=function(e){this.setActionableState({combineFeatures:!1,uncombineFeatures:!1,trash:e.selectedCoordPaths.length>0})};O.startDragging=function(e,t){e.initialDragPanState=this.map.dragPan.isEnabled(),this.map.dragPan.disable(),e.canDragMove=!0,e.dragMoveLocation=t.lngLat};O.stopDragging=function(e){e.canDragMove&&e.initialDragPanState===!0&&this.map.dragPan.enable(),e.dragMoving=!1,e.canDragMove=!1,e.dragMoveLocation=null};O.onVertex=function(e,t){this.startDragging(e,t);const n=t.featureTarget.properties,o=e.selectedCoordPaths.indexOf(n.coord_path);!Ue(t)&&o===-1?e.selectedCoordPaths=[n.coord_path]:Ue(t)&&o===-1&&e.selectedCoordPaths.push(n.coord_path);const r=this.pathsToCoordinates(e.featureId,e.selectedCoordPaths);this.setSelectedCoordinates(r)};O.onMidpoint=function(e,t){this.startDragging(e,t);const n=t.featureTarget.properties;e.feature.addCoordinate(n.coord_path,n.lng,n.lat),this.fireUpdate(),e.selectedCoordPaths=[n.coord_path]};O.pathsToCoordinates=function(e,t){return t.map(n=>({feature_id:e,coord_path:n}))};O.onFeature=function(e,t){e.selectedCoordPaths.length===0?this.startDragging(e,t):this.stopDragging(e)};O.dragFeature=function(e,t,n){vt(this.getSelected(),n),e.dragMoveLocation=t.lngLat};O.dragVertex=function(e,t,n){const o=e.selectedCoordPaths.map(s=>e.feature.getCoordinate(s)),r=o.map(s=>({type:p.FEATURE,properties:{},geometry:{type:p.POINT,coordinates:s}})),i=It(r,n);for(let s=0;s<o.length;s++){const a=o[s];e.feature.updateCoordinate(e.selectedCoordPaths[s],a[0]+i.lng,a[1]+i.lat)}};O.clickNoTarget=function(){this.changeMode(S.SIMPLE_SELECT)};O.clickInactive=function(){this.changeMode(S.SIMPLE_SELECT)};O.clickActiveFeature=function(e){e.selectedCoordPaths=[],this.clearSelectedCoordinates(),e.feature.changed()};O.onSetup=function(e){const t=e.featureId,n=this.getFeature(t);if(!n)throw new Error("You must provide a featureId to enter direct_select mode");if(n.type===p.POINT)throw new TypeError("direct_select mode doesn't handle point features");const o={featureId:t,feature:n,dragMoveLocation:e.startPos||null,dragMoving:!1,canDragMove:!1,selectedCoordPaths:e.coordPath?[e.coordPath]:[]};return this.setSelectedCoordinates(this.pathsToCoordinates(t,o.selectedCoordPaths)),this.setSelected(t),H.disable(this),this.setActionableState({trash:!0}),o};O.onStop=function(){H.enable(this),this.clearSelectedCoordinates()};O.toDisplayFeatures=function(e,t,n){e.featureId===t.properties.id?(t.properties.active=P.ACTIVE,n(t),Xe(t,{map:this.map,midpoints:!0,selectedPaths:e.selectedCoordPaths}).forEach(n)):(t.properties.active=P.INACTIVE,n(t)),this.fireActionable(e)};O.onTrash=function(e){e.selectedCoordPaths.sort((t,n)=>n.localeCompare(t,"en",{numeric:!0})).forEach(t=>e.feature.removeCoordinate(t)),this.fireUpdate(),e.selectedCoordPaths=[],this.clearSelectedCoordinates(),this.fireActionable(e),e.feature.isValid()===!1&&(this.deleteFeature([e.featureId]),this.changeMode(S.SIMPLE_SELECT,{}))};O.onMouseMove=function(e,t){const n=ue(t),o=hn(t),r=pn(t),i=e.selectedCoordPaths.length===0;return n&&i?this.updateUIClasses({mouse:L.MOVE}):o&&!i?this.updateUIClasses({mouse:L.MOVE}):this.updateUIClasses({mouse:L.NONE}),(o||n||r)&&e.dragMoving&&this.fireUpdate(),this.stopDragging(e),!0};O.onMouseOut=function(e){return e.dragMoving&&this.fireUpdate(),!0};O.onTouchStart=O.onMouseDown=function(e,t){if(hn(t))return this.onVertex(e,t);if(ue(t))return this.onFeature(e,t);if(pn(t))return this.onMidpoint(e,t)};O.onDrag=function(e,t){if(e.canDragMove!==!0)return;e.dragMoving=!0,t.originalEvent.stopPropagation();const n={lng:t.lngLat.lng-e.dragMoveLocation.lng,lat:t.lngLat.lat-e.dragMoveLocation.lat};e.selectedCoordPaths.length>0?this.dragVertex(e,t,n):this.dragFeature(e,t,n),e.dragMoveLocation=t.lngLat};O.onClick=function(e,t){if(Ze(t))return this.clickNoTarget(e,t);if(ue(t))return this.clickActiveFeature(e,t);if(St(t))return this.clickInactive(e,t);this.stopDragging(e)};O.onTap=function(e,t){if(Ze(t))return this.clickNoTarget(e,t);if(ue(t))return this.clickActiveFeature(e,t);if(St(t))return this.clickInactive(e,t)};O.onTouchEnd=O.onMouseUp=function(e){e.dragMoving&&this.fireUpdate(),this.stopDragging(e)};const $={};$.onSetup=function(){const e=this.newFeature({type:p.FEATURE,properties:{},geometry:{type:p.POINT,coordinates:[]}});return this.addFeature(e),this.clearSelectedFeatures(),this.updateUIClasses({mouse:L.ADD}),this.activateUIButton(V.POINT),this.setActionableState({trash:!0}),{point:e}};$.stopDrawingAndRemove=function(e){this.deleteFeature([e.point.id],{silent:!0}),this.changeMode(S.SIMPLE_SELECT)};$.onTap=$.onClick=function(e,t){this.updateUIClasses({mouse:L.MOVE}),e.point.updateCoordinate("",t.lngLat.lng,t.lngLat.lat),this.fire(k.CREATE,{features:[e.point.toGeoJSON()]}),this.changeMode(S.SIMPLE_SELECT,{featureIds:[e.point.id]})};$.onStop=function(e){this.activateUIButton(),e.point.getCoordinate().length||this.deleteFeature([e.point.id],{silent:!0})};$.toDisplayFeatures=function(e,t,n){const o=t.properties.id===e.point.id;if(t.properties.active=o?P.ACTIVE:P.INACTIVE,!o)return n(t)};$.onTrash=$.stopDrawingAndRemove;$.onKeyUp=function(e,t){if(We(t)||He(t))return this.stopDrawingAndRemove(e,t)};function ke(e,t){return e.lngLat?e.lngLat.lng===t[0]&&e.lngLat.lat===t[1]:!1}const X={};X.onSetup=function(){const e=this.newFeature({type:p.FEATURE,properties:{},geometry:{type:p.POLYGON,coordinates:[[]]}});return this.addFeature(e),this.clearSelectedFeatures(),H.disable(this),this.updateUIClasses({mouse:L.ADD}),this.activateUIButton(V.POLYGON),this.setActionableState({trash:!0}),{polygon:e,currentVertexPosition:0}};X.clickAnywhere=function(e,t){if(e.currentVertexPosition>0&&ke(t,e.polygon.coordinates[0][e.currentVertexPosition-1]))return this.changeMode(S.SIMPLE_SELECT,{featureIds:[e.polygon.id]});this.updateUIClasses({mouse:L.ADD}),e.polygon.updateCoordinate(`0.${e.currentVertexPosition}`,t.lngLat.lng,t.lngLat.lat),e.currentVertexPosition++,e.polygon.updateCoordinate(`0.${e.currentVertexPosition}`,t.lngLat.lng,t.lngLat.lat)};X.clickOnVertex=function(e){return this.changeMode(S.SIMPLE_SELECT,{featureIds:[e.polygon.id]})};X.onMouseMove=function(e,t){e.polygon.updateCoordinate(`0.${e.currentVertexPosition}`,t.lngLat.lng,t.lngLat.lat),Oe(t)&&this.updateUIClasses({mouse:L.POINTER})};X.onTap=X.onClick=function(e,t){return Oe(t)?this.clickOnVertex(e,t):this.clickAnywhere(e,t)};X.onKeyUp=function(e,t){We(t)?(this.deleteFeature([e.polygon.id],{silent:!0}),this.changeMode(S.SIMPLE_SELECT)):He(t)&&this.changeMode(S.SIMPLE_SELECT,{featureIds:[e.polygon.id]})};X.onStop=function(e){this.updateUIClasses({mouse:L.NONE}),H.enable(this),this.activateUIButton(),this.getFeature(e.polygon.id)!==void 0&&(e.polygon.removeCoordinate(`0.${e.currentVertexPosition}`),e.polygon.isValid()?this.fire(k.CREATE,{features:[e.polygon.toGeoJSON()]}):(this.deleteFeature([e.polygon.id],{silent:!0}),this.changeMode(S.SIMPLE_SELECT,{},{silent:!0})))};X.toDisplayFeatures=function(e,t,n){const o=t.properties.id===e.polygon.id;if(t.properties.active=o?P.ACTIVE:P.INACTIVE,!o)return n(t);if(t.geometry.coordinates.length===0)return;const r=t.geometry.coordinates[0].length;if(!(r<3)){if(t.properties.meta=F.FEATURE,n(fe(e.polygon.id,t.geometry.coordinates[0][0],"0.0",!1)),r>3){const i=t.geometry.coordinates[0].length-3;n(fe(e.polygon.id,t.geometry.coordinates[0][i],`0.${i}`,!1))}if(r<=4){const i=[[t.geometry.coordinates[0][0][0],t.geometry.coordinates[0][0][1]],[t.geometry.coordinates[0][1][0],t.geometry.coordinates[0][1][1]]];if(n({type:p.FEATURE,properties:t.properties,geometry:{coordinates:i,type:p.LINE_STRING}}),r===3)return}return n(t)}};X.onTrash=function(e){this.deleteFeature([e.polygon.id],{silent:!0}),this.changeMode(S.SIMPLE_SELECT)};const K={};K.onSetup=function(e){e=e||{};const t=e.featureId;let n,o,r="forward";if(t){if(n=this.getFeature(t),!n)throw new Error("Could not find a feature with the provided featureId");let i=e.from;if(i&&i.type==="Feature"&&i.geometry&&i.geometry.type==="Point"&&(i=i.geometry),i&&i.type==="Point"&&i.coordinates&&i.coordinates.length===2&&(i=i.coordinates),!i||!Array.isArray(i))throw new Error("Please use the `from` property to indicate which point to continue the line from");const s=n.coordinates.length-1;if(n.coordinates[s][0]===i[0]&&n.coordinates[s][1]===i[1])o=s+1,n.addCoordinate(o,...n.coordinates[s]);else if(n.coordinates[0][0]===i[0]&&n.coordinates[0][1]===i[1])r="backwards",o=0,n.addCoordinate(o,...n.coordinates[0]);else throw new Error("`from` should match the point at either the start or the end of the provided LineString")}else n=this.newFeature({type:p.FEATURE,properties:{},geometry:{type:p.LINE_STRING,coordinates:[]}}),o=0,this.addFeature(n);return this.clearSelectedFeatures(),H.disable(this),this.updateUIClasses({mouse:L.ADD}),this.activateUIButton(V.LINE),this.setActionableState({trash:!0}),{line:n,currentVertexPosition:o,direction:r}};K.clickAnywhere=function(e,t){if(e.currentVertexPosition>0&&ke(t,e.line.coordinates[e.currentVertexPosition-1])||e.direction==="backwards"&&ke(t,e.line.coordinates[e.currentVertexPosition+1]))return this.changeMode(S.SIMPLE_SELECT,{featureIds:[e.line.id]});this.updateUIClasses({mouse:L.ADD}),e.line.updateCoordinate(e.currentVertexPosition,t.lngLat.lng,t.lngLat.lat),e.direction==="forward"?(e.currentVertexPosition++,e.line.updateCoordinate(e.currentVertexPosition,t.lngLat.lng,t.lngLat.lat)):e.line.addCoordinate(0,t.lngLat.lng,t.lngLat.lat)};K.clickOnVertex=function(e){return this.changeMode(S.SIMPLE_SELECT,{featureIds:[e.line.id]})};K.onMouseMove=function(e,t){e.line.updateCoordinate(e.currentVertexPosition,t.lngLat.lng,t.lngLat.lat),Oe(t)&&this.updateUIClasses({mouse:L.POINTER})};K.onTap=K.onClick=function(e,t){if(Oe(t))return this.clickOnVertex(e,t);this.clickAnywhere(e,t)};K.onKeyUp=function(e,t){He(t)?this.changeMode(S.SIMPLE_SELECT,{featureIds:[e.line.id]}):We(t)&&(this.deleteFeature([e.line.id],{silent:!0}),this.changeMode(S.SIMPLE_SELECT))};K.onStop=function(e){H.enable(this),this.activateUIButton(),this.getFeature(e.line.id)!==void 0&&(e.line.removeCoordinate(`${e.currentVertexPosition}`),e.line.isValid()?this.fire(k.CREATE,{features:[e.line.toGeoJSON()]}):(this.deleteFeature([e.line.id],{silent:!0}),this.changeMode(S.SIMPLE_SELECT,{},{silent:!0})))};K.onTrash=function(e){this.deleteFeature([e.line.id],{silent:!0}),this.changeMode(S.SIMPLE_SELECT)};K.toDisplayFeatures=function(e,t,n){const o=t.properties.id===e.line.id;if(t.properties.active=o?P.ACTIVE:P.INACTIVE,!o)return n(t);t.geometry.coordinates.length<2||(t.properties.meta=F.FEATURE,n(fe(e.line.id,t.geometry.coordinates[e.direction==="forward"?t.geometry.coordinates.length-2:1],`${e.direction==="forward"?t.geometry.coordinates.length-2:1}`,!1)),n(t))};const gn={simple_select:v,direct_select:O,draw_point:$,draw_polygon:X,draw_line_string:K},Xo={defaultMode:S.SIMPLE_SELECT,keybindings:!0,touchEnabled:!0,clickBuffer:2,touchBuffer:25,boxSelect:!0,displayControlsDefault:!0,styles:cn,modes:gn,controls:{},userProperties:!1,suppressAPIEvents:!0},Ko={point:!0,line_string:!0,polygon:!0,trash:!0,combine_features:!0,uncombine_features:!0},jo={point:!1,line_string:!1,polygon:!1,trash:!1,combine_features:!1,uncombine_features:!1};function Xt(e,t){return e.map(n=>n.source?n:Object.assign({},n,{id:`${n.id}.${t}`,source:t==="hot"?q.HOT:q.COLD}))}function Qo(e={}){let t=Object.assign({},e);return e.controls||(t.controls={}),e.displayControlsDefault===!1?t.controls=Object.assign({},jo,e.controls):t.controls=Object.assign({},Ko,e.controls),t=Object.assign({},Xo,t),t.styles=Xt(t.styles,"cold").concat(Xt(t.styles,"hot")),t}var $o=function e(t,n){if(t===n)return!0;if(t&&n&&typeof t=="object"&&typeof n=="object"){if(t.constructor!==n.constructor)return!1;var o,r,i;if(Array.isArray(t)){if(o=t.length,o!=n.length)return!1;for(r=o;r--!==0;)if(!e(t[r],n[r]))return!1;return!0}if(t.constructor===RegExp)return t.source===n.source&&t.flags===n.flags;if(t.valueOf!==Object.prototype.valueOf)return t.valueOf()===n.valueOf();if(t.toString!==Object.prototype.toString)return t.toString()===n.toString();if(i=Object.keys(t),o=i.length,o!==Object.keys(n).length)return!1;for(r=o;r--!==0;)if(!Object.prototype.hasOwnProperty.call(n,i[r]))return!1;for(r=o;r--!==0;){var s=i[r];if(!e(t[s],n[s]))return!1}return!0}return t!==t&&n!==n};const Kt=Qt($o);var er=nr,tr={Point:"geometry",MultiPoint:"geometry",LineString:"geometry",MultiLineString:"geometry",Polygon:"geometry",MultiPolygon:"geometry",GeometryCollection:"geometry",Feature:"feature",FeatureCollection:"featurecollection"};function nr(e){if(!e||!e.type)return null;var t=tr[e.type];if(!t)return null;if(t==="geometry")return{type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:e}]};if(t==="feature")return{type:"FeatureCollection",features:[e]};if(t==="featurecollection")return e}const or=Qt(er);function mn(e,t){return e.length!==t.length?!1:JSON.stringify(e.map(n=>n).sort())===JSON.stringify(t.map(n=>n).sort())}const rr={Polygon:z,LineString:ee,Point:oe,MultiPolygon:U,MultiLineString:U,MultiPoint:U};function ir(e,t){t.modes=S;const n=e.options.suppressAPIEvents!==void 0?!!e.options.suppressAPIEvents:!0;return t.getFeatureIdsAt=function(o){return de.click({point:o},null,e).map(i=>i.properties.id)},t.getSelectedIds=function(){return e.store.getSelectedIds()},t.getSelected=function(){return{type:p.FEATURE_COLLECTION,features:e.store.getSelectedIds().map(o=>e.store.get(o)).map(o=>o.toGeoJSON())}},t.getSelectedPoints=function(){return{type:p.FEATURE_COLLECTION,features:e.store.getSelectedCoordinates().map(o=>({type:p.FEATURE,properties:{},geometry:{type:p.POINT,coordinates:o.coordinates}}))}},t.set=function(o){if(o.type===void 0||o.type!==p.FEATURE_COLLECTION||!Array.isArray(o.features))throw new Error("Invalid FeatureCollection");const r=e.store.createRenderBatch();let i=e.store.getAllIds().slice();const s=t.add(o),a=new Y(s);return i=i.filter(l=>!a.has(l)),i.length&&t.delete(i),r(),s},t.add=function(o){const i=JSON.parse(JSON.stringify(or(o))).features.map(s=>{if(s.id=s.id||Ct(),s.geometry===null)throw new Error("Invalid geometry: null");if(e.store.get(s.id)===void 0||e.store.get(s.id).type!==s.geometry.type){const a=rr[s.geometry.type];if(a===void 0)throw new Error(`Invalid geometry type: ${s.geometry.type}.`);const l=new a(e,s);e.store.add(l,{silent:n})}else{const a=e.store.get(s.id),l=a.properties;a.properties=s.properties,Kt(l,s.properties)||e.store.featureChanged(a.id,{silent:n}),Kt(a.getCoordinates(),s.geometry.coordinates)||a.incomingCoords(s.geometry.coordinates)}return s.id});return e.store.render(),i},t.get=function(o){const r=e.store.get(o);if(r)return r.toGeoJSON()},t.getAll=function(){return{type:p.FEATURE_COLLECTION,features:e.store.getAll().map(o=>o.toGeoJSON())}},t.delete=function(o){return e.store.delete(o,{silent:n}),t.getMode()===S.DIRECT_SELECT&&!e.store.getSelectedIds().length?e.events.changeMode(S.SIMPLE_SELECT,void 0,{silent:n}):e.store.render(),t},t.deleteAll=function(){return e.store.delete(e.store.getAllIds(),{silent:n}),t.getMode()===S.DIRECT_SELECT?e.events.changeMode(S.SIMPLE_SELECT,void 0,{silent:n}):e.store.render(),t},t.changeMode=function(o,r={}){return o===S.SIMPLE_SELECT&&t.getMode()===S.SIMPLE_SELECT?(mn(r.featureIds||[],e.store.getSelectedIds())||(e.store.setSelected(r.featureIds,{silent:n}),e.store.render()),t):(o===S.DIRECT_SELECT&&t.getMode()===S.DIRECT_SELECT&&r.featureId===e.store.getSelectedIds()[0]||e.events.changeMode(o,r,{silent:n}),t)},t.getMode=function(){return e.events.getMode()},t.trash=function(){return e.events.trash({silent:n}),t},t.combineFeatures=function(){return e.events.combineFeatures({silent:n}),t},t.uncombineFeatures=function(){return e.events.uncombineFeatures({silent:n}),t},t.setFeatureProperty=function(o,r,i){return e.store.setFeatureProperty(o,r,i,{silent:n}),t},t}const sr=Object.freeze(Object.defineProperty({__proto__:null,CommonSelectors:Wo,ModeHandler:ct,StringSet:Y,constrainFeatureMovement:It,createMidPoint:fn,createSupplementaryPoints:Xe,createVertex:fe,doubleClickZoom:H,euclideanDistance:Et,featuresAt:de,getFeatureAtAndSetCursors:De,isClick:pt,isEventAtCoordinates:ke,isTap:gt,mapEventToBoundingBox:sn,moveFeatures:vt,sortFeatures:rn,stringSetsAreEqual:mn,theme:cn,toDenseArray:ve},Symbol.toStringTag,{value:"Module"})),ar=function(e,t){e=Qo(e);const n={options:e};t=ir(n,t),n.api=t;const o=Yo(n);return t.onAdd=o.onAdd,t.onRemove=o.onRemove,t.types=V,t.options=e,t};function Ke(e){ar(e,this)}Ke.modes=gn;Ke.constants=on;Ke.lib=sr;var ur=Ve('<div class="flex flex-col h-full w-full"><div class="grow"><!></div></div>');function Cr(e,t){he(t,!0);let n=R(void 0);function o(){let l=new Ke;const c=l.onAdd.bind(l);return l.onAdd=E=>{let T=c(E);return T.classList.add("maplibregl-ctrl-group"),T.classList.add("maplibregl-ctrl"),T},l}let r=o();W(()=>{d(n).addControl(r)});var i=ur(),s=at(i),a=at(s);_o(a,{center:[-79.941013,40.439938],zoom:14,class:"map",standardControls:!0,style:"https://api.maptiler.com/maps/outdoor-v2/style.json?key=WYBGJJDhMhxLW8Icu2a0",get map(){return d(n)},set map(l){N(n,A(l))}}),ut(s),ut(i),Re(e,i),pe()}export{Cr as component};

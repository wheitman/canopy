var Ni=Object.defineProperty;var xi=(e,t,r)=>t in e?Ni(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;var Wr=(e,t,r)=>xi(e,typeof t!="symbol"?t+"":t,r);import{c as _r,b as xe,t as rt}from"../chunks/DF0WtOI1.js";import{v as Jr,au as ze,t as Pe,M,J as he,x as Fe,P as le,am as Qn,X as pe,aw as be,ae as Kn,aQ as Ri,af as Ue,av as Ae,ag as De}from"../chunks/AwFcVDii.js";import{s as Pi}from"../chunks/Bedstq2Q.js";import{I as Fi,s as ki,a as Ui,B as Di,i as Bi}from"../chunks/DKBXBsp-.js";import{k as Gi,f as qi}from"../chunks/DK8CJ6tG.js";import{l as Vi,s as zi,p as P,a as ce,r as ji}from"../chunks/Dg0Jxp-V.js";import{a as Je,o as Wi}from"../chunks/CeYNnV-u.js";import{u as Ji,m as Re,B as $n,s as Yi,a as Ye,b as Xi,d as Hi,e as Zi,g as Mr,c as ei,M as Qi}from"../chunks/DhAY0qrf.js";import{i as br}from"../chunks/Coivoa4k.js";import{a as ti,d as Ki}from"../chunks/DK2JTsvm.js";import{b as $i}from"../chunks/BT-P0YJ4.js";import"../chunks/eSxYClhJ.js";function eo(e,t,r){var n=e.__className,i=to(t,r);Jr&&e.className===i?e.__className=i:(n!==i||Jr&&e.className!==i)&&(t==null&&!r?e.removeAttribute("class"):e.className=i,e.__className=i)}function to(e,t){return(e??"")+(" "+t)}function ro(e,t,r){if(r){if(e.classList.contains(t))return;e.classList.add(t)}else{if(!e.classList.contains(t))return;e.classList.remove(t)}}function no(e,t){const r=Vi(t,["children","$$slots","$$events","$$legacy"]);Fi(e,zi({name:"play"},()=>r,{iconNode:[["polygon",{points:"6 3 20 12 6 21 6 3"}]],children:(i,o)=>{var d=_r(),c=ze(d);ki(c,t,"default",{}),xe(i,d)},$$slots:{default:!0}}))}function ri(e){return Object.fromEntries(Object.entries(e).filter(([t,r])=>r!=null))}function oo(e,t){Pe(t,!0);let r=P(t,"marker",15,void 0),n=P(t,"lngLat",15),i=P(t,"class",3,void 0),o=P(t,"draggable",3,!1),d=P(t,"feature",3,void 0),c=P(t,"offset",3,void 0),l=P(t,"rotation",3,0),f=P(t,"opacity",3,1),u=P(t,"ondrag",3,void 0),p=P(t,"ondragstart",3,void 0),a=P(t,"ondragend",3,void 0);const h=le(Ye),_=le(()=>M(h).map),{layerEvent:L,marker:T}=Ji(),O=()=>j(p(),"dragstart"),N=()=>{F(),j(u(),"drag")},R=()=>{F(),j(a(),"dragend")};T.value=new Re.Marker(ri({draggable:o(),rotation:l(),className:i(),anchor:t.anchor,offset:c(),opacity:f().toString()})).setLngLat(n()).addTo(M(_)),r(T.value),o()&&(T.value.on("dragstart",O),T.value.on("drag",N),T.value.on("dragend",R)),Je(()=>{var z;r(void 0),(z=T.value)==null||z.remove()});let q=new $n(n());Yi(q),he(()=>{var z;(z=T.value)==null||z.setLngLat(n()),q.value=n()}),he(()=>{var z;c()&&((z=T.value)==null||z.setOffset(c()))}),he(()=>{var z;(z=T.value)==null||z.setRotation(l())}),he(()=>{var z;(z=T.value)==null||z.setOpacity(f().toString())});function F(){var I;let z=(I=T.value)==null?void 0:I.getLngLat();z&&(Array.isArray(n())?n([z.lng,z.lat]):n()&&"lon"in n()?n({lon:z.lng,lat:z.lat}):n(z))}function j(z,I){var A,V;let U=(A=T.value)==null?void 0:A.getLngLat();if(!U)return;const k=[U.lng,U.lat];let G={map:M(_),marker:T.value,lngLat:k,features:[{type:"Feature",properties:((V=d())==null?void 0:V.properties)??{},geometry:{type:"Point",coordinates:k}}]};L.value={...G,layerType:"marker",type:I},z==null||z(G)}var te=_r(),ee=ze(te);{var H=z=>{var I=_r(),U=ze(I);ti(U,()=>t.children??Qn,()=>({marker:T.value})),xe(z,I)};br(ee,z=>{T.value&&z(H)})}xe(e,te),Fe()}function so(e,t){Pe(t,!0);const r=le(Ye),n=le(()=>M(r).map),i=le(()=>M(r).loaded);let o=P(t,"position",3,"top-left"),d=P(t,"container",3,void 0),c=be(void 0),l=le(()=>typeof d()=="string"?document.querySelector(d())??void 0:d());he(()=>{M(c)||(M(l)?pe(c,ce(new Re.FullscreenControl({container:M(l)}))):pe(c,ce(new Re.FullscreenControl)),M(n).addControl(M(c),o()))}),Je(()=>{M(i)&&M(c)&&M(n).removeControl(M(c))}),Fe()}function ao(e,t){Pe(t,!0);const r=le(Ye),n=le(()=>M(r).map),i=le(()=>M(r).loaded);let o=P(t,"position",3,"top-left"),d=P(t,"positionOptions",3,void 0),c=P(t,"fitBoundsOptions",3,void 0),l=P(t,"trackUserLocation",3,!1),f=P(t,"showAccuracyCircle",3,!0),u=P(t,"showUserLocation",3,!0),p=P(t,"control",15);he(()=>{M(n)&&!p()&&(p(new Re.GeolocateControl({positionOptions:d(),fitBoundsOptions:c(),trackUserLocation:l(),showAccuracyCircle:f(),showUserLocation:u()})),M(n).addControl(p(),o()))}),Je(()=>{M(i)&&p()&&M(n).removeControl(p())}),Fe()}function uo(e,t){Pe(t,!0);let r=P(t,"layer",3,void 0),n=ji(t,["$$slots","$$events","$$legacy","layer"]);const i=le(Ye),o=le(()=>M(i).map);function d(u){return n["on"+u]}function c(u){var p;(p=d(u.type))==null||p(u)}const l=["click","dblclick","mousedown","mouseup","mousemove","mouseenter","mouseleave","contextmenu","mouseover","mouseout"],f=["click","dblclick","contextmenu","mousemove","movestart","moveend","zoomstart","zoom","zoomend","pitch","rotate","wheel","data","styledata","idle"];he(()=>{if(M(o))if(r())for(const u of l)d(u)&&M(o).on(u,r(),c);else for(const u of f)d(u)&&M(o).on(u,c)}),Je(()=>{if(M(o))if(r())for(const u of l)d(u)&&M(o).off(u,r(),c);else for(const u of f)d(u)&&M(o).off(u,c)}),Fe()}function co(e){let t=e.getCenter(),r=Math.round(e.getZoom()*100)/100,n=Math.ceil((r*Math.LN2+Math.log(512/360/.5))/Math.LN10),i=Math.pow(10,n),o=Math.round(t.lat*i)/i,d=Math.round(t.lng*i)/i,c=`${r}/${o}/${d}`,l=e.getBearing(),f=e.getPitch();return(l||f)&&(c+=`/${Math.round(l*10)/10}`),f&&(c+=`/${Math.round(f)}`),`#${c}`}function lo(e){return e.replace("#","").split("/").map(parseFloat)}var $e=Or;function Or(e,t){return e===t||e!==e&&t!==t?!0:typeof e!=typeof t||{}.toString.call(e)!={}.toString.call(t)||e!==Object(e)||!e?!1:Array.isArray(e)?Yr(e,t):{}.toString.call(e)=="[object Set]"?Yr(Array.from(e),Array.from(t)):{}.toString.call(e)=="[object Object]"?ho(e,t):fo(e,t)}function fo(e,t){return e.toString()===t.toString()}function Yr(e,t){var r=e.length;if(r!=t.length)return!1;for(var n=0;n<r;n++)if(!Or(e[n],t[n]))return!1;return!0}function ho(e,t){var r=Object.keys(e),n=r.length;if(n!=Object.keys(t).length)return!1;for(var i=0;i<n;i++){var o=r[i];if(!(t.hasOwnProperty(o)&&Or(e[o],t[o])))return!1}return!0}const{LngLatBounds:po,LngLat:mo}=Re;function ft(e,t){return Math.abs(e-t)<1e-6}function go(e,t){let r=po.convert(e);if(!t)return{equal:!1,bounds:r};let n=r.getNorthEast(),i=t.getNorthEast();if(!ft(n.lat,i.lat)||!ft(n.wrap().lng,i.wrap().lng))return{equal:!1,bounds:r};let o=r.getSouthWest(),d=t.getSouthWest();return!ft(o.lat,d.lat)||!ft(o.wrap().lng,d.wrap().lng)?{equal:!1,bounds:r}:{equal:!0,bounds:r}}function vo(e,t){const r=e.getSouthWest(),n=e.getNorthEast();if(Array.isArray(t)){if(t.length===4)return[r.lng,r.lat,n.lng,n.lat];if(t.length===2)return t[0]instanceof mo?[r,n]:[[r.lng,r.lat],[n.lng,n.lat]]}return e}function yo(e,t){Pe(t,!0);const r=le(Ye),n=le(()=>M(r).map),i=le(()=>M(r).loaded);let o=P(t,"position",3,"top-left"),d=P(t,"showCompass",3,!0),c=P(t,"showZoom",3,!0),l=P(t,"visualizePitch",3,!1),f=be(void 0);he(()=>{M(n)&&!M(f)&&(pe(f,ce(new Re.NavigationControl({showCompass:d(),showZoom:c(),visualizePitch:l()}))),M(n).addControl(M(f),o()))}),Je(()=>{M(i)&&M(f)&&M(n).removeControl(M(f))}),Fe()}function _o(e,t){Pe(t,!0);const r=le(Ye),n=le(()=>M(r).map),i=le(()=>M(r).loaded);let o=P(t,"position",3,"bottom-left"),d=P(t,"maxWidth",3,void 0),c=P(t,"unit",3,"metric"),l=be(void 0);he(()=>{M(n)&&!M(l)&&(pe(l,ce(new Re.ScaleControl({maxWidth:d(),unit:c()}))),M(n).addControl(M(l),o()))}),Je(()=>{M(i)&&M(l)&&M(n).removeControl(M(l))}),Fe()}var bo=rt("<!> <!> <!> <!>",1),wo=rt("<!> <!>",1),Eo=rt('<div data-testid="map-container"><!></div>');function So(e,t){Pe(t,!0);let r=P(t,"map",15,void 0),n=P(t,"mapContainer",15,void 0),i=P(t,"class",3,void 0),o=P(t,"diffStyleUpdates",3,!1),d=P(t,"center",15,void 0),c=P(t,"zoom",15,void 0),l=P(t,"pitch",15,0),f=P(t,"bearing",15,0),u=P(t,"bearingSnap",3,7),p=P(t,"bounds",15,void 0),a=P(t,"hash",3,!1),h=P(t,"projection",3,void 0),_=P(t,"updateHash",3,x=>{window.history.replaceState(window.history.state,"",x)}),L=P(t,"loaded",15,!1),T=P(t,"minZoom",3,0),O=P(t,"maxZoom",3,22),N=P(t,"minPitch",3,0),R=P(t,"maxPitch",3,60),q=P(t,"renderWorldCopies",3,void 0),F=P(t,"dragPan",3,void 0),j=P(t,"dragRotate",3,void 0),te=P(t,"pitchWithRotate",3,void 0),ee=P(t,"antialias",3,void 0),H=P(t,"zoomOnDoubleClick",3,!0),z=P(t,"locale",3,void 0),I=P(t,"interactive",3,!0),U=P(t,"attributionControl",3,void 0),k=P(t,"cooperativeGestures",3,!1),G=P(t,"preserveDrawingBuffer",3,!1),A=P(t,"maxBounds",3,void 0),V=P(t,"images",19,()=>[]),Y=P(t,"standardControls",3,!1),s=P(t,"filterLayers",3,void 0),m=P(t,"transformRequest",3,void 0),g=le(()=>typeof Y()=="boolean"?void 0:Y());const v=Xi();Hi(new $n(void 0));let y=be(ce(new Set));async function b(x,W=!1){var K;if(r()&&!(!((K=r())!=null&&K.loaded())&&!W))if("url"in x){M(y).add(x.id);try{let $=await r().loadImage(x.url);r().addImage(x.id,$.data,x.options),v.loadedImages.add(x.id)}catch($){t.onerror?t.onerror({error:$}):console.error($)}finally{M(y).delete(x.id)}}else r().addImage(x.id,x.data,x.options),v.loadedImages.add(x.id)}he(()=>{var x;if(L()&&((x=r())!=null&&x.loaded()))for(let W of V())!v.loadedImages.has(W.id)&&!M(y).has(W.id)&&!r().hasImage(W.id)&&b(W)});let w=le(()=>V().every(x=>v.loadedImages.has(x.id))),C=be(void 0),E=be(void 0),S=be(void 0),D=be(void 0);function ue(x){t.onerror?t.onerror(x):x.error.name!=="AbortError"&&console.error(x.error)}function Z(x){return oe(),r(v.map=new Re.Map(ri({container:x,style:t.style,locale:z(),center:d(),zoom:c(),pitch:l(),bearing:f(),bearingSnap:u(),minZoom:T(),maxZoom:O(),minPitch:N(),maxPitch:R(),renderWorldCopies:q(),dragPan:F(),dragRotate:j(),pitchWithRotate:te(),antialias:ee(),interactive:I(),preserveDrawingBuffer:G(),maxBounds:A(),bounds:p(),attributionControl:U(),transformRequest:m(),cooperativeGestures:k()}))),r().on("load",W=>{W.target.getContainer().setAttribute("data-testid","map"),W.target.getCanvas().setAttribute("data-testid","map-canvas"),t.onload&&t.onload(r()),v.loaded=!0,L(!0)}),r().on("error",ue),t.onmovestart&&r().on("movestart",t.onmovestart),r().on("moveend",W=>{var K;if(d(W.target.getCenter()),c(W.target.getZoom()),l(W.target.getPitch()),f(W.target.getBearing()),p(vo(W.target.getBounds(),p())),(K=t.onmoveend)==null||K.call(t,W),a()){let $=new URL(window.location.href.replace(/(#.+)?$/,co(W.target)));_()($)}}),t.onclick&&r().on("click",t.onclick),t.ondblclick&&r().on("dblclick",t.ondblclick),t.oncontextmenu&&r().on("contextmenu",t.oncontextmenu),t.onmousemove&&r().on("mousemove",t.onmousemove),t.onzoomstart&&r().on("zoomstart",t.onzoomstart),t.onzoom&&r().on("zoom",t.onzoom),t.onzoomend&&r().on("zoomend",t.onzoomend),t.onpitch&&r().on("pitch",t.onpitch),t.onrotate&&r().on("rotate",t.onrotate),t.onwheel&&r().on("wheel",t.onwheel),t.ondata&&r().on("data",t.ondata),t.onidle&&r().on("idle",t.onidle),r().on("style.load",W=>{var K;if(r()){h()&&r().setProjection(h()),v.loaded=!0,L(!0);const $=r().getStyle();if(pe(C,ce($.layers.map(Ee=>Ee.id))),pe(E,ce(Object.keys($.sources))),M(D))for(const[Ee,Ke]of Object.entries(M(D)))r().addSource(Ee,Ke);if(M(S))for(const Ee of M(S))r().addLayer(Ee);for(const Ee of V())b(Ee,!0);(K=t.onstyleload)==null||K.call(t,W)}}),r().on("styledata",W=>{var K;if(r()&&s()){const $=r().getStyle().layers;if($)for(let Ee of $)s()(Ee)||r().setLayoutProperty(Ee.id,"visibility","none")}(K=t.onstyledata)==null||K.call(t,W)}),{destroy(){var W;L(!1),v.loaded=!1,(W=r())==null||W.remove()}}}let Q=be(ce(t.style));he(()=>{if(r()&&!$e(t.style,M(Q))){const x=r().getStyle();if(M(C)&&pe(S,ce(x.layers.filter(W=>!M(C).includes(W.id)))),M(E)){const W=Object.keys(x.sources).filter(K=>!M(E).includes(K));pe(D,ce({}));for(const K of W)M(D)[K]=x.sources[K]}pe(Q,ce(t.style)),r().setStyle(t.style,{diff:o()}),v.loadedImages.clear(),pe(y,ce(new Set))}}),he(()=>{if(r()){let x={};d()!=null&&!$e(d(),r().getCenter())&&(x.center=d()),c()!=null&&!$e(c(),r().getZoom())&&(x.zoom=c()),f()!=null&&!$e(f(),r().getBearing())&&(x.bearing=f()),l()!=null&&!$e(l(),r().getPitch())&&(x.pitch=l()),Object.keys(x).length&&r().easeTo(x)}}),he(()=>{var x;h()&&L()&&((x=r())==null||x.setProjection(h()))}),he(()=>{var x,W;if(p()){const{equal:K,bounds:$}=go(p(),(x=r())==null?void 0:x.getBounds());K||(W=r())==null||W.fitBounds($)}}),he(()=>{var x,W;H()?(x=r())==null||x.doubleClickZoom.enable():(W=r())==null||W.doubleClickZoom.disable()});function oe(){if(a()){let x=lo(window.location.hash);x.length>=3&&(c(x[0]),d([x[2],x[1]])),x.length==5&&(f(x[3]),l(x[4]))}}var ae=Eo();Gi("hashchange",Ri,oe);var Ze=Ue(ae);{var Qe=x=>{var W=wo(),K=ze(W);{var $=Ke=>{var qr=bo(),Vr=ze(qr);yo(Vr,{get position(){return M(g)}});var zr=Ae(Vr,2);ao(zr,{get position(){return M(g)},fitBoundsOptions:{maxZoom:12}});var jr=Ae(zr,2);so(jr,{get position(){return M(g)}});var Ai=Ae(jr,2);_o(Ai,{get position(){return M(g)}}),xe(Ke,qr)};br(K,Ke=>{Y()&&Ke($)})}var Ee=Ae(K,2);ti(Ee,()=>t.children??Qn,()=>({map:r(),loaded:L(),loadedImages:v.loadedImages,allImagesLoaded:M(w)})),xe(x,W)};br(Ze,x=>{r()&&x(Qe)})}De(ae),$i(ae,x=>n(x),()=>n()),Zi(ae,x=>Z==null?void 0:Z(x)),Kn(()=>{eo(ae,Ki(i()),"svelte-p00lfq"),ro(ae,"expand-map",!i())}),xe(e,ae),Fe()}const wr=function(e,t){const r={drag:[],click:[],mousemove:[],mousedown:[],mouseup:[],mouseout:[],keydown:[],keyup:[],touchstart:[],touchmove:[],touchend:[],tap:[]},n={on(o,d,c){if(r[o]===void 0)throw new Error(`Invalid event type: ${o}`);r[o].push({selector:d,fn:c})},render(o){t.store.featureChanged(o)}},i=function(o,d){const c=r[o];let l=c.length;for(;l--;){const f=c[l];if(f.selector(d)){f.fn.call(n,d)||t.store.render(),t.ui.updateMapClasses();break}}};return e.start.call(n),{render:e.render,stop(){e.stop&&e.stop()},trash(){e.trash&&(e.trash(),t.store.render())},combineFeatures(){e.combineFeatures&&e.combineFeatures()},uncombineFeatures(){e.uncombineFeatures&&e.uncombineFeatures()},drag(o){i("drag",o)},click(o){i("click",o)},mousemove(o){i("mousemove",o)},mousedown(o){i("mousedown",o)},mouseup(o){i("mouseup",o)},mouseout(o){i("mouseout",o)},keydown(o){i("keydown",o)},keyup(o){i("keyup",o)},touchstart(o){i("touchstart",o)},touchmove(o){i("touchmove",o)},touchend(o){i("touchend",o)},tap(o){i("tap",o)}}};var Ir={},vt={};vt.RADIUS=6378137;vt.FLATTENING=1/298.257223563;vt.POLAR_RADIUS=63567523142e-4;var Xr=vt;Ir.geometry=ni;Ir.ring=Er;function ni(e){var t=0,r;switch(e.type){case"Polygon":return Hr(e.coordinates);case"MultiPolygon":for(r=0;r<e.coordinates.length;r++)t+=Hr(e.coordinates[r]);return t;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0;case"GeometryCollection":for(r=0;r<e.geometries.length;r++)t+=ni(e.geometries[r]);return t}}function Hr(e){var t=0;if(e&&e.length>0){t+=Math.abs(Er(e[0]));for(var r=1;r<e.length;r++)t-=Math.abs(Er(e[r]))}return t}function Er(e){var t,r,n,i,o,d,c,l=0,f=e.length;if(f>2){for(c=0;c<f;c++)c===f-2?(i=f-2,o=f-1,d=0):c===f-1?(i=f-1,o=0,d=1):(i=c,o=c+1,d=c+2),t=e[i],r=e[o],n=e[d],l+=(Lt(n[0])-Lt(t[0]))*Math.sin(Lt(r[1]));l=l*Xr.RADIUS*Xr.RADIUS/2}return l}function Lt(e){return e*Math.PI/180}const ye={CANVAS:"mapboxgl-canvas",CONTROL_BASE:"mapboxgl-ctrl",CONTROL_PREFIX:"mapboxgl-ctrl-",CONTROL_BUTTON:"mapbox-gl-draw_ctrl-draw-btn",CONTROL_BUTTON_LINE:"mapbox-gl-draw_line",CONTROL_BUTTON_POLYGON:"mapbox-gl-draw_polygon",CONTROL_BUTTON_POINT:"mapbox-gl-draw_point",CONTROL_BUTTON_TRASH:"mapbox-gl-draw_trash",CONTROL_BUTTON_COMBINE_FEATURES:"mapbox-gl-draw_combine",CONTROL_BUTTON_UNCOMBINE_FEATURES:"mapbox-gl-draw_uncombine",CONTROL_GROUP:"mapboxgl-ctrl-group",ATTRIBUTION:"mapboxgl-ctrl-attrib",ACTIVE_BUTTON:"active",BOX_SELECT:"mapbox-gl-draw_boxselect"},Se={HOT:"mapbox-gl-draw-hot",COLD:"mapbox-gl-draw-cold"},se={ADD:"add",MOVE:"move",DRAG:"drag",POINTER:"pointer",NONE:"none"},_e={POLYGON:"polygon",LINE:"line_string",POINT:"point"},B={FEATURE:"Feature",POLYGON:"Polygon",LINE_STRING:"LineString",POINT:"Point",FEATURE_COLLECTION:"FeatureCollection",MULTI_PREFIX:"Multi",MULTI_POINT:"MultiPoint",MULTI_LINE_STRING:"MultiLineString",MULTI_POLYGON:"MultiPolygon"},X={DRAW_LINE_STRING:"draw_line_string",DRAW_POLYGON:"draw_polygon",DRAW_POINT:"draw_point",SIMPLE_SELECT:"simple_select",DIRECT_SELECT:"direct_select"},ge={CREATE:"draw.create",DELETE:"draw.delete",UPDATE:"draw.update",SELECTION_CHANGE:"draw.selectionchange",MODE_CHANGE:"draw.modechange",ACTIONABLE:"draw.actionable",RENDER:"draw.render",COMBINE_FEATURES:"draw.combine",UNCOMBINE_FEATURES:"draw.uncombine"},nt={MOVE:"move",CHANGE_PROPERTIES:"change_properties",CHANGE_COORDINATES:"change_coordinates"},de={FEATURE:"feature",MIDPOINT:"midpoint",VERTEX:"vertex"},fe={ACTIVE:"true",INACTIVE:"false"},ii=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate"],To=-90,Sr=-85,Co=90,Tr=85,Lo=-270,Mo=270,oi=Object.freeze(Object.defineProperty({__proto__:null,LAT_MAX:Co,LAT_MIN:To,LAT_RENDERED_MAX:Tr,LAT_RENDERED_MIN:Sr,LNG_MAX:Mo,LNG_MIN:Lo,activeStates:fe,classes:ye,cursors:se,events:ge,geojsonTypes:B,interactions:ii,meta:de,modes:X,sources:Se,types:_e,updateActions:nt},Symbol.toStringTag,{value:"Module"})),Zr={Point:0,LineString:1,MultiLineString:1,Polygon:2};function Oo(e,t){const r=Zr[e.geometry.type]-Zr[t.geometry.type];return r===0&&e.geometry.type===B.POLYGON?e.area-t.area:r}function si(e){return e.map(t=>(t.geometry.type===B.POLYGON&&(t.area=Ir.geometry({type:B.FEATURE,property:{},geometry:t.geometry})),t)).sort(Oo).map(t=>(delete t.area,t))}function ai(e,t=0){return[[e.point.x-t,e.point.y-t],[e.point.x+t,e.point.y+t]]}function Te(e){if(this._items={},this._nums={},this._length=e?e.length:0,!!e)for(let t=0,r=e.length;t<r;t++)this.add(e[t]),e[t]!==void 0&&(typeof e[t]=="string"?this._items[e[t]]=t:this._nums[e[t]]=t)}Te.prototype.add=function(e){return this.has(e)?this:(this._length++,typeof e=="string"?this._items[e]=this._length:this._nums[e]=this._length,this)};Te.prototype.delete=function(e){return this.has(e)===!1?this:(this._length--,delete this._items[e],delete this._nums[e],this)};Te.prototype.has=function(e){return typeof e!="string"&&typeof e!="number"?!1:this._items[e]!==void 0||this._nums[e]!==void 0};Te.prototype.values=function(){const e=[];return Object.keys(this._items).forEach(t=>{e.push({k:t,v:this._items[t]})}),Object.keys(this._nums).forEach(t=>{e.push({k:JSON.parse(t),v:this._nums[t]})}),e.sort((t,r)=>t.v-r.v).map(t=>t.k)};Te.prototype.clear=function(){return this._length=0,this._items={},this._nums={},this};const Io=[de.FEATURE,de.MIDPOINT,de.VERTEX],je={click:Ao,touch:No};function Ao(e,t,r){return ui(e,t,r,r.options.clickBuffer)}function No(e,t,r){return ui(e,t,r,r.options.touchBuffer)}function ui(e,t,r,n){if(r.map===null)return[];const i=e?ai(e,n):t,o={};r.options.styles&&(o.layers=r.options.styles.map(f=>f.id).filter(f=>r.map.getLayer(f)!=null));const d=r.map.queryRenderedFeatures(i,o).filter(f=>Io.indexOf(f.properties.meta)!==-1),c=new Te,l=[];return d.forEach(f=>{const u=f.properties.id;c.has(u)||(c.add(u),l.push(f))}),si(l)}function pt(e,t){const r=je.click(e,null,t),n={mouse:se.NONE};return r[0]&&(n.mouse=r[0].properties.active===fe.ACTIVE?se.MOVE:se.POINTER,n.feature=r[0].properties.meta),t.events.currentModeName().indexOf("draw")!==-1&&(n.mouse=se.ADD),t.ui.queueMapClasses(n),t.ui.updateMapClasses(),r[0]}function Ar(e,t){const r=e.x-t.x,n=e.y-t.y;return Math.sqrt(r*r+n*n)}const xo=4,Ro=12,Po=500;function Cr(e,t,r={}){const n=r.fineTolerance!=null?r.fineTolerance:xo,i=r.grossTolerance!=null?r.grossTolerance:Ro,o=r.interval!=null?r.interval:Po;e.point=e.point||t.point,e.time=e.time||t.time;const d=Ar(e.point,t.point);return d<n||d<i&&t.time-e.time<o}const Fo=25,ko=250;function Lr(e,t,r={}){const n=r.tolerance!=null?r.tolerance:Fo,i=r.interval!=null?r.interval:ko;return e.point=e.point||t.point,e.time=e.time||t.time,Ar(e.point,t.point)<n&&t.time-e.time<i}let Uo=(e,t=21)=>(r=t)=>{let n="",i=r|0;for(;i--;)n+=e[Math.random()*e.length|0];return n};const Do=Uo("0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",32);function Nr(){return Do()}const ve=function(e,t){this.ctx=e,this.properties=t.properties||{},this.coordinates=t.geometry.coordinates,this.id=t.id||Nr(),this.type=t.geometry.type};ve.prototype.changed=function(){this.ctx.store.featureChanged(this.id)};ve.prototype.incomingCoords=function(e){this.setCoordinates(e)};ve.prototype.setCoordinates=function(e){this.coordinates=e,this.changed()};ve.prototype.getCoordinates=function(){return JSON.parse(JSON.stringify(this.coordinates))};ve.prototype.setProperty=function(e,t){this.properties[e]=t};ve.prototype.toGeoJSON=function(){return JSON.parse(JSON.stringify({id:this.id,type:B.FEATURE,properties:this.properties,geometry:{coordinates:this.getCoordinates(),type:this.type}}))};ve.prototype.internal=function(e){const t={id:this.id,meta:de.FEATURE,"meta:type":this.type,active:fe.INACTIVE,mode:e};if(this.ctx.options.userProperties)for(const r in this.properties)t[`user_${r}`]=this.properties[r];return{type:B.FEATURE,properties:t,geometry:{coordinates:this.getCoordinates(),type:this.type}}};const ke=function(e,t){ve.call(this,e,t)};ke.prototype=Object.create(ve.prototype);ke.prototype.isValid=function(){return typeof this.coordinates[0]=="number"&&typeof this.coordinates[1]=="number"};ke.prototype.updateCoordinate=function(e,t,r){arguments.length===3?this.coordinates=[t,r]:this.coordinates=[e,t],this.changed()};ke.prototype.getCoordinate=function(){return this.getCoordinates()};const Ie=function(e,t){ve.call(this,e,t)};Ie.prototype=Object.create(ve.prototype);Ie.prototype.isValid=function(){return this.coordinates.length>1};Ie.prototype.addCoordinate=function(e,t,r){this.changed();const n=parseInt(e,10);this.coordinates.splice(n,0,[t,r])};Ie.prototype.getCoordinate=function(e){const t=parseInt(e,10);return JSON.parse(JSON.stringify(this.coordinates[t]))};Ie.prototype.removeCoordinate=function(e){this.changed(),this.coordinates.splice(parseInt(e,10),1)};Ie.prototype.updateCoordinate=function(e,t,r){const n=parseInt(e,10);this.coordinates[n]=[t,r],this.changed()};const we=function(e,t){ve.call(this,e,t),this.coordinates=this.coordinates.map(r=>r.slice(0,-1))};we.prototype=Object.create(ve.prototype);we.prototype.isValid=function(){return this.coordinates.length===0?!1:this.coordinates.every(e=>e.length>2)};we.prototype.incomingCoords=function(e){this.coordinates=e.map(t=>t.slice(0,-1)),this.changed()};we.prototype.setCoordinates=function(e){this.coordinates=e,this.changed()};we.prototype.addCoordinate=function(e,t,r){this.changed();const n=e.split(".").map(o=>parseInt(o,10));this.coordinates[n[0]].splice(n[1],0,[t,r])};we.prototype.removeCoordinate=function(e){this.changed();const t=e.split(".").map(n=>parseInt(n,10)),r=this.coordinates[t[0]];r&&(r.splice(t[1],1),r.length<3&&this.coordinates.splice(t[0],1))};we.prototype.getCoordinate=function(e){const t=e.split(".").map(n=>parseInt(n,10)),r=this.coordinates[t[0]];return JSON.parse(JSON.stringify(r[t[1]]))};we.prototype.getCoordinates=function(){return this.coordinates.map(e=>e.concat([e[0]]))};we.prototype.updateCoordinate=function(e,t,r){this.changed();const n=e.split("."),i=parseInt(n[0],10),o=parseInt(n[1],10);this.coordinates[i]===void 0&&(this.coordinates[i]=[]),this.coordinates[i][o]=[t,r]};const Bo={MultiPoint:ke,MultiLineString:Ie,MultiPolygon:we},yt=(e,t,r,n,i)=>{const o=r.split("."),d=parseInt(o[0],10),c=o[1]?o.slice(1).join("."):null;return e[d][t](c,n,i)},me=function(e,t){if(ve.call(this,e,t),delete this.coordinates,this.model=Bo[t.geometry.type],this.model===void 0)throw new TypeError(`${t.geometry.type} is not a valid type`);this.features=this._coordinatesToFeatures(t.geometry.coordinates)};me.prototype=Object.create(ve.prototype);me.prototype._coordinatesToFeatures=function(e){const t=this.model.bind(this);return e.map(r=>new t(this.ctx,{id:Nr(),type:B.FEATURE,properties:{},geometry:{coordinates:r,type:this.type.replace("Multi","")}}))};me.prototype.isValid=function(){return this.features.every(e=>e.isValid())};me.prototype.setCoordinates=function(e){this.features=this._coordinatesToFeatures(e),this.changed()};me.prototype.getCoordinate=function(e){return yt(this.features,"getCoordinate",e)};me.prototype.getCoordinates=function(){return JSON.parse(JSON.stringify(this.features.map(e=>e.type===B.POLYGON?e.getCoordinates():e.coordinates)))};me.prototype.updateCoordinate=function(e,t,r){yt(this.features,"updateCoordinate",e,t,r),this.changed()};me.prototype.addCoordinate=function(e,t,r){yt(this.features,"addCoordinate",e,t,r),this.changed()};me.prototype.removeCoordinate=function(e){yt(this.features,"removeCoordinate",e),this.changed()};me.prototype.getFeatures=function(){return this.features};function J(e){this.map=e.map,this.drawConfig=JSON.parse(JSON.stringify(e.options||{})),this._ctx=e}J.prototype.setSelected=function(e){return this._ctx.store.setSelected(e)};J.prototype.setSelectedCoordinates=function(e){this._ctx.store.setSelectedCoordinates(e),e.reduce((t,r)=>(t[r.feature_id]===void 0&&(t[r.feature_id]=!0,this._ctx.store.get(r.feature_id).changed()),t),{})};J.prototype.getSelected=function(){return this._ctx.store.getSelected()};J.prototype.getSelectedIds=function(){return this._ctx.store.getSelectedIds()};J.prototype.isSelected=function(e){return this._ctx.store.isSelected(e)};J.prototype.getFeature=function(e){return this._ctx.store.get(e)};J.prototype.select=function(e){return this._ctx.store.select(e)};J.prototype.deselect=function(e){return this._ctx.store.deselect(e)};J.prototype.deleteFeature=function(e,t={}){return this._ctx.store.delete(e,t)};J.prototype.addFeature=function(e,t={}){return this._ctx.store.add(e,t)};J.prototype.clearSelectedFeatures=function(){return this._ctx.store.clearSelected()};J.prototype.clearSelectedCoordinates=function(){return this._ctx.store.clearSelectedCoordinates()};J.prototype.setActionableState=function(e={}){const t={trash:e.trash||!1,combineFeatures:e.combineFeatures||!1,uncombineFeatures:e.uncombineFeatures||!1};return this._ctx.events.actionable(t)};J.prototype.changeMode=function(e,t={},r={}){return this._ctx.events.changeMode(e,t,r)};J.prototype.fire=function(e,t){return this._ctx.events.fire(e,t)};J.prototype.updateUIClasses=function(e){return this._ctx.ui.queueMapClasses(e)};J.prototype.activateUIButton=function(e){return this._ctx.ui.setActiveButton(e)};J.prototype.featuresAt=function(e,t,r="click"){if(r!=="click"&&r!=="touch")throw new Error("invalid buffer type");return je[r](e,t,this._ctx)};J.prototype.newFeature=function(e){const t=e.geometry.type;return t===B.POINT?new ke(this._ctx,e):t===B.LINE_STRING?new Ie(this._ctx,e):t===B.POLYGON?new we(this._ctx,e):new me(this._ctx,e)};J.prototype.isInstanceOf=function(e,t){if(e===B.POINT)return t instanceof ke;if(e===B.LINE_STRING)return t instanceof Ie;if(e===B.POLYGON)return t instanceof we;if(e==="MultiFeature")return t instanceof me;throw new Error(`Unknown feature class: ${e}`)};J.prototype.doRender=function(e){return this._ctx.store.featureChanged(e)};J.prototype.onSetup=function(){};J.prototype.onDrag=function(){};J.prototype.onClick=function(){};J.prototype.onMouseMove=function(){};J.prototype.onMouseDown=function(){};J.prototype.onMouseUp=function(){};J.prototype.onMouseOut=function(){};J.prototype.onKeyUp=function(){};J.prototype.onKeyDown=function(){};J.prototype.onTouchStart=function(){};J.prototype.onTouchMove=function(){};J.prototype.onTouchEnd=function(){};J.prototype.onTap=function(){};J.prototype.onStop=function(){};J.prototype.onTrash=function(){};J.prototype.onCombineFeature=function(){};J.prototype.onUncombineFeature=function(){};J.prototype.toDisplayFeatures=function(){throw new Error("You must overwrite toDisplayFeatures")};const ci={drag:"onDrag",click:"onClick",mousemove:"onMouseMove",mousedown:"onMouseDown",mouseup:"onMouseUp",mouseout:"onMouseOut",keyup:"onKeyUp",keydown:"onKeyDown",touchstart:"onTouchStart",touchmove:"onTouchMove",touchend:"onTouchEnd",tap:"onTap"},Go=Object.keys(ci);function qo(e){const t=Object.keys(e);return function(r,n={}){let i={};const o=t.reduce((c,l)=>(c[l]=e[l],c),new J(r));function d(c){return l=>o[c](i,l)}return{start(){i=o.onSetup(n),Go.forEach(c=>{const l=ci[c];let f=()=>!1;e[l]&&(f=()=>!0),this.on(c,f,d(l))})},stop(){o.onStop(i)},trash(){o.onTrash(i)},combineFeatures(){o.onCombineFeatures(i)},uncombineFeatures(){o.onUncombineFeatures(i)},render(c,l){o.toDisplayFeatures(i,c,l)}}}}function Vo(e){const t=Object.keys(e.options.modes).reduce((a,h)=>(a[h]=qo(e.options.modes[h]),a),{});let r={},n={};const i={};let o=null,d=null;i.drag=function(a,h){h({point:a.point,time:new Date().getTime()})?(e.ui.queueMapClasses({mouse:se.DRAG}),d.drag(a)):a.originalEvent.stopPropagation()},i.mousedrag=function(a){i.drag(a,h=>!Cr(r,h))},i.touchdrag=function(a){i.drag(a,h=>!Lr(n,h))},i.mousemove=function(a){if((a.originalEvent.buttons!==void 0?a.originalEvent.buttons:a.originalEvent.which)===1)return i.mousedrag(a);const _=pt(a,e);a.featureTarget=_,d.mousemove(a)},i.mousedown=function(a){r={time:new Date().getTime(),point:a.point};const h=pt(a,e);a.featureTarget=h,d.mousedown(a)},i.mouseup=function(a){const h=pt(a,e);a.featureTarget=h,Cr(r,{point:a.point,time:new Date().getTime()})?d.click(a):d.mouseup(a)},i.mouseout=function(a){d.mouseout(a)},i.touchstart=function(a){if(!e.options.touchEnabled)return;n={time:new Date().getTime(),point:a.point};const h=je.touch(a,null,e)[0];a.featureTarget=h,d.touchstart(a)},i.touchmove=function(a){if(e.options.touchEnabled)return d.touchmove(a),i.touchdrag(a)},i.touchend=function(a){if(a.originalEvent.preventDefault(),!e.options.touchEnabled)return;const h=je.touch(a,null,e)[0];a.featureTarget=h,Lr(n,{time:new Date().getTime(),point:a.point})?d.tap(a):d.touchend(a)};const c=a=>!(a===8||a===46||a>=48&&a<=57);i.keydown=function(a){(a.srcElement||a.target).classList.contains(ye.CANVAS)&&((a.keyCode===8||a.keyCode===46)&&e.options.controls.trash?(a.preventDefault(),d.trash()):c(a.keyCode)?d.keydown(a):a.keyCode===49&&e.options.controls.point?l(X.DRAW_POINT):a.keyCode===50&&e.options.controls.line_string?l(X.DRAW_LINE_STRING):a.keyCode===51&&e.options.controls.polygon&&l(X.DRAW_POLYGON))},i.keyup=function(a){c(a.keyCode)&&d.keyup(a)},i.zoomend=function(){e.store.changeZoom()},i.data=function(a){if(a.dataType==="style"){const{setup:h,map:_,options:L,store:T}=e;L.styles.some(N=>_.getLayer(N.id))||(h.addLayers(),T.setDirty(),T.render())}};function l(a,h,_={}){d.stop();const L=t[a];if(L===void 0)throw new Error(`${a} is not valid`);o=a;const T=L(e,h);d=wr(T,e),_.silent||e.map.fire(ge.MODE_CHANGE,{mode:a}),e.store.setDirty(),e.store.render()}const f={trash:!1,combineFeatures:!1,uncombineFeatures:!1};function u(a){let h=!1;Object.keys(a).forEach(_=>{if(f[_]===void 0)throw new Error("Invalid action type");f[_]!==a[_]&&(h=!0),f[_]=a[_]}),h&&e.map.fire(ge.ACTIONABLE,{actions:f})}return{start(){o=e.options.defaultMode,d=wr(t[o](e),e)},changeMode:l,actionable:u,currentModeName(){return o},currentModeRender(a,h){return d.render(a,h)},fire(a,h){e.map&&e.map.fire(a,h)},addEventListeners(){e.map.on("mousemove",i.mousemove),e.map.on("mousedown",i.mousedown),e.map.on("mouseup",i.mouseup),e.map.on("data",i.data),e.map.on("touchmove",i.touchmove),e.map.on("touchstart",i.touchstart),e.map.on("touchend",i.touchend),e.container.addEventListener("mouseout",i.mouseout),e.options.keybindings&&(e.container.addEventListener("keydown",i.keydown),e.container.addEventListener("keyup",i.keyup))},removeEventListeners(){e.map.off("mousemove",i.mousemove),e.map.off("mousedown",i.mousedown),e.map.off("mouseup",i.mouseup),e.map.off("data",i.data),e.map.off("touchmove",i.touchmove),e.map.off("touchstart",i.touchstart),e.map.off("touchend",i.touchend),e.container.removeEventListener("mouseout",i.mouseout),e.options.keybindings&&(e.container.removeEventListener("keydown",i.keydown),e.container.removeEventListener("keyup",i.keyup))},trash(a){d.trash(a)},combineFeatures(){d.combineFeatures()},uncombineFeatures(){d.uncombineFeatures()},getMode(){return o}}}function it(e){return[].concat(e).filter(t=>t!==void 0)}function zo(){const e=this;if(!(e.ctx.map&&e.ctx.map.getSource(Se.HOT)!==void 0))return l();const r=e.ctx.events.currentModeName();e.ctx.ui.queueMapClasses({mode:r});let n=[],i=[];e.isDirty?i=e.getAllIds():(n=e.getChangedIds().filter(f=>e.get(f)!==void 0),i=e.sources.hot.filter(f=>f.properties.id&&n.indexOf(f.properties.id)===-1&&e.get(f.properties.id)!==void 0).map(f=>f.properties.id)),e.sources.hot=[];const o=e.sources.cold.length;e.sources.cold=e.isDirty?[]:e.sources.cold.filter(f=>{const u=f.properties.id||f.properties.parent;return n.indexOf(u)===-1});const d=o!==e.sources.cold.length||i.length>0;n.forEach(f=>c(f,"hot")),i.forEach(f=>c(f,"cold"));function c(f,u){const a=e.get(f).internal(r);e.ctx.events.currentModeRender(a,h=>{h.properties.mode=r,e.sources[u].push(h)})}d&&e.ctx.map.getSource(Se.COLD).setData({type:B.FEATURE_COLLECTION,features:e.sources.cold}),e.ctx.map.getSource(Se.HOT).setData({type:B.FEATURE_COLLECTION,features:e.sources.hot}),l();function l(){e.isDirty=!1,e.clearChangedIds()}}function ie(e){this._features={},this._featureIds=new Te,this._selectedFeatureIds=new Te,this._selectedCoordinates=[],this._changedFeatureIds=new Te,this._emitSelectionChange=!1,this._mapInitialConfig={},this.ctx=e,this.sources={hot:[],cold:[]};let t;this.render=()=>{t||(t=requestAnimationFrame(()=>{t=null,zo.call(this),this._emitSelectionChange&&(this.ctx.events.fire(ge.SELECTION_CHANGE,{features:this.getSelected().map(r=>r.toGeoJSON()),points:this.getSelectedCoordinates().map(r=>({type:B.FEATURE,properties:{},geometry:{type:B.POINT,coordinates:r.coordinates}}))}),this._emitSelectionChange=!1),this.ctx.events.fire(ge.RENDER,{})}))},this.isDirty=!1}ie.prototype.createRenderBatch=function(){const e=this.render;let t=0;return this.render=function(){t++},()=>{this.render=e,t>0&&this.render()}};ie.prototype.setDirty=function(){return this.isDirty=!0,this};ie.prototype.featureCreated=function(e,t={}){if(this._changedFeatureIds.add(e),(t.silent!=null?t.silent:this.ctx.options.suppressAPIEvents)!==!0){const n=this.get(e);this.ctx.events.fire(ge.CREATE,{features:[n.toGeoJSON()]})}return this};ie.prototype.featureChanged=function(e,t={}){return this._changedFeatureIds.add(e),(t.silent!=null?t.silent:this.ctx.options.suppressAPIEvents)!==!0&&this.ctx.events.fire(ge.UPDATE,{action:t.action?t.action:nt.CHANGE_COORDINATES,features:[this.get(e).toGeoJSON()]}),this};ie.prototype.getChangedIds=function(){return this._changedFeatureIds.values()};ie.prototype.clearChangedIds=function(){return this._changedFeatureIds.clear(),this};ie.prototype.getAllIds=function(){return this._featureIds.values()};ie.prototype.add=function(e,t={}){return this._features[e.id]=e,this._featureIds.add(e.id),this.featureCreated(e.id,{silent:t.silent}),this};ie.prototype.delete=function(e,t={}){const r=[];return it(e).forEach(n=>{this._featureIds.has(n)&&(this._featureIds.delete(n),this._selectedFeatureIds.delete(n),t.silent||r.indexOf(this._features[n])===-1&&r.push(this._features[n].toGeoJSON()),delete this._features[n],this.isDirty=!0)}),r.length&&this.ctx.events.fire(ge.DELETE,{features:r}),li(this,t),this};ie.prototype.get=function(e){return this._features[e]};ie.prototype.getAll=function(){return Object.keys(this._features).map(e=>this._features[e])};ie.prototype.select=function(e,t={}){return it(e).forEach(r=>{this._selectedFeatureIds.has(r)||(this._selectedFeatureIds.add(r),this._changedFeatureIds.add(r),t.silent||(this._emitSelectionChange=!0))}),this};ie.prototype.deselect=function(e,t={}){return it(e).forEach(r=>{this._selectedFeatureIds.has(r)&&(this._selectedFeatureIds.delete(r),this._changedFeatureIds.add(r),t.silent||(this._emitSelectionChange=!0))}),li(this,t),this};ie.prototype.clearSelected=function(e={}){return this.deselect(this._selectedFeatureIds.values(),{silent:e.silent}),this};ie.prototype.setSelected=function(e,t={}){return e=it(e),this.deselect(this._selectedFeatureIds.values().filter(r=>e.indexOf(r)===-1),{silent:t.silent}),this.select(e.filter(r=>!this._selectedFeatureIds.has(r)),{silent:t.silent}),this};ie.prototype.setSelectedCoordinates=function(e){return this._selectedCoordinates=e,this._emitSelectionChange=!0,this};ie.prototype.clearSelectedCoordinates=function(){return this._selectedCoordinates=[],this._emitSelectionChange=!0,this};ie.prototype.getSelectedIds=function(){return this._selectedFeatureIds.values()};ie.prototype.getSelected=function(){return this.getSelectedIds().map(e=>this.get(e))};ie.prototype.getSelectedCoordinates=function(){return this._selectedCoordinates.map(t=>({coordinates:this.get(t.feature_id).getCoordinate(t.coord_path)}))};ie.prototype.isSelected=function(e){return this._selectedFeatureIds.has(e)};ie.prototype.setFeatureProperty=function(e,t,r,n={}){this.get(e).setProperty(t,r),this.featureChanged(e,{silent:n.silent,action:nt.CHANGE_PROPERTIES})};function li(e,t={}){const r=e._selectedCoordinates.filter(n=>e._selectedFeatureIds.has(n.feature_id));e._selectedCoordinates.length!==r.length&&!t.silent&&(e._emitSelectionChange=!0),e._selectedCoordinates=r}ie.prototype.storeMapConfig=function(){ii.forEach(e=>{this.ctx.map[e]&&(this._mapInitialConfig[e]=this.ctx.map[e].isEnabled())})};ie.prototype.restoreMapConfig=function(){Object.keys(this._mapInitialConfig).forEach(e=>{this._mapInitialConfig[e]?this.ctx.map[e].enable():this.ctx.map[e].disable()})};ie.prototype.getInitialConfigValue=function(e){return this._mapInitialConfig[e]!==void 0?this._mapInitialConfig[e]:!0};const jo=["mode","feature","mouse"];function Wo(e){const t={};let r=null,n={mode:null,feature:null,mouse:null},i={mode:null,feature:null,mouse:null};function o(){d({mode:null,feature:null,mouse:null}),c()}function d(h){i=Object.assign(i,h)}function c(){if(!e.container)return;const h=[],_=[];jo.forEach(L=>{i[L]!==n[L]&&(h.push(`${L}-${n[L]}`),i[L]!==null&&_.push(`${L}-${i[L]}`))}),h.length>0&&e.container.classList.remove(...h),_.length>0&&e.container.classList.add(..._),n=Object.assign(n,i)}function l(h,_={}){const L=document.createElement("button");return L.className=`${ye.CONTROL_BUTTON} ${_.className}`,L.setAttribute("title",_.title),_.container.appendChild(L),L.addEventListener("click",T=>{if(T.preventDefault(),T.stopPropagation(),T.target===r){f(),_.onDeactivate();return}u(h),_.onActivate()},!0),L}function f(){r&&(r.classList.remove(ye.ACTIVE_BUTTON),r=null)}function u(h){f();const _=t[h];_&&_&&h!=="trash"&&(_.classList.add(ye.ACTIVE_BUTTON),r=_)}function p(){const h=e.options.controls,_=document.createElement("div");return _.className=`${ye.CONTROL_GROUP} ${ye.CONTROL_BASE}`,h&&(h[_e.LINE]&&(t[_e.LINE]=l(_e.LINE,{container:_,className:ye.CONTROL_BUTTON_LINE,title:`LineString tool ${e.options.keybindings?"(l)":""}`,onActivate:()=>e.events.changeMode(X.DRAW_LINE_STRING),onDeactivate:()=>e.events.trash()})),h[_e.POLYGON]&&(t[_e.POLYGON]=l(_e.POLYGON,{container:_,className:ye.CONTROL_BUTTON_POLYGON,title:`Polygon tool ${e.options.keybindings?"(p)":""}`,onActivate:()=>e.events.changeMode(X.DRAW_POLYGON),onDeactivate:()=>e.events.trash()})),h[_e.POINT]&&(t[_e.POINT]=l(_e.POINT,{container:_,className:ye.CONTROL_BUTTON_POINT,title:`Marker tool ${e.options.keybindings?"(m)":""}`,onActivate:()=>e.events.changeMode(X.DRAW_POINT),onDeactivate:()=>e.events.trash()})),h.trash&&(t.trash=l("trash",{container:_,className:ye.CONTROL_BUTTON_TRASH,title:"Delete",onActivate:()=>{e.events.trash()}})),h.combine_features&&(t.combine_features=l("combineFeatures",{container:_,className:ye.CONTROL_BUTTON_COMBINE_FEATURES,title:"Combine",onActivate:()=>{e.events.combineFeatures()}})),h.uncombine_features&&(t.uncombine_features=l("uncombineFeatures",{container:_,className:ye.CONTROL_BUTTON_UNCOMBINE_FEATURES,title:"Uncombine",onActivate:()=>{e.events.uncombineFeatures()}}))),_}function a(){Object.keys(t).forEach(h=>{const _=t[h];_.parentNode&&_.parentNode.removeChild(_),delete t[h]})}return{setActiveButton:u,queueMapClasses:d,updateMapClasses:c,clearMapClasses:o,addButtons:p,removeButtons:a}}function Jo(e){let t=null,r=null;const n={onRemove(){return e.map.off("load",n.connect),clearInterval(r),n.removeLayers(),e.store.restoreMapConfig(),e.ui.removeButtons(),e.events.removeEventListeners(),e.ui.clearMapClasses(),e.boxZoomInitial&&e.map.boxZoom.enable(),e.map=null,e.container=null,e.store=null,t&&t.parentNode&&t.parentNode.removeChild(t),t=null,this},connect(){e.map.off("load",n.connect),clearInterval(r),n.addLayers(),e.store.storeMapConfig(),e.events.addEventListeners()},onAdd(i){if(e.map=i,e.events=Vo(e),e.ui=Wo(e),e.container=i.getContainer(),e.store=new ie(e),t=e.ui.addButtons(),e.options.boxSelect){e.boxZoomInitial=i.boxZoom.isEnabled(),i.boxZoom.disable();const o=i.dragPan.isEnabled();i.dragPan.disable(),i.dragPan.enable(),o||i.dragPan.disable()}return i.loaded()?n.connect():(i.on("load",n.connect),r=setInterval(()=>{i.loaded()&&n.connect()},16)),e.events.start(),t},addLayers(){e.map.addSource(Se.COLD,{data:{type:B.FEATURE_COLLECTION,features:[]},type:"geojson"}),e.map.addSource(Se.HOT,{data:{type:B.FEATURE_COLLECTION,features:[]},type:"geojson"}),e.options.styles.forEach(i=>{e.map.addLayer(i)}),e.store.setDirty(!0),e.store.render()},removeLayers(){e.options.styles.forEach(i=>{e.map.getLayer(i.id)&&e.map.removeLayer(i.id)}),e.map.getSource(Se.COLD)&&e.map.removeSource(Se.COLD),e.map.getSource(Se.HOT)&&e.map.removeSource(Se.HOT)}};return e.setup=n,n}const Mt="#3bb2d0",et="#fbb03b",Qr="#fff",fi=[{id:"gl-draw-polygon-fill",type:"fill",filter:["all",["==","$type","Polygon"]],paint:{"fill-color":["case",["==",["get","active"],"true"],et,Mt],"fill-opacity":.1}},{id:"gl-draw-lines",type:"line",filter:["any",["==","$type","LineString"],["==","$type","Polygon"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":["case",["==",["get","active"],"true"],et,Mt],"line-dasharray":["case",["==",["get","active"],"true"],[.2,2],[2,0]],"line-width":2}},{id:"gl-draw-point-outer",type:"circle",filter:["all",["==","$type","Point"],["==","meta","feature"]],paint:{"circle-radius":["case",["==",["get","active"],"true"],7,5],"circle-color":Qr}},{id:"gl-draw-point-inner",type:"circle",filter:["all",["==","$type","Point"],["==","meta","feature"]],paint:{"circle-radius":["case",["==",["get","active"],"true"],5,3],"circle-color":["case",["==",["get","active"],"true"],et,Mt]}},{id:"gl-draw-vertex-outer",type:"circle",filter:["all",["==","$type","Point"],["==","meta","vertex"],["!=","mode","simple_select"]],paint:{"circle-radius":["case",["==",["get","active"],"true"],7,5],"circle-color":Qr}},{id:"gl-draw-vertex-inner",type:"circle",filter:["all",["==","$type","Point"],["==","meta","vertex"],["!=","mode","simple_select"]],paint:{"circle-radius":["case",["==",["get","active"],"true"],5,3],"circle-color":et}},{id:"gl-draw-midpoint",type:"circle",filter:["all",["==","meta","midpoint"]],paint:{"circle-radius":3,"circle-color":et}}];function _t(e){return function(t){const r=t.featureTarget;return!r||!r.properties?!1:r.properties.meta===e}}function hi(e){return!e.originalEvent||!e.originalEvent.shiftKey?!1:e.originalEvent.button===0}function Be(e){return!e.featureTarget||!e.featureTarget.properties?!1:e.featureTarget.properties.active===fe.ACTIVE&&e.featureTarget.properties.meta===de.FEATURE}function xr(e){return!e.featureTarget||!e.featureTarget.properties?!1:e.featureTarget.properties.active===fe.INACTIVE&&e.featureTarget.properties.meta===de.FEATURE}function bt(e){return e.featureTarget===void 0}function Rr(e){return!e.featureTarget||!e.featureTarget.properties?!1:e.featureTarget.properties.meta===de.FEATURE}function ot(e){const t=e.featureTarget;return!t||!t.properties?!1:t.properties.meta===de.VERTEX}function mt(e){return e.originalEvent?e.originalEvent.shiftKey===!0:!1}function wt(e){return e.keyCode===27}function Et(e){return e.keyCode===13}function Yo(){return!0}const Xo=Object.freeze(Object.defineProperty({__proto__:null,isActiveFeature:Be,isEnterKey:Et,isEscapeKey:wt,isFeature:Rr,isInactiveFeature:xr,isOfMetaType:_t,isShiftDown:mt,isShiftMousedown:hi,isTrue:Yo,isVertex:ot,noTarget:bt},Symbol.toStringTag,{value:"Module"}));function Ne(e,t){this.x=e,this.y=t}Ne.prototype={clone(){return new Ne(this.x,this.y)},add(e){return this.clone()._add(e)},sub(e){return this.clone()._sub(e)},multByPoint(e){return this.clone()._multByPoint(e)},divByPoint(e){return this.clone()._divByPoint(e)},mult(e){return this.clone()._mult(e)},div(e){return this.clone()._div(e)},rotate(e){return this.clone()._rotate(e)},rotateAround(e,t){return this.clone()._rotateAround(e,t)},matMult(e){return this.clone()._matMult(e)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(e){return this.x===e.x&&this.y===e.y},dist(e){return Math.sqrt(this.distSqr(e))},distSqr(e){const t=e.x-this.x,r=e.y-this.y;return t*t+r*r},angle(){return Math.atan2(this.y,this.x)},angleTo(e){return Math.atan2(this.y-e.y,this.x-e.x)},angleWith(e){return this.angleWithSep(e.x,e.y)},angleWithSep(e,t){return Math.atan2(this.x*t-this.y*e,this.x*e+this.y*t)},_matMult(e){const t=e[0]*this.x+e[1]*this.y,r=e[2]*this.x+e[3]*this.y;return this.x=t,this.y=r,this},_add(e){return this.x+=e.x,this.y+=e.y,this},_sub(e){return this.x-=e.x,this.y-=e.y,this},_mult(e){return this.x*=e,this.y*=e,this},_div(e){return this.x/=e,this.y/=e,this},_multByPoint(e){return this.x*=e.x,this.y*=e.y,this},_divByPoint(e){return this.x/=e.x,this.y/=e.y,this},_unit(){return this._div(this.mag()),this},_perp(){const e=this.y;return this.y=this.x,this.x=-e,this},_rotate(e){const t=Math.cos(e),r=Math.sin(e),n=t*this.x-r*this.y,i=r*this.x+t*this.y;return this.x=n,this.y=i,this},_rotateAround(e,t){const r=Math.cos(e),n=Math.sin(e),i=t.x+r*(this.x-t.x)-n*(this.y-t.y),o=t.y+n*(this.x-t.x)+r*(this.y-t.y);return this.x=i,this.y=o,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:Ne};Ne.convert=function(e){if(e instanceof Ne)return e;if(Array.isArray(e))return new Ne(+e[0],+e[1]);if(e.x!==void 0&&e.y!==void 0)return new Ne(+e.x,+e.y);throw new Error("Expected [x, y] or {x, y} point format")};function Pr(e,t){const r=t.getBoundingClientRect();return new Ne(e.clientX-r.left-(t.clientLeft||0),e.clientY-r.top-(t.clientTop||0))}function We(e,t,r,n){return{type:B.FEATURE,properties:{meta:de.VERTEX,parent:e,coord_path:r,active:n?fe.ACTIVE:fe.INACTIVE},geometry:{type:B.POINT,coordinates:t}}}function di(e,t,r){const n=t.geometry.coordinates,i=r.geometry.coordinates;if(n[1]>Tr||n[1]<Sr||i[1]>Tr||i[1]<Sr)return null;const o={lng:(n[0]+i[0])/2,lat:(n[1]+i[1])/2};return{type:B.FEATURE,properties:{meta:de.MIDPOINT,parent:e,lng:o.lng,lat:o.lat,coord_path:r.properties.coord_path},geometry:{type:B.POINT,coordinates:[o.lng,o.lat]}}}function St(e,t={},r=null){const{type:n,coordinates:i}=e.geometry,o=e.properties&&e.properties.id;let d=[];n===B.POINT?d.push(We(o,i,r,l(r))):n===B.POLYGON?i.forEach((u,p)=>{c(u,r!==null?`${r}.${p}`:String(p))}):n===B.LINE_STRING?c(i,r):n.indexOf(B.MULTI_PREFIX)===0&&f();function c(u,p){let a="",h=null;u.forEach((_,L)=>{const T=p!=null?`${p}.${L}`:String(L),O=We(o,_,T,l(T));if(t.midpoints&&h){const R=di(o,h,O);R&&d.push(R)}h=O;const N=JSON.stringify(_);a!==N&&d.push(O),L===0&&(a=N)})}function l(u){return t.selectedPaths?t.selectedPaths.indexOf(u)!==-1:!1}function f(){const u=n.replace(B.MULTI_PREFIX,"");i.forEach((p,a)=>{const h={type:B.FEATURE,properties:e.properties,geometry:{type:u,coordinates:p}};d=d.concat(St(h,t,a))})}return d}const Ce={enable(e){setTimeout(()=>{!e.map||!e.map.doubleClickZoom||!e._ctx||!e._ctx.store||!e._ctx.store.getInitialConfigValue||e._ctx.store.getInitialConfigValue("doubleClickZoom")&&e.map.doubleClickZoom.enable()},0)},disable(e){setTimeout(()=>{!e.map||!e.map.doubleClickZoom||e.map.doubleClickZoom.disable()},0)}},{LAT_MIN:ht,LAT_MAX:dt,LAT_RENDERED_MIN:Kr,LAT_RENDERED_MAX:$r,LNG_MIN:en,LNG_MAX:tn}=oi;function Ho(e){const t={Point:0,LineString:1,Polygon:2,MultiPoint:1,MultiLineString:2,MultiPolygon:3}[e.geometry.type],r=[e.geometry.coordinates].flat(t),n=r.map(c=>c[0]),i=r.map(c=>c[1]),o=c=>Math.min.apply(null,c),d=c=>Math.max.apply(null,c);return[o(n),o(i),d(n),d(i)]}function Fr(e,t){let r=ht,n=dt,i=ht,o=dt,d=tn,c=en;e.forEach(f=>{const u=Ho(f),p=u[1],a=u[3],h=u[0],_=u[2];p>r&&(r=p),a<n&&(n=a),a>i&&(i=a),p<o&&(o=p),h<d&&(d=h),_>c&&(c=_)});const l=t;return r+l.lat>$r&&(l.lat=$r-r),i+l.lat>dt&&(l.lat=dt-i),n+l.lat<Kr&&(l.lat=Kr-n),o+l.lat<ht&&(l.lat=ht-o),d+l.lng<=en&&(l.lng+=Math.ceil(Math.abs(l.lng)/360)*360),c+l.lng>=tn&&(l.lng-=Math.ceil(Math.abs(l.lng)/360)*360),l}function kr(e,t){const r=Fr(e.map(n=>n.toGeoJSON()),t);e.forEach(n=>{const i=n.getCoordinates(),o=f=>{const u={lng:f[0]+r.lng,lat:f[1]+r.lat};return[u.lng,u.lat]},d=f=>f.map(u=>o(u)),c=f=>f.map(u=>d(u));let l;n.type===B.POINT?l=o(i):n.type===B.LINE_STRING||n.type===B.MULTI_POINT?l=i.map(o):n.type===B.POLYGON||n.type===B.MULTI_LINE_STRING?l=i.map(d):n.type===B.MULTI_POLYGON&&(l=i.map(c)),n.incomingCoords(l)})}const re={};re.onSetup=function(e){const t={dragMoveLocation:null,boxSelectStartLocation:null,boxSelectElement:void 0,boxSelecting:!1,canBoxSelect:!1,dragMoving:!1,canDragMove:!1,initialDragPanState:this.map.dragPan.isEnabled(),initiallySelectedFeatureIds:e.featureIds||[]};return this.setSelected(t.initiallySelectedFeatureIds.filter(r=>this.getFeature(r)!==void 0)),this.fireActionable(),this.setActionableState({combineFeatures:!0,uncombineFeatures:!0,trash:!0}),t};re.fireUpdate=function(){this.fire(ge.UPDATE,{action:nt.MOVE,features:this.getSelected().map(e=>e.toGeoJSON())})};re.fireActionable=function(){const e=this.getSelected(),t=e.filter(o=>this.isInstanceOf("MultiFeature",o));let r=!1;if(e.length>1){r=!0;const o=e[0].type.replace("Multi","");e.forEach(d=>{d.type.replace("Multi","")!==o&&(r=!1)})}const n=t.length>0,i=e.length>0;this.setActionableState({combineFeatures:r,uncombineFeatures:n,trash:i})};re.getUniqueIds=function(e){return e.length?e.map(r=>r.properties.id).filter(r=>r!==void 0).reduce((r,n)=>(r.add(n),r),new Te).values():[]};re.stopExtendedInteractions=function(e){e.boxSelectElement&&(e.boxSelectElement.parentNode&&e.boxSelectElement.parentNode.removeChild(e.boxSelectElement),e.boxSelectElement=null),(e.canDragMove||e.canBoxSelect)&&e.initialDragPanState===!0&&this.map.dragPan.enable(),e.boxSelecting=!1,e.canBoxSelect=!1,e.dragMoving=!1,e.canDragMove=!1};re.onStop=function(){Ce.enable(this)};re.onMouseMove=function(e,t){return Rr(t)&&e.dragMoving&&this.fireUpdate(),this.stopExtendedInteractions(e),!0};re.onMouseOut=function(e){return e.dragMoving?this.fireUpdate():!0};re.onTap=re.onClick=function(e,t){if(bt(t))return this.clickAnywhere(e,t);if(_t(de.VERTEX)(t))return this.clickOnVertex(e,t);if(Rr(t))return this.clickOnFeature(e,t)};re.clickAnywhere=function(e){const t=this.getSelectedIds();t.length&&(this.clearSelectedFeatures(),t.forEach(r=>this.doRender(r))),Ce.enable(this),this.stopExtendedInteractions(e)};re.clickOnVertex=function(e,t){this.changeMode(X.DIRECT_SELECT,{featureId:t.featureTarget.properties.parent,coordPath:t.featureTarget.properties.coord_path,startPos:t.lngLat}),this.updateUIClasses({mouse:se.MOVE})};re.startOnActiveFeature=function(e,t){this.stopExtendedInteractions(e),this.map.dragPan.disable(),this.doRender(t.featureTarget.properties.id),e.canDragMove=!0,e.dragMoveLocation=t.lngLat};re.clickOnFeature=function(e,t){Ce.disable(this),this.stopExtendedInteractions(e);const r=mt(t),n=this.getSelectedIds(),i=t.featureTarget.properties.id,o=this.isSelected(i);if(!r&&o&&this.getFeature(i).type!==B.POINT)return this.changeMode(X.DIRECT_SELECT,{featureId:i});o&&r?(this.deselect(i),this.updateUIClasses({mouse:se.POINTER}),n.length===1&&Ce.enable(this)):!o&&r?(this.select(i),this.updateUIClasses({mouse:se.MOVE})):!o&&!r&&(n.forEach(d=>this.doRender(d)),this.setSelected(i),this.updateUIClasses({mouse:se.MOVE})),this.doRender(i)};re.onMouseDown=function(e,t){if(e.initialDragPanState=this.map.dragPan.isEnabled(),Be(t))return this.startOnActiveFeature(e,t);if(this.drawConfig.boxSelect&&hi(t))return this.startBoxSelect(e,t)};re.startBoxSelect=function(e,t){this.stopExtendedInteractions(e),this.map.dragPan.disable(),e.boxSelectStartLocation=Pr(t.originalEvent,this.map.getContainer()),e.canBoxSelect=!0};re.onTouchStart=function(e,t){if(Be(t))return this.startOnActiveFeature(e,t)};re.onDrag=function(e,t){if(e.canDragMove)return this.dragMove(e,t);if(this.drawConfig.boxSelect&&e.canBoxSelect)return this.whileBoxSelect(e,t)};re.whileBoxSelect=function(e,t){e.boxSelecting=!0,this.updateUIClasses({mouse:se.ADD}),e.boxSelectElement||(e.boxSelectElement=document.createElement("div"),e.boxSelectElement.classList.add(ye.BOX_SELECT),this.map.getContainer().appendChild(e.boxSelectElement));const r=Pr(t.originalEvent,this.map.getContainer()),n=Math.min(e.boxSelectStartLocation.x,r.x),i=Math.max(e.boxSelectStartLocation.x,r.x),o=Math.min(e.boxSelectStartLocation.y,r.y),d=Math.max(e.boxSelectStartLocation.y,r.y),c=`translate(${n}px, ${o}px)`;e.boxSelectElement.style.transform=c,e.boxSelectElement.style.WebkitTransform=c,e.boxSelectElement.style.width=`${i-n}px`,e.boxSelectElement.style.height=`${d-o}px`};re.dragMove=function(e,t){e.dragMoving=!0,t.originalEvent.stopPropagation();const r={lng:t.lngLat.lng-e.dragMoveLocation.lng,lat:t.lngLat.lat-e.dragMoveLocation.lat};kr(this.getSelected(),r),e.dragMoveLocation=t.lngLat};re.onTouchEnd=re.onMouseUp=function(e,t){if(e.dragMoving)this.fireUpdate();else if(e.boxSelecting){const r=[e.boxSelectStartLocation,Pr(t.originalEvent,this.map.getContainer())],n=this.featuresAt(null,r,"click"),i=this.getUniqueIds(n).filter(o=>!this.isSelected(o));i.length&&(this.select(i),i.forEach(o=>this.doRender(o)),this.updateUIClasses({mouse:se.MOVE}))}this.stopExtendedInteractions(e)};re.toDisplayFeatures=function(e,t,r){t.properties.active=this.isSelected(t.properties.id)?fe.ACTIVE:fe.INACTIVE,r(t),this.fireActionable(),!(t.properties.active!==fe.ACTIVE||t.geometry.type===B.POINT)&&St(t).forEach(r)};re.onTrash=function(){this.deleteFeature(this.getSelectedIds()),this.fireActionable()};re.onCombineFeatures=function(){const e=this.getSelected();if(e.length===0||e.length<2)return;const t=[],r=[],n=e[0].type.replace("Multi","");for(let i=0;i<e.length;i++){const o=e[i];if(o.type.replace("Multi","")!==n)return;o.type.includes("Multi")?o.getCoordinates().forEach(d=>{t.push(d)}):t.push(o.getCoordinates()),r.push(o.toGeoJSON())}if(r.length>1){const i=this.newFeature({type:B.FEATURE,properties:r[0].properties,geometry:{type:`Multi${n}`,coordinates:t}});this.addFeature(i),this.deleteFeature(this.getSelectedIds(),{silent:!0}),this.setSelected([i.id]),this.fire(ge.COMBINE_FEATURES,{createdFeatures:[i.toGeoJSON()],deletedFeatures:r})}this.fireActionable()};re.onUncombineFeatures=function(){const e=this.getSelected();if(e.length===0)return;const t=[],r=[];for(let n=0;n<e.length;n++){const i=e[n];this.isInstanceOf("MultiFeature",i)&&(i.getFeatures().forEach(o=>{this.addFeature(o),o.properties=i.properties,t.push(o.toGeoJSON()),this.select([o.id])}),this.deleteFeature(i.id,{silent:!0}),r.push(i.toGeoJSON()))}t.length>1&&this.fire(ge.UNCOMBINE_FEATURES,{createdFeatures:t,deletedFeatures:r}),this.fireActionable()};const pi=_t(de.VERTEX),mi=_t(de.MIDPOINT),ne={};ne.fireUpdate=function(){this.fire(ge.UPDATE,{action:nt.CHANGE_COORDINATES,features:this.getSelected().map(e=>e.toGeoJSON())})};ne.fireActionable=function(e){this.setActionableState({combineFeatures:!1,uncombineFeatures:!1,trash:e.selectedCoordPaths.length>0})};ne.startDragging=function(e,t){e.initialDragPanState=this.map.dragPan.isEnabled(),this.map.dragPan.disable(),e.canDragMove=!0,e.dragMoveLocation=t.lngLat};ne.stopDragging=function(e){e.canDragMove&&e.initialDragPanState===!0&&this.map.dragPan.enable(),e.dragMoving=!1,e.canDragMove=!1,e.dragMoveLocation=null};ne.onVertex=function(e,t){this.startDragging(e,t);const r=t.featureTarget.properties,n=e.selectedCoordPaths.indexOf(r.coord_path);!mt(t)&&n===-1?e.selectedCoordPaths=[r.coord_path]:mt(t)&&n===-1&&e.selectedCoordPaths.push(r.coord_path);const i=this.pathsToCoordinates(e.featureId,e.selectedCoordPaths);this.setSelectedCoordinates(i)};ne.onMidpoint=function(e,t){this.startDragging(e,t);const r=t.featureTarget.properties;e.feature.addCoordinate(r.coord_path,r.lng,r.lat),this.fireUpdate(),e.selectedCoordPaths=[r.coord_path]};ne.pathsToCoordinates=function(e,t){return t.map(r=>({feature_id:e,coord_path:r}))};ne.onFeature=function(e,t){e.selectedCoordPaths.length===0?this.startDragging(e,t):this.stopDragging(e)};ne.dragFeature=function(e,t,r){kr(this.getSelected(),r),e.dragMoveLocation=t.lngLat};ne.dragVertex=function(e,t,r){const n=e.selectedCoordPaths.map(d=>e.feature.getCoordinate(d)),i=n.map(d=>({type:B.FEATURE,properties:{},geometry:{type:B.POINT,coordinates:d}})),o=Fr(i,r);for(let d=0;d<n.length;d++){const c=n[d];e.feature.updateCoordinate(e.selectedCoordPaths[d],c[0]+o.lng,c[1]+o.lat)}};ne.clickNoTarget=function(){this.changeMode(X.SIMPLE_SELECT)};ne.clickInactive=function(){this.changeMode(X.SIMPLE_SELECT)};ne.clickActiveFeature=function(e){e.selectedCoordPaths=[],this.clearSelectedCoordinates(),e.feature.changed()};ne.onSetup=function(e){const t=e.featureId,r=this.getFeature(t);if(!r)throw new Error("You must provide a featureId to enter direct_select mode");if(r.type===B.POINT)throw new TypeError("direct_select mode doesn't handle point features");const n={featureId:t,feature:r,dragMoveLocation:e.startPos||null,dragMoving:!1,canDragMove:!1,selectedCoordPaths:e.coordPath?[e.coordPath]:[]};return this.setSelectedCoordinates(this.pathsToCoordinates(t,n.selectedCoordPaths)),this.setSelected(t),Ce.disable(this),this.setActionableState({trash:!0}),n};ne.onStop=function(){Ce.enable(this),this.clearSelectedCoordinates()};ne.toDisplayFeatures=function(e,t,r){e.featureId===t.properties.id?(t.properties.active=fe.ACTIVE,r(t),St(t,{map:this.map,midpoints:!0,selectedPaths:e.selectedCoordPaths}).forEach(r)):(t.properties.active=fe.INACTIVE,r(t)),this.fireActionable(e)};ne.onTrash=function(e){e.selectedCoordPaths.sort((t,r)=>r.localeCompare(t,"en",{numeric:!0})).forEach(t=>e.feature.removeCoordinate(t)),this.fireUpdate(),e.selectedCoordPaths=[],this.clearSelectedCoordinates(),this.fireActionable(e),e.feature.isValid()===!1&&(this.deleteFeature([e.featureId]),this.changeMode(X.SIMPLE_SELECT,{}))};ne.onMouseMove=function(e,t){const r=Be(t),n=pi(t),i=mi(t),o=e.selectedCoordPaths.length===0;return r&&o?this.updateUIClasses({mouse:se.MOVE}):n&&!o?this.updateUIClasses({mouse:se.MOVE}):this.updateUIClasses({mouse:se.NONE}),(n||r||i)&&e.dragMoving&&this.fireUpdate(),this.stopDragging(e),!0};ne.onMouseOut=function(e){return e.dragMoving&&this.fireUpdate(),!0};ne.onTouchStart=ne.onMouseDown=function(e,t){if(pi(t))return this.onVertex(e,t);if(Be(t))return this.onFeature(e,t);if(mi(t))return this.onMidpoint(e,t)};ne.onDrag=function(e,t){if(e.canDragMove!==!0)return;e.dragMoving=!0,t.originalEvent.stopPropagation();const r={lng:t.lngLat.lng-e.dragMoveLocation.lng,lat:t.lngLat.lat-e.dragMoveLocation.lat};e.selectedCoordPaths.length>0?this.dragVertex(e,t,r):this.dragFeature(e,t,r),e.dragMoveLocation=t.lngLat};ne.onClick=function(e,t){if(bt(t))return this.clickNoTarget(e,t);if(Be(t))return this.clickActiveFeature(e,t);if(xr(t))return this.clickInactive(e,t);this.stopDragging(e)};ne.onTap=function(e,t){if(bt(t))return this.clickNoTarget(e,t);if(Be(t))return this.clickActiveFeature(e,t);if(xr(t))return this.clickInactive(e,t)};ne.onTouchEnd=ne.onMouseUp=function(e){e.dragMoving&&this.fireUpdate(),this.stopDragging(e)};const Oe={};Oe.onSetup=function(){const e=this.newFeature({type:B.FEATURE,properties:{},geometry:{type:B.POINT,coordinates:[]}});return this.addFeature(e),this.clearSelectedFeatures(),this.updateUIClasses({mouse:se.ADD}),this.activateUIButton(_e.POINT),this.setActionableState({trash:!0}),{point:e}};Oe.stopDrawingAndRemove=function(e){this.deleteFeature([e.point.id],{silent:!0}),this.changeMode(X.SIMPLE_SELECT)};Oe.onTap=Oe.onClick=function(e,t){this.updateUIClasses({mouse:se.MOVE}),e.point.updateCoordinate("",t.lngLat.lng,t.lngLat.lat),this.fire(ge.CREATE,{features:[e.point.toGeoJSON()]}),this.changeMode(X.SIMPLE_SELECT,{featureIds:[e.point.id]})};Oe.onStop=function(e){this.activateUIButton(),e.point.getCoordinate().length||this.deleteFeature([e.point.id],{silent:!0})};Oe.toDisplayFeatures=function(e,t,r){const n=t.properties.id===e.point.id;if(t.properties.active=n?fe.ACTIVE:fe.INACTIVE,!n)return r(t)};Oe.onTrash=Oe.stopDrawingAndRemove;Oe.onKeyUp=function(e,t){if(wt(t)||Et(t))return this.stopDrawingAndRemove(e,t)};function gt(e,t){return e.lngLat?e.lngLat.lng===t[0]&&e.lngLat.lat===t[1]:!1}const Le={};Le.onSetup=function(){const e=this.newFeature({type:B.FEATURE,properties:{},geometry:{type:B.POLYGON,coordinates:[[]]}});return this.addFeature(e),this.clearSelectedFeatures(),Ce.disable(this),this.updateUIClasses({mouse:se.ADD}),this.activateUIButton(_e.POLYGON),this.setActionableState({trash:!0}),{polygon:e,currentVertexPosition:0}};Le.clickAnywhere=function(e,t){if(e.currentVertexPosition>0&&gt(t,e.polygon.coordinates[0][e.currentVertexPosition-1]))return this.changeMode(X.SIMPLE_SELECT,{featureIds:[e.polygon.id]});this.updateUIClasses({mouse:se.ADD}),e.polygon.updateCoordinate(`0.${e.currentVertexPosition}`,t.lngLat.lng,t.lngLat.lat),e.currentVertexPosition++,e.polygon.updateCoordinate(`0.${e.currentVertexPosition}`,t.lngLat.lng,t.lngLat.lat)};Le.clickOnVertex=function(e){return this.changeMode(X.SIMPLE_SELECT,{featureIds:[e.polygon.id]})};Le.onMouseMove=function(e,t){e.polygon.updateCoordinate(`0.${e.currentVertexPosition}`,t.lngLat.lng,t.lngLat.lat),ot(t)&&this.updateUIClasses({mouse:se.POINTER})};Le.onTap=Le.onClick=function(e,t){return ot(t)?this.clickOnVertex(e,t):this.clickAnywhere(e,t)};Le.onKeyUp=function(e,t){wt(t)?(this.deleteFeature([e.polygon.id],{silent:!0}),this.changeMode(X.SIMPLE_SELECT)):Et(t)&&this.changeMode(X.SIMPLE_SELECT,{featureIds:[e.polygon.id]})};Le.onStop=function(e){this.updateUIClasses({mouse:se.NONE}),Ce.enable(this),this.activateUIButton(),this.getFeature(e.polygon.id)!==void 0&&(e.polygon.removeCoordinate(`0.${e.currentVertexPosition}`),e.polygon.isValid()?this.fire(ge.CREATE,{features:[e.polygon.toGeoJSON()]}):(this.deleteFeature([e.polygon.id],{silent:!0}),this.changeMode(X.SIMPLE_SELECT,{},{silent:!0})))};Le.toDisplayFeatures=function(e,t,r){const n=t.properties.id===e.polygon.id;if(t.properties.active=n?fe.ACTIVE:fe.INACTIVE,!n)return r(t);if(t.geometry.coordinates.length===0)return;const i=t.geometry.coordinates[0].length;if(!(i<3)){if(t.properties.meta=de.FEATURE,r(We(e.polygon.id,t.geometry.coordinates[0][0],"0.0",!1)),i>3){const o=t.geometry.coordinates[0].length-3;r(We(e.polygon.id,t.geometry.coordinates[0][o],`0.${o}`,!1))}if(i<=4){const o=[[t.geometry.coordinates[0][0][0],t.geometry.coordinates[0][0][1]],[t.geometry.coordinates[0][1][0],t.geometry.coordinates[0][1][1]]];if(r({type:B.FEATURE,properties:t.properties,geometry:{coordinates:o,type:B.LINE_STRING}}),i===3)return}return r(t)}};Le.onTrash=function(e){this.deleteFeature([e.polygon.id],{silent:!0}),this.changeMode(X.SIMPLE_SELECT)};const Me={};Me.onSetup=function(e){e=e||{};const t=e.featureId;let r,n,i="forward";if(t){if(r=this.getFeature(t),!r)throw new Error("Could not find a feature with the provided featureId");let o=e.from;if(o&&o.type==="Feature"&&o.geometry&&o.geometry.type==="Point"&&(o=o.geometry),o&&o.type==="Point"&&o.coordinates&&o.coordinates.length===2&&(o=o.coordinates),!o||!Array.isArray(o))throw new Error("Please use the `from` property to indicate which point to continue the line from");const d=r.coordinates.length-1;if(r.coordinates[d][0]===o[0]&&r.coordinates[d][1]===o[1])n=d+1,r.addCoordinate(n,...r.coordinates[d]);else if(r.coordinates[0][0]===o[0]&&r.coordinates[0][1]===o[1])i="backwards",n=0,r.addCoordinate(n,...r.coordinates[0]);else throw new Error("`from` should match the point at either the start or the end of the provided LineString")}else r=this.newFeature({type:B.FEATURE,properties:{},geometry:{type:B.LINE_STRING,coordinates:[]}}),n=0,this.addFeature(r);return this.clearSelectedFeatures(),Ce.disable(this),this.updateUIClasses({mouse:se.ADD}),this.activateUIButton(_e.LINE),this.setActionableState({trash:!0}),{line:r,currentVertexPosition:n,direction:i}};Me.clickAnywhere=function(e,t){if(e.currentVertexPosition>0&&gt(t,e.line.coordinates[e.currentVertexPosition-1])||e.direction==="backwards"&&gt(t,e.line.coordinates[e.currentVertexPosition+1]))return this.changeMode(X.SIMPLE_SELECT,{featureIds:[e.line.id]});this.updateUIClasses({mouse:se.ADD}),e.line.updateCoordinate(e.currentVertexPosition,t.lngLat.lng,t.lngLat.lat),e.direction==="forward"?(e.currentVertexPosition++,e.line.updateCoordinate(e.currentVertexPosition,t.lngLat.lng,t.lngLat.lat)):e.line.addCoordinate(0,t.lngLat.lng,t.lngLat.lat)};Me.clickOnVertex=function(e){return this.changeMode(X.SIMPLE_SELECT,{featureIds:[e.line.id]})};Me.onMouseMove=function(e,t){e.line.updateCoordinate(e.currentVertexPosition,t.lngLat.lng,t.lngLat.lat),ot(t)&&this.updateUIClasses({mouse:se.POINTER})};Me.onTap=Me.onClick=function(e,t){if(ot(t))return this.clickOnVertex(e,t);this.clickAnywhere(e,t)};Me.onKeyUp=function(e,t){Et(t)?this.changeMode(X.SIMPLE_SELECT,{featureIds:[e.line.id]}):wt(t)&&(this.deleteFeature([e.line.id],{silent:!0}),this.changeMode(X.SIMPLE_SELECT))};Me.onStop=function(e){Ce.enable(this),this.activateUIButton(),this.getFeature(e.line.id)!==void 0&&(e.line.removeCoordinate(`${e.currentVertexPosition}`),e.line.isValid()?this.fire(ge.CREATE,{features:[e.line.toGeoJSON()]}):(this.deleteFeature([e.line.id],{silent:!0}),this.changeMode(X.SIMPLE_SELECT,{},{silent:!0})))};Me.onTrash=function(e){this.deleteFeature([e.line.id],{silent:!0}),this.changeMode(X.SIMPLE_SELECT)};Me.toDisplayFeatures=function(e,t,r){const n=t.properties.id===e.line.id;if(t.properties.active=n?fe.ACTIVE:fe.INACTIVE,!n)return r(t);t.geometry.coordinates.length<2||(t.properties.meta=de.FEATURE,r(We(e.line.id,t.geometry.coordinates[e.direction==="forward"?t.geometry.coordinates.length-2:1],`${e.direction==="forward"?t.geometry.coordinates.length-2:1}`,!1)),r(t))};const gi={simple_select:re,direct_select:ne,draw_point:Oe,draw_polygon:Le,draw_line_string:Me},Zo={defaultMode:X.SIMPLE_SELECT,keybindings:!0,touchEnabled:!0,clickBuffer:2,touchBuffer:25,boxSelect:!0,displayControlsDefault:!0,styles:fi,modes:gi,controls:{},userProperties:!1,suppressAPIEvents:!0},Qo={point:!0,line_string:!0,polygon:!0,trash:!0,combine_features:!0,uncombine_features:!0},Ko={point:!1,line_string:!1,polygon:!1,trash:!1,combine_features:!1,uncombine_features:!1};function rn(e,t){return e.map(r=>r.source?r:Object.assign({},r,{id:`${r.id}.${t}`,source:t==="hot"?Se.HOT:Se.COLD}))}function $o(e={}){let t=Object.assign({},e);return e.controls||(t.controls={}),e.displayControlsDefault===!1?t.controls=Object.assign({},Ko,e.controls):t.controls=Object.assign({},Qo,e.controls),t=Object.assign({},Zo,t),t.styles=rn(t.styles,"cold").concat(rn(t.styles,"hot")),t}var es=function e(t,r){if(t===r)return!0;if(t&&r&&typeof t=="object"&&typeof r=="object"){if(t.constructor!==r.constructor)return!1;var n,i,o;if(Array.isArray(t)){if(n=t.length,n!=r.length)return!1;for(i=n;i--!==0;)if(!e(t[i],r[i]))return!1;return!0}if(t.constructor===RegExp)return t.source===r.source&&t.flags===r.flags;if(t.valueOf!==Object.prototype.valueOf)return t.valueOf()===r.valueOf();if(t.toString!==Object.prototype.toString)return t.toString()===r.toString();if(o=Object.keys(t),n=o.length,n!==Object.keys(r).length)return!1;for(i=n;i--!==0;)if(!Object.prototype.hasOwnProperty.call(r,o[i]))return!1;for(i=n;i--!==0;){var d=o[i];if(!e(t[d],r[d]))return!1}return!0}return t!==t&&r!==r};const nn=Mr(es);var ts=ns,rs={Point:"geometry",MultiPoint:"geometry",LineString:"geometry",MultiLineString:"geometry",Polygon:"geometry",MultiPolygon:"geometry",GeometryCollection:"geometry",Feature:"feature",FeatureCollection:"featurecollection"};function ns(e){if(!e||!e.type)return null;var t=rs[e.type];if(!t)return null;if(t==="geometry")return{type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:e}]};if(t==="feature")return{type:"FeatureCollection",features:[e]};if(t==="featurecollection")return e}const is=Mr(ts);function vi(e,t){return e.length!==t.length?!1:JSON.stringify(e.map(r=>r).sort())===JSON.stringify(t.map(r=>r).sort())}const os={Polygon:we,LineString:Ie,Point:ke,MultiPolygon:me,MultiLineString:me,MultiPoint:me};function ss(e,t){t.modes=X;const r=e.options.suppressAPIEvents!==void 0?!!e.options.suppressAPIEvents:!0;return t.getFeatureIdsAt=function(n){return je.click({point:n},null,e).map(o=>o.properties.id)},t.getSelectedIds=function(){return e.store.getSelectedIds()},t.getSelected=function(){return{type:B.FEATURE_COLLECTION,features:e.store.getSelectedIds().map(n=>e.store.get(n)).map(n=>n.toGeoJSON())}},t.getSelectedPoints=function(){return{type:B.FEATURE_COLLECTION,features:e.store.getSelectedCoordinates().map(n=>({type:B.FEATURE,properties:{},geometry:{type:B.POINT,coordinates:n.coordinates}}))}},t.set=function(n){if(n.type===void 0||n.type!==B.FEATURE_COLLECTION||!Array.isArray(n.features))throw new Error("Invalid FeatureCollection");const i=e.store.createRenderBatch();let o=e.store.getAllIds().slice();const d=t.add(n),c=new Te(d);return o=o.filter(l=>!c.has(l)),o.length&&t.delete(o),i(),d},t.add=function(n){const o=JSON.parse(JSON.stringify(is(n))).features.map(d=>{if(d.id=d.id||Nr(),d.geometry===null)throw new Error("Invalid geometry: null");if(e.store.get(d.id)===void 0||e.store.get(d.id).type!==d.geometry.type){const c=os[d.geometry.type];if(c===void 0)throw new Error(`Invalid geometry type: ${d.geometry.type}.`);const l=new c(e,d);e.store.add(l,{silent:r})}else{const c=e.store.get(d.id),l=c.properties;c.properties=d.properties,nn(l,d.properties)||e.store.featureChanged(c.id,{silent:r}),nn(c.getCoordinates(),d.geometry.coordinates)||c.incomingCoords(d.geometry.coordinates)}return d.id});return e.store.render(),o},t.get=function(n){const i=e.store.get(n);if(i)return i.toGeoJSON()},t.getAll=function(){return{type:B.FEATURE_COLLECTION,features:e.store.getAll().map(n=>n.toGeoJSON())}},t.delete=function(n){return e.store.delete(n,{silent:r}),t.getMode()===X.DIRECT_SELECT&&!e.store.getSelectedIds().length?e.events.changeMode(X.SIMPLE_SELECT,void 0,{silent:r}):e.store.render(),t},t.deleteAll=function(){return e.store.delete(e.store.getAllIds(),{silent:r}),t.getMode()===X.DIRECT_SELECT?e.events.changeMode(X.SIMPLE_SELECT,void 0,{silent:r}):e.store.render(),t},t.changeMode=function(n,i={}){return n===X.SIMPLE_SELECT&&t.getMode()===X.SIMPLE_SELECT?(vi(i.featureIds||[],e.store.getSelectedIds())||(e.store.setSelected(i.featureIds,{silent:r}),e.store.render()),t):(n===X.DIRECT_SELECT&&t.getMode()===X.DIRECT_SELECT&&i.featureId===e.store.getSelectedIds()[0]||e.events.changeMode(n,i,{silent:r}),t)},t.getMode=function(){return e.events.getMode()},t.trash=function(){return e.events.trash({silent:r}),t},t.combineFeatures=function(){return e.events.combineFeatures({silent:r}),t},t.uncombineFeatures=function(){return e.events.uncombineFeatures({silent:r}),t},t.setFeatureProperty=function(n,i,o){return e.store.setFeatureProperty(n,i,o,{silent:r}),t},t}const as=Object.freeze(Object.defineProperty({__proto__:null,CommonSelectors:Xo,ModeHandler:wr,StringSet:Te,constrainFeatureMovement:Fr,createMidPoint:di,createSupplementaryPoints:St,createVertex:We,doubleClickZoom:Ce,euclideanDistance:Ar,featuresAt:je,getFeatureAtAndSetCursors:pt,isClick:Cr,isEventAtCoordinates:gt,isTap:Lr,mapEventToBoundingBox:ai,moveFeatures:kr,sortFeatures:si,stringSetsAreEqual:vi,theme:fi,toDenseArray:it},Symbol.toStringTag,{value:"Module"})),us=function(e,t){e=$o(e);const r={options:e};t=ss(r,t),r.api=t;const n=Jo(r);return t.onAdd=n.onAdd,t.onRemove=n.onRemove,t.types=_e,t.options=e,t};function Tt(e){us(e,this)}Tt.modes=gi;Tt.constants=oi;Tt.lib=as;/*
object-assign
(c) Sindre Sorhus
@license MIT
*/var on=Object.getOwnPropertySymbols,cs=Object.prototype.hasOwnProperty,ls=Object.prototype.propertyIsEnumerable;function fs(e){if(e==null)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(e)}function hs(){try{if(!Object.assign)return!1;var e=new String("abc");if(e[5]="de",Object.getOwnPropertyNames(e)[0]==="5")return!1;for(var t={},r=0;r<10;r++)t["_"+String.fromCharCode(r)]=r;var n=Object.getOwnPropertyNames(t).map(function(o){return t[o]});if(n.join("")!=="0123456789")return!1;var i={};return"abcdefghijklmnopqrst".split("").forEach(function(o){i[o]=o}),Object.keys(Object.assign({},i)).join("")==="abcdefghijklmnopqrst"}catch{return!1}}var Ge=hs()?Object.assign:function(e,t){for(var r,n=fs(e),i,o=1;o<arguments.length;o++){r=Object(arguments[o]);for(var d in r)cs.call(r,d)&&(n[d]=r[d]);if(on){i=on(r);for(var c=0;c<i.length;c++)ls.call(r,i[c])&&(n[i[c]]=r[i[c]])}}return n},Ot={exports:{}},It,sn;function Ur(){return sn||(sn=1,It=function(e,t,r){t.forEach(function(n){var i=r[n];e.prototype[n]=function(o){return o.ros=this,new i(o)}})}),It}var At,an;function yi(){return an||(an=1,At=typeof window<"u"?window.WebSocket:WebSocket),At}var Nt,un;function ds(){if(un)return Nt;un=1;var e=arguments[3],t=arguments[4],r=arguments[5],n=JSON.stringify;return Nt=function(i,o){for(var d,c=Object.keys(r),l=0,f=c.length;l<f;l++){var u=c[l],p=r[u].exports;if(p===i||p&&p.default===i){d=u;break}}if(!d){d=Math.floor(Math.pow(16,8)*Math.random()).toString(16);for(var a={},l=0,f=c.length;l<f;l++){var u=c[l];a[u]=u}t[d]=["function(require,module,exports){"+i+"(self); }",a]}var h=Math.floor(Math.pow(16,8)*Math.random()).toString(16),_={};_[d]=d,t[h]=["function(require,module,exports){var f = require("+n(d)+");(f.default ? f.default : f)(self);}",_];var L={};T(h);function T(j){L[j]=!0;for(var te in t[j][1]){var ee=t[j][1][te];L[ee]||T(ee)}}var O="("+e+")({"+Object.keys(L).map(function(j){return n(j)+":["+t[j][0]+","+n(t[j][1])+"]"}).join(",")+"},{},["+n(h)+"])",N=window.URL||window.webkitURL||window.mozURL||window.msURL,R=new Blob([O],{type:"text/javascript"});if(o&&o.bare)return R;var q=N.createObjectURL(R),F=new Worker(q);return F.objectURL=q,F},Nt}var xt={exports:{}},cn;function ps(){return cn||(cn=1,function(e){function t(f){var u={};function p(h){if(u[h])return u[h].exports;var _=u[h]={i:h,l:!1,exports:{}};return f[h].call(_.exports,_,_.exports,p),_.l=!0,_.exports}p.m=f,p.c=u,p.i=function(h){return h},p.d=function(h,_,L){p.o(h,_)||Object.defineProperty(h,_,{configurable:!1,enumerable:!0,get:L})},p.r=function(h){Object.defineProperty(h,"__esModule",{value:!0})},p.n=function(h){var _=h&&h.__esModule?function(){return h.default}:function(){return h};return p.d(_,"a",_),_},p.o=function(h,_){return Object.prototype.hasOwnProperty.call(h,_)},p.p="/",p.oe=function(h){throw console.error(h),h};var a=p(p.s=ENTRY_MODULE);return a.default||a}var r="[\\.|\\-|\\+|\\w|/|@]+",n="\\(\\s*(/\\*.*?\\*/)?\\s*.*?("+r+").*?\\)";function i(f){return(f+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function o(f){return!isNaN(1*f)}function d(f,u,p){var a={};a[p]=[];var h=u.toString(),_=h.match(/^function\s?\w*\(\w+,\s*\w+,\s*(\w+)\)/);if(!_)return a;for(var L=_[1],T=new RegExp("(\\\\n|\\W)"+i(L)+n,"g"),O;O=T.exec(h);)O[3]!=="dll-reference"&&a[p].push(O[3]);for(T=new RegExp("\\("+i(L)+'\\("(dll-reference\\s('+r+'))"\\)\\)'+n,"g");O=T.exec(h);)f[O[2]]||(a[p].push(O[1]),f[O[2]]=__webpack_require__(O[1]).m),a[O[2]]=a[O[2]]||[],a[O[2]].push(O[4]);for(var N=Object.keys(a),R=0;R<N.length;R++)for(var q=0;q<a[N[R]].length;q++)o(a[N[R]][q])&&(a[N[R]][q]=1*a[N[R]][q]);return a}function c(f){var u=Object.keys(f);return u.reduce(function(p,a){return p||f[a].length>0},!1)}function l(f,u){for(var p={main:[u]},a={main:[]},h={main:{}};c(p);)for(var _=Object.keys(p),L=0;L<_.length;L++){var T=_[L],O=p[T],N=O.pop();if(h[T]=h[T]||{},!(h[T][N]||!f[T][N])){h[T][N]=!0,a[T]=a[T]||[],a[T].push(N);for(var R=d(f,f[T][N],T),q=Object.keys(R),F=0;F<q.length;F++)p[q[F]]=p[q[F]]||[],p[q[F]]=p[q[F]].concat(R[q[F]])}}return a}e.exports=function(f,u){u=u||{};var p={main:__webpack_modules__},a=u.all?{main:Object.keys(p.main)}:l(p,f),h="";Object.keys(a).filter(function(N){return N!=="main"}).forEach(function(N){for(var R=0;a[N][R];)R++;a[N].push(R),p[N][R]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",h=h+"var "+N+" = ("+t.toString().replace("ENTRY_MODULE",JSON.stringify(R))+")({"+a[N].map(function(q){return""+JSON.stringify(q)+": "+p[N][q].toString()}).join(",")+`});
`}),h=h+"new (("+t.toString().replace("ENTRY_MODULE",JSON.stringify(f))+")({"+a.main.map(function(N){return""+JSON.stringify(N)+": "+p.main[N].toString()}).join(",")+"}))(self);";var _=new window.Blob([h],{type:"text/javascript"});if(u.bare)return _;var L=window.URL||window.webkitURL||window.mozURL||window.msURL,T=L.createObjectURL(_),O=new window.Worker(T);return O.objectURL=T,O}}(xt)),xt.exports}var Rt,ln;function ms(){if(ln)return Rt;ln=1;var e=e||yi();return Rt=function(t){var r=null;function n(o){var d=o.data;d instanceof ArrayBuffer?t.postMessage(d,[d]):t.postMessage(d)}function i(o){t.postMessage({type:o.type})}t.addEventListener("message",function(o){var d=o.data;if(typeof d=="string")r.send(d);else if(d.hasOwnProperty("close"))r.close(),r=null;else if(d.hasOwnProperty("uri")){var c=d.uri;r=new e(c),r.binaryType="arraybuffer",r.onmessage=n,r.onclose=i,r.onopen=i,r.onerror=i}else throw"Unknown message to WorkerSocket"})},Rt}var Pt,fn;function gs(){if(fn)return Pt;fn=1;try{var e=ds()}catch{var e=ps()}var t=ms();function r(n){this.socket_=e(t),this.socket_.addEventListener("message",this.handleWorkerMessage_.bind(this)),this.socket_.postMessage({uri:n})}return r.prototype.handleWorkerMessage_=function(n){var i=n.data;if(i instanceof ArrayBuffer||typeof i=="string")this.onmessage(n);else{var o=i.type;if(o==="close")this.onclose(null);else if(o==="open")this.onopen(null);else if(o==="error")this.onerror(null);else throw"Unknown message from workersocket"}},r.prototype.send=function(n){this.socket_.postMessage(n)},r.prototype.close=function(){this.socket_.postMessage({close:!0})},Pt=r,Pt}var Ft,hn;function vs(){return hn||(hn=1,Ft=function(){return document.createElement("canvas")}),Ft}var kt,dn;function ys(){if(dn)return kt;dn=1;var e=vs(),t=e.Image||window.Image;function r(n,i){var o=new t;o.onload=function(){var d=new e,c=d.getContext("2d");d.width=o.width,d.height=o.height,c.imageSmoothingEnabled=!1,c.webkitImageSmoothingEnabled=!1,c.mozImageSmoothingEnabled=!1,c.drawImage(o,0,0);for(var l=c.getImageData(0,0,o.width,o.height).data,f="",u=0;u<l.length;u+=4)f+=String.fromCharCode(l[u],l[u+1],l[u+2]);i(JSON.parse(f))},o.src="data:image/png;base64,"+n}return kt=r,kt}var Ut={exports:{}},pn;function _s(){return pn||(pn=1,function(e){(function(t,r){var n=Math.pow(2,-24),i=Math.pow(2,32),o=Math.pow(2,53);function d(f){var u=new ArrayBuffer(256),p=new DataView(u),a,h=0;function _(I){for(var U=u.byteLength,k=h+I;U<k;)U*=2;if(U!==u.byteLength){var G=p;u=new ArrayBuffer(U),p=new DataView(u);for(var A=h+3>>2,V=0;V<A;++V)p.setUint32(V*4,G.getUint32(V*4))}return a=I,p}function L(){h+=a}function T(I){L(_(8).setFloat64(h,I))}function O(I){L(_(1).setUint8(h,I))}function N(I){for(var U=_(I.length),k=0;k<I.length;++k)U.setUint8(h+k,I[k]);L()}function R(I){L(_(2).setUint16(h,I))}function q(I){L(_(4).setUint32(h,I))}function F(I){var U=I%i,k=(I-U)/i,G=_(8);G.setUint32(h,k),G.setUint32(h+4,U),L()}function j(I,U){U<24?O(I<<5|U):U<256?(O(I<<5|24),O(U)):U<65536?(O(I<<5|25),R(U)):U<4294967296?(O(I<<5|26),q(U)):(O(I<<5|27),F(U))}function te(I){var U;if(I===!1)return O(244);if(I===!0)return O(245);if(I===null)return O(246);if(I===r)return O(247);switch(typeof I){case"number":if(Math.floor(I)===I){if(0<=I&&I<=o)return j(0,I);if(-o<=I&&I<0)return j(1,-(I+1))}return O(251),T(I);case"string":var k=[];for(U=0;U<I.length;++U){var G=I.charCodeAt(U);G<128?k.push(G):G<2048?(k.push(192|G>>6),k.push(128|G&63)):G<55296?(k.push(224|G>>12),k.push(128|G>>6&63),k.push(128|G&63)):(G=(G&1023)<<10,G|=I.charCodeAt(++U)&1023,G+=65536,k.push(240|G>>18),k.push(128|G>>12&63),k.push(128|G>>6&63),k.push(128|G&63))}return j(3,k.length),N(k);default:var A;if(Array.isArray(I))for(A=I.length,j(4,A),U=0;U<A;++U)te(I[U]);else if(I instanceof Uint8Array)j(2,I.length),N(I);else{var V=Object.keys(I);for(A=V.length,j(5,A),U=0;U<A;++U){var Y=V[U];te(Y),te(I[Y])}}}}if(te(f),"slice"in u)return u.slice(0,h);for(var ee=new ArrayBuffer(h),H=new DataView(ee),z=0;z<h;++z)H.setUint8(z,p.getUint8(z));return ee}function c(f,u,p){var a=new DataView(f),h=0;typeof u!="function"&&(u=function(k){return k}),typeof p!="function"&&(p=function(){return r});function _(k,G){return h+=G,k}function L(k){return _(new Uint8Array(f,h,k),k)}function T(){var k=new ArrayBuffer(4),G=new DataView(k),A=q(),V=A&32768,Y=A&31744,s=A&1023;if(Y===31744)Y=261120;else if(Y!==0)Y+=114688;else if(s!==0)return s*n;return G.setUint32(0,V<<16|Y<<13|s<<13),G.getFloat32(0)}function O(){return _(a.getFloat32(h),4)}function N(){return _(a.getFloat64(h),8)}function R(){return _(a.getUint8(h),1)}function q(){return _(a.getUint16(h),2)}function F(){return _(a.getUint32(h),4)}function j(){return F()*i+F()}function te(){return a.getUint8(h)!==255?!1:(h+=1,!0)}function ee(k){if(k<24)return k;if(k===24)return R();if(k===25)return q();if(k===26)return F();if(k===27)return j();if(k===31)return-1;throw"Invalid length encoding"}function H(k){var G=R();if(G===255)return-1;var A=ee(G&31);if(A<0||G>>5!==k)throw"Invalid indefinite length element";return A}function z(k,G){for(var A=0;A<G;++A){var V=R();V&128&&(V<224?(V=(V&31)<<6|R()&63,G-=1):V<240?(V=(V&15)<<12|(R()&63)<<6|R()&63,G-=2):(V=(V&15)<<18|(R()&63)<<12|(R()&63)<<6|R()&63,G-=3)),V<65536?k.push(V):(V-=65536,k.push(55296|V>>10),k.push(56320|V&1023))}}function I(){var k=R(),G=k>>5,A=k&31,V,Y;if(G===7)switch(A){case 25:return T();case 26:return O();case 27:return N()}if(Y=ee(A),Y<0&&(G<2||6<G))throw"Invalid length";switch(G){case 0:return Y;case 1:return-1-Y;case 2:if(Y<0){for(var s=[],m=0;(Y=H(G))>=0;)m+=Y,s.push(L(Y));var g=new Uint8Array(m),v=0;for(V=0;V<s.length;++V)g.set(s[V],v),v+=s[V].length;return g}return L(Y);case 3:var y=[];if(Y<0)for(;(Y=H(G))>=0;)z(y,Y);else z(y,Y);return String.fromCharCode.apply(null,y);case 4:var b;if(Y<0)for(b=[];!te();)b.push(I());else for(b=new Array(Y),V=0;V<Y;++V)b[V]=I();return b;case 5:var w={};for(V=0;V<Y||Y<0&&!te();++V){var C=I();w[C]=I()}return w;case 6:return u(I(),Y);case 7:switch(Y){case 20:return!1;case 21:return!0;case 22:return null;case 23:return r;default:return p(Y)}}}var U=I();if(h!==f.byteLength)throw"Remaining bytes";return U}var l={encode:d,decode:c};e.exports?e.exports=l:t.CBOR||(t.CBOR=l)})(ei)}(Ut)),Ut.exports}var Dt={exports:{}},mn;function bs(){return mn||(mn=1,function(e){var t=Math.pow(2,32),r=!1;function n(){r||(r=!0,console.warn("CBOR 64-bit integer array values may lose precision. No further warnings."))}function i(u){n();for(var p=u.byteLength,a=u.byteOffset,h=p/8,_=u.buffer.slice(a,a+p),L=new Uint32Array(_),T=new Array(h),O=0;O<h;O++){var N=O*2,R=L[N],q=L[N+1];T[O]=R+t*q}return T}function o(u){n();for(var p=u.byteLength,a=u.byteOffset,h=p/8,_=u.buffer.slice(a,a+p),L=new Uint32Array(_),T=new Int32Array(_),O=new Array(h),N=0;N<h;N++){var R=N*2,q=L[R],F=T[R+1];O[N]=q+t*F}return O}function d(u,p){var a=u.byteLength,h=u.byteOffset,_=u.buffer.slice(h,h+a);return new p(_)}var c={64:Uint8Array,69:Uint16Array,70:Uint32Array,72:Int8Array,77:Int16Array,78:Int32Array,85:Float32Array,86:Float64Array},l={71:i,79:o};function f(u,p){if(p in c){var a=c[p];return d(u,a)}return p in l?l[p](u):u}e.exports&&(e.exports=f)}(Dt)),Dt.exports}var Bt,gn;function ws(){if(gn)return Bt;gn=1;var e=ys(),t=_s(),r=bs(),n=null;typeof bson<"u"&&(n=bson().BSON);function i(o){var d=null;o.transportOptions.decoder&&(d=o.transportOptions.decoder);function c(u){u.op==="publish"?o.emit(u.topic,u.msg):u.op==="service_response"?o.emit(u.id,u):u.op==="call_service"?o.emit(u.service,u):u.op==="status"&&(u.id?o.emit("status:"+u.id,u):o.emit("status",u))}function l(u,p){u.op==="png"?e(u.data,p):p(u)}function f(u,p){if(!n)throw"Cannot process BSON encoded message without BSON header.";var a=new FileReader;a.onload=function(){var h=new Uint8Array(this.result),_=n.deserialize(h);p(_)},a.readAsArrayBuffer(u)}return{onopen:function(p){o.isConnected=!0,o.emit("connection",p)},onclose:function(p){o.isConnected=!1,o.emit("close",p)},onerror:function(p){o.emit("error",p)},onmessage:function(p){if(d)d(p.data,function(_){c(_)});else if(typeof Blob<"u"&&p.data instanceof Blob)f(p.data,function(_){l(_,c)});else if(p.data instanceof ArrayBuffer){var a=t.decode(p.data,r);c(a)}else{var h=JSON.parse(typeof p=="string"?p:p.data);l(h,c)}}}}return Bt=i,Bt}var Gt,vn;function _i(){if(vn)return Gt;vn=1;var e=Ge;function t(r){e(this,r)}return Gt=t,Gt}var qt,yn;function st(){if(yn)return qt;yn=1;var e=Ge;function t(r){e(this,r)}return qt=t,qt}var Vt={exports:{}};/*!
 * EventEmitter2
 * https://github.com/hij1nx/EventEmitter2
 *
 * Copyright (c) 2013 hij1nx
 * Licensed under the MIT license.
 */var _n;function qe(){return _n||(_n=1,function(e,t){(function(r){var n=Object.hasOwnProperty,i=Array.isArray?Array.isArray:function(m){return Object.prototype.toString.call(m)==="[object Array]"},o=10,d=typeof process=="object"&&typeof process.nextTick=="function",c=typeof Symbol=="function",l=typeof Reflect=="object",f=typeof setImmediate=="function",u=f?setImmediate:setTimeout,p=c?l&&typeof Reflect.ownKeys=="function"?Reflect.ownKeys:function(s){var m=Object.getOwnPropertyNames(s);return m.push.apply(m,Object.getOwnPropertySymbols(s)),m}:Object.keys;function a(){this._events={},this._conf&&h.call(this,this._conf)}function h(s){s&&(this._conf=s,s.delimiter&&(this.delimiter=s.delimiter),s.maxListeners!==r&&(this._maxListeners=s.maxListeners),s.wildcard&&(this.wildcard=s.wildcard),s.newListener&&(this._newListener=s.newListener),s.removeListener&&(this._removeListener=s.removeListener),s.verboseMemoryLeak&&(this.verboseMemoryLeak=s.verboseMemoryLeak),s.ignoreErrors&&(this.ignoreErrors=s.ignoreErrors),this.wildcard&&(this.listenerTree={}))}function _(s,m){var g="(node) warning: possible EventEmitter memory leak detected. "+s+" listeners added. Use emitter.setMaxListeners() to increase limit.";if(this.verboseMemoryLeak&&(g+=" Event name: "+m+"."),typeof process<"u"&&process.emitWarning){var v=new Error(g);v.name="MaxListenersExceededWarning",v.emitter=this,v.count=s,process.emitWarning(v)}else console.error(g),console.trace&&console.trace()}var L=function(s,m,g){var v=arguments.length;switch(v){case 0:return[];case 1:return[s];case 2:return[s,m];case 3:return[s,m,g];default:for(var y=new Array(v);v--;)y[v]=arguments[v];return y}};function T(s,m){for(var g={},v,y=s.length,b=0,w=0;w<y;w++)v=s[w],g[v]=w<b?m[w]:r;return g}function O(s,m,g){this._emitter=s,this._target=m,this._listeners={},this._listenersCount=0;var v,y;if((g.on||g.off)&&(v=g.on,y=g.off),m.addEventListener?(v=m.addEventListener,y=m.removeEventListener):m.addListener?(v=m.addListener,y=m.removeListener):m.on&&(v=m.on,y=m.off),!v&&!y)throw Error("target does not implement any known event API");if(typeof v!="function")throw TypeError("on method must be a function");if(typeof y!="function")throw TypeError("off method must be a function");this._on=v,this._off=y;var b=s._observers;b?b.push(this):s._observers=[this]}Object.assign(O.prototype,{subscribe:function(s,m,g){var v=this,y=this._target,b=this._emitter,w=this._listeners,C=function(){var E=L.apply(null,arguments),S={data:E,name:m,original:s};if(g){var D=g.call(y,S);D!==!1&&b.emit.apply(b,[S.name].concat(E));return}b.emit.apply(b,[m].concat(E))};if(w[s])throw Error("Event '"+s+"' is already listening");this._listenersCount++,b._newListener&&b._removeListener&&!v._onNewListener?(this._onNewListener=function(E){E===m&&w[s]===null&&(w[s]=C,v._on.call(y,s,C))},b.on("newListener",this._onNewListener),this._onRemoveListener=function(E){E===m&&!b.hasListeners(E)&&w[s]&&(w[s]=null,v._off.call(y,s,C))},w[s]=null,b.on("removeListener",this._onRemoveListener)):(w[s]=C,v._on.call(y,s,C))},unsubscribe:function(s){var m=this,g=this._listeners,v=this._emitter,y,b,w=this._off,C=this._target,E;if(s&&typeof s!="string")throw TypeError("event must be a string");function S(){m._onNewListener&&(v.off("newListener",m._onNewListener),v.off("removeListener",m._onRemoveListener),m._onNewListener=null,m._onRemoveListener=null);var D=ee.call(v,m);v._observers.splice(D,1)}if(s){if(y=g[s],!y)return;w.call(C,s,y),delete g[s],--this._listenersCount||S()}else{for(b=p(g),E=b.length;E-- >0;)s=b[E],w.call(C,s,g[s]);this._listeners={},this._listenersCount=0,S()}}});function N(s,m,g,v){var y=Object.assign({},m);if(!s)return y;if(typeof s!="object")throw TypeError("options must be an object");var b=Object.keys(s),w=b.length,C,E,S;function D(Z){throw Error('Invalid "'+C+'" option value'+(Z?". Reason: "+Z:""))}for(var ue=0;ue<w;ue++){if(C=b[ue],!n.call(m,C))throw Error('Unknown "'+C+'" option');E=s[C],E!==r&&(S=g[C],y[C]=S?S(E,D):E)}return y}function R(s,m){return(typeof s!="function"||!s.hasOwnProperty("prototype"))&&m("value must be a constructor"),s}function q(s){var m="value must be type of "+s.join("|"),g=s.length,v=s[0],y=s[1];return g===1?function(b,w){if(typeof b===v)return b;w(m)}:g===2?function(b,w){var C=typeof b;if(C===v||C===y)return b;w(m)}:function(b,w){for(var C=typeof b,E=g;E-- >0;)if(C===s[E])return b;w(m)}}var F=q(["function"]),j=q(["object","function"]);function te(s,m,g){var v,y,b=0,w,C=new s(function(E,S,D){g=N(g,{timeout:0,overload:!1},{timeout:function(oe,ae){return oe*=1,(typeof oe!="number"||oe<0||!Number.isFinite(oe))&&ae("timeout must be a positive number"),oe}}),v=!g.overload&&typeof s.prototype.cancel=="function"&&typeof D=="function";function ue(){y&&(y=null),b&&(clearTimeout(b),b=0)}var Z=function(oe){ue(),E(oe)},Q=function(oe){ue(),S(oe)};v?m(Z,Q,D):(y=[function(oe){Q(oe||Error("canceled"))}],m(Z,Q,function(oe){if(w)throw Error("Unable to subscribe on cancel event asynchronously");if(typeof oe!="function")throw TypeError("onCancel callback must be a function");y.push(oe)}),w=!0),g.timeout>0&&(b=setTimeout(function(){var oe=Error("timeout");oe.code="ETIMEDOUT",b=0,C.cancel(oe),S(oe)},g.timeout))});return v||(C.cancel=function(E){if(y){for(var S=y.length,D=1;D<S;D++)y[D](E);y[0](E),y=null}}),C}function ee(s){var m=this._observers;if(!m)return-1;for(var g=m.length,v=0;v<g;v++)if(m[v]._target===s)return v;return-1}function H(s,m,g,v,y){if(!g)return null;if(v===0){var b=typeof m;if(b==="string"){var w,C,E=0,S=0,D=this.delimiter,ue=D.length;if((C=m.indexOf(D))!==-1){w=new Array(5);do w[E++]=m.slice(S,C),S=C+ue;while((C=m.indexOf(D,S))!==-1);w[E++]=m.slice(S),m=w,y=E}else m=[m],y=1}else b==="object"?y=m.length:(m=[m],y=1)}var Z=null,Q,oe,ae,Ze,Qe,x=m[v],W=m[v+1],K,$;if(v===y)g._listeners&&(typeof g._listeners=="function"?(s&&s.push(g._listeners),Z=[g]):(s&&s.push.apply(s,g._listeners),Z=[g]));else if(x==="*"){for(K=p(g),C=K.length;C-- >0;)Q=K[C],Q!=="_listeners"&&($=H(s,m,g[Q],v+1,y),$&&(Z?Z.push.apply(Z,$):Z=$));return Z}else if(x==="**"){for(Qe=v+1===y||v+2===y&&W==="*",Qe&&g._listeners&&(Z=H(s,m,g,y,y)),K=p(g),C=K.length;C-- >0;)Q=K[C],Q!=="_listeners"&&(Q==="*"||Q==="**"?(g[Q]._listeners&&!Qe&&($=H(s,m,g[Q],y,y),$&&(Z?Z.push.apply(Z,$):Z=$)),$=H(s,m,g[Q],v,y)):Q===W?$=H(s,m,g[Q],v+2,y):$=H(s,m,g[Q],v,y),$&&(Z?Z.push.apply(Z,$):Z=$));return Z}else g[x]&&(Z=H(s,m,g[x],v+1,y));if(oe=g["*"],oe&&H(s,m,oe,v+1,y),ae=g["**"],ae)if(v<y)for(ae._listeners&&H(s,m,ae,y,y),K=p(ae),C=K.length;C-- >0;)Q=K[C],Q!=="_listeners"&&(Q===W?H(s,m,ae[Q],v+2,y):Q===x?H(s,m,ae[Q],v+1,y):(Ze={},Ze[Q]=ae[Q],H(s,m,{"**":Ze},v+1,y)));else ae._listeners?H(s,m,ae,y,y):ae["*"]&&ae["*"]._listeners&&H(s,m,ae["*"],y,y);return Z}function z(s,m,g){var v=0,y=0,b,w=this.delimiter,C=w.length,E;if(typeof s=="string")if((b=s.indexOf(w))!==-1){E=new Array(5);do E[v++]=s.slice(y,b),y=b+C;while((b=s.indexOf(w,y))!==-1);E[v++]=s.slice(y)}else E=[s],v=1;else E=s,v=s.length;if(v>1){for(b=0;b+1<v;b++)if(E[b]==="**"&&E[b+1]==="**")return}var S=this.listenerTree,D;for(b=0;b<v;b++)if(D=E[b],S=S[D]||(S[D]={}),b===v-1)return S._listeners?(typeof S._listeners=="function"&&(S._listeners=[S._listeners]),g?S._listeners.unshift(m):S._listeners.push(m),!S._listeners.warned&&this._maxListeners>0&&S._listeners.length>this._maxListeners&&(S._listeners.warned=!0,_.call(this,S._listeners.length,D))):S._listeners=m,!0;return!0}function I(s,m,g,v){for(var y=p(s),b=y.length,w,C,E,S=s._listeners,D;b-- >0;)C=y[b],w=s[C],C==="_listeners"?E=g:E=g?g.concat(C):[C],D=v||typeof C=="symbol",S&&m.push(D?E:E.join(this.delimiter)),typeof w=="object"&&I.call(this,w,m,E,D);return m}function U(s){for(var m=p(s),g=m.length,v,y,b;g-- >0;)y=m[g],v=s[y],v&&(b=!0,y!=="_listeners"&&!U(v)&&delete s[y]);return b}function k(s,m,g){this.emitter=s,this.event=m,this.listener=g}k.prototype.off=function(){return this.emitter.off(this.event,this.listener),this};function G(s,m,g){if(g===!0)y=!0;else if(g===!1)v=!0;else{if(!g||typeof g!="object")throw TypeError("options should be an object or true");var v=g.async,y=g.promisify,b=g.nextTick,w=g.objectify}if(v||b||y){var C=m,E=m._origin||m;if(b&&!d)throw Error("process.nextTick is not supported");y===r&&(y=m.constructor.name==="AsyncFunction"),m=function(){var S=arguments,D=this,ue=this.event;return y?b?Promise.resolve():new Promise(function(Z){u(Z)}).then(function(){return D.event=ue,C.apply(D,S)}):(b?process.nextTick:u)(function(){D.event=ue,C.apply(D,S)})},m._async=!0,m._origin=E}return[m,w?new k(this,s,m):this]}function A(s){this._events={},this._newListener=!1,this._removeListener=!1,this.verboseMemoryLeak=!1,h.call(this,s)}A.EventEmitter2=A,A.prototype.listenTo=function(s,m,g){if(typeof s!="object")throw TypeError("target musts be an object");var v=this;g=N(g,{on:r,off:r,reducers:r},{on:F,off:F,reducers:j});function y(b){if(typeof b!="object")throw TypeError("events must be an object");var w=g.reducers,C=ee.call(v,s),E;C===-1?E=new O(v,s,g):E=v._observers[C];for(var S=p(b),D=S.length,ue,Z=typeof w=="function",Q=0;Q<D;Q++)ue=S[Q],E.subscribe(ue,b[ue]||ue,Z?w:w&&w[ue])}return i(m)?y(T(m)):y(typeof m=="string"?T(m.split(/\s+/)):m),this},A.prototype.stopListeningTo=function(s,m){var g=this._observers;if(!g)return!1;var v=g.length,y,b=!1;if(s&&typeof s!="object")throw TypeError("target should be an object");for(;v-- >0;)y=g[v],(!s||y._target===s)&&(y.unsubscribe(m),b=!0);return b},A.prototype.delimiter=".",A.prototype.setMaxListeners=function(s){s!==r&&(this._maxListeners=s,this._conf||(this._conf={}),this._conf.maxListeners=s)},A.prototype.getMaxListeners=function(){return this._maxListeners},A.prototype.event="",A.prototype.once=function(s,m,g){return this._once(s,m,!1,g)},A.prototype.prependOnceListener=function(s,m,g){return this._once(s,m,!0,g)},A.prototype._once=function(s,m,g,v){return this._many(s,1,m,g,v)},A.prototype.many=function(s,m,g,v){return this._many(s,m,g,!1,v)},A.prototype.prependMany=function(s,m,g,v){return this._many(s,m,g,!0,v)},A.prototype._many=function(s,m,g,v,y){var b=this;if(typeof g!="function")throw new Error("many only accepts instances of Function");function w(){return--m===0&&b.off(s,w),g.apply(this,arguments)}return w._origin=g,this._on(s,w,v,y)},A.prototype.emit=function(){if(!this._events&&!this._all)return!1;this._events||a.call(this);var s=arguments[0],m,g=this.wildcard,v,y,b,w,C;if(s==="newListener"&&!this._newListener&&!this._events.newListener)return!1;if(g&&(m=s,s!=="newListener"&&s!=="removeListener"&&typeof s=="object")){if(y=s.length,c){for(b=0;b<y;b++)if(typeof s[b]=="symbol"){C=!0;break}}C||(s=s.join(this.delimiter))}var E=arguments.length,S;if(this._all&&this._all.length)for(S=this._all.slice(),b=0,y=S.length;b<y;b++)switch(this.event=s,E){case 1:S[b].call(this,s);break;case 2:S[b].call(this,s,arguments[1]);break;case 3:S[b].call(this,s,arguments[1],arguments[2]);break;default:S[b].apply(this,arguments)}if(g)S=[],H.call(this,S,m,this.listenerTree,0,y);else if(S=this._events[s],typeof S=="function"){switch(this.event=s,E){case 1:S.call(this);break;case 2:S.call(this,arguments[1]);break;case 3:S.call(this,arguments[1],arguments[2]);break;default:for(v=new Array(E-1),w=1;w<E;w++)v[w-1]=arguments[w];S.apply(this,v)}return!0}else S&&(S=S.slice());if(S&&S.length){if(E>3)for(v=new Array(E-1),w=1;w<E;w++)v[w-1]=arguments[w];for(b=0,y=S.length;b<y;b++)switch(this.event=s,E){case 1:S[b].call(this);break;case 2:S[b].call(this,arguments[1]);break;case 3:S[b].call(this,arguments[1],arguments[2]);break;default:S[b].apply(this,v)}return!0}else if(!this.ignoreErrors&&!this._all&&s==="error")throw arguments[1]instanceof Error?arguments[1]:new Error("Uncaught, unspecified 'error' event.");return!!this._all},A.prototype.emitAsync=function(){if(!this._events&&!this._all)return!1;this._events||a.call(this);var s=arguments[0],m=this.wildcard,g,v,y,b,w,C;if(s==="newListener"&&!this._newListener&&!this._events.newListener)return Promise.resolve([!1]);if(m&&(g=s,s!=="newListener"&&s!=="removeListener"&&typeof s=="object")){if(b=s.length,c){for(w=0;w<b;w++)if(typeof s[w]=="symbol"){v=!0;break}}v||(s=s.join(this.delimiter))}var E=[],S=arguments.length,D;if(this._all)for(w=0,b=this._all.length;w<b;w++)switch(this.event=s,S){case 1:E.push(this._all[w].call(this,s));break;case 2:E.push(this._all[w].call(this,s,arguments[1]));break;case 3:E.push(this._all[w].call(this,s,arguments[1],arguments[2]));break;default:E.push(this._all[w].apply(this,arguments))}if(m?(D=[],H.call(this,D,g,this.listenerTree,0)):D=this._events[s],typeof D=="function")switch(this.event=s,S){case 1:E.push(D.call(this));break;case 2:E.push(D.call(this,arguments[1]));break;case 3:E.push(D.call(this,arguments[1],arguments[2]));break;default:for(y=new Array(S-1),C=1;C<S;C++)y[C-1]=arguments[C];E.push(D.apply(this,y))}else if(D&&D.length){if(D=D.slice(),S>3)for(y=new Array(S-1),C=1;C<S;C++)y[C-1]=arguments[C];for(w=0,b=D.length;w<b;w++)switch(this.event=s,S){case 1:E.push(D[w].call(this));break;case 2:E.push(D[w].call(this,arguments[1]));break;case 3:E.push(D[w].call(this,arguments[1],arguments[2]));break;default:E.push(D[w].apply(this,y))}}else if(!this.ignoreErrors&&!this._all&&s==="error")return arguments[1]instanceof Error?Promise.reject(arguments[1]):Promise.reject("Uncaught, unspecified 'error' event.");return Promise.all(E)},A.prototype.on=function(s,m,g){return this._on(s,m,!1,g)},A.prototype.prependListener=function(s,m,g){return this._on(s,m,!0,g)},A.prototype.onAny=function(s){return this._onAny(s,!1)},A.prototype.prependAny=function(s){return this._onAny(s,!0)},A.prototype.addListener=A.prototype.on,A.prototype._onAny=function(s,m){if(typeof s!="function")throw new Error("onAny only accepts instances of Function");return this._all||(this._all=[]),m?this._all.unshift(s):this._all.push(s),this},A.prototype._on=function(s,m,g,v){if(typeof s=="function")return this._onAny(s,m),this;if(typeof m!="function")throw new Error("on only accepts instances of Function");this._events||a.call(this);var y=this,b;return v!==r&&(b=G.call(this,s,m,v),m=b[0],y=b[1]),this._newListener&&this.emit("newListener",s,m),this.wildcard?(z.call(this,s,m,g),y):(this._events[s]?(typeof this._events[s]=="function"&&(this._events[s]=[this._events[s]]),g?this._events[s].unshift(m):this._events[s].push(m),!this._events[s].warned&&this._maxListeners>0&&this._events[s].length>this._maxListeners&&(this._events[s].warned=!0,_.call(this,this._events[s].length,s))):this._events[s]=m,y)},A.prototype.off=function(s,m){if(typeof m!="function")throw new Error("removeListener only takes instances of Function");var g,v=[];if(this.wildcard){var y=typeof s=="string"?s.split(this.delimiter):s.slice();if(v=H.call(this,null,y,this.listenerTree,0),!v)return this}else{if(!this._events[s])return this;g=this._events[s],v.push({_listeners:g})}for(var b=0;b<v.length;b++){var w=v[b];if(g=w._listeners,i(g)){for(var C=-1,E=0,S=g.length;E<S;E++)if(g[E]===m||g[E].listener&&g[E].listener===m||g[E]._origin&&g[E]._origin===m){C=E;break}if(C<0)continue;return this.wildcard?w._listeners.splice(C,1):this._events[s].splice(C,1),g.length===0&&(this.wildcard?delete w._listeners:delete this._events[s]),this._removeListener&&this.emit("removeListener",s,m),this}else(g===m||g.listener&&g.listener===m||g._origin&&g._origin===m)&&(this.wildcard?delete w._listeners:delete this._events[s],this._removeListener&&this.emit("removeListener",s,m))}return this.listenerTree&&U(this.listenerTree),this},A.prototype.offAny=function(s){var m=0,g=0,v;if(s&&this._all&&this._all.length>0){for(v=this._all,m=0,g=v.length;m<g;m++)if(s===v[m])return v.splice(m,1),this._removeListener&&this.emit("removeListenerAny",s),this}else{if(v=this._all,this._removeListener)for(m=0,g=v.length;m<g;m++)this.emit("removeListenerAny",v[m]);this._all=[]}return this},A.prototype.removeListener=A.prototype.off,A.prototype.removeAllListeners=function(s){if(s===r)return!this._events||a.call(this),this;if(this.wildcard){var m=H.call(this,null,s,this.listenerTree,0),g,v;if(!m)return this;for(v=0;v<m.length;v++)g=m[v],g._listeners=null;this.listenerTree&&U(this.listenerTree)}else this._events&&(this._events[s]=null);return this},A.prototype.listeners=function(s){var m=this._events,g,v,y,b,w;if(s===r){if(this.wildcard)throw Error("event name required for wildcard emitter");if(!m)return[];for(g=p(m),b=g.length,y=[];b-- >0;)v=m[g[b]],typeof v=="function"?y.push(v):y.push.apply(y,v);return y}else{if(this.wildcard){if(w=this.listenerTree,!w)return[];var C=[],E=typeof s=="string"?s.split(this.delimiter):s.slice();return H.call(this,C,E,w,0),C}return m?(v=m[s],v?typeof v=="function"?[v]:v:[]):[]}},A.prototype.eventNames=function(s){var m=this._events;return this.wildcard?I.call(this,this.listenerTree,[],null,s):m?p(m):[]},A.prototype.listenerCount=function(s){return this.listeners(s).length},A.prototype.hasListeners=function(s){if(this.wildcard){var m=[],g=typeof s=="string"?s.split(this.delimiter):s.slice();return H.call(this,m,g,this.listenerTree,0),m.length>0}var v=this._events,y=this._all;return!!(y&&y.length||v&&(s===r?p(v).length:v[s]))},A.prototype.listenersAny=function(){return this._all?this._all:[]},A.prototype.waitFor=function(s,m){var g=this,v=typeof m;return v==="number"?m={timeout:m}:v==="function"&&(m={filter:m}),m=N(m,{timeout:0,filter:r,handleError:!1,Promise,overload:!1},{filter:F,Promise:R}),te(m.Promise,function(y,b,w){function C(){var E=m.filter;if(!(E&&!E.apply(g,arguments)))if(g.off(s,C),m.handleError){var S=arguments[0];S?b(S):y(L.apply(null,arguments).slice(1))}else y(L.apply(null,arguments))}w(function(){g.off(s,C)}),g._on(s,C,!1)},{timeout:m.timeout,overload:m.overload})};function V(s,m,g){g=N(g,{Promise,timeout:0,overload:!1},{Promise:R});var v=g.Promise;return te(v,function(y,b,w){var C;if(typeof s.addEventListener=="function"){C=function(){y(L.apply(null,arguments))},w(function(){s.removeEventListener(m,C)}),s.addEventListener(m,C,{once:!0});return}var E=function(){S&&s.removeListener("error",S),y(L.apply(null,arguments))},S;m!=="error"&&(S=function(D){s.removeListener(m,E),b(D)},s.once("error",S)),w(function(){S&&s.removeListener("error",S),s.removeListener(m,E)}),s.once(m,E)},{timeout:g.timeout,overload:g.overload})}var Y=A.prototype;Object.defineProperties(A,{defaultMaxListeners:{get:function(){return Y._maxListeners},set:function(s){if(typeof s!="number"||s<0||Number.isNaN(s))throw TypeError("n must be a non-negative number");Y._maxListeners=s},enumerable:!0},once:{value:V,writable:!0,configurable:!0}}),Object.defineProperties(Y,{_maxListeners:{value:o,writable:!0,configurable:!0},_observers:{value:null,writable:!0,configurable:!0}}),e.exports=A})()}(Vt)),Vt.exports}var zt,bn;function Ct(){if(bn)return zt;bn=1;var e=_i();st();var t=qe().EventEmitter2;function r(n){n=n||{},this.ros=n.ros,this.name=n.name,this.serviceType=n.serviceType,this.isAdvertised=!1,this._serviceCallback=null}return r.prototype.__proto__=t.prototype,r.prototype.callService=function(n,i,o){if(!this.isAdvertised){var d="call_service:"+this.name+":"+ ++this.ros.idCounter;(i||o)&&this.ros.once(d,function(l){l.result!==void 0&&l.result===!1?typeof o=="function"&&o(l.values):typeof i=="function"&&i(new e(l.values))});var c={op:"call_service",id:d,service:this.name,type:this.serviceType,args:n};this.ros.callOnConnection(c)}},r.prototype.advertise=function(n){this.isAdvertised||typeof n!="function"||(this._serviceCallback=n,this.ros.on(this.name,this._serviceResponse.bind(this)),this.ros.callOnConnection({op:"advertise_service",type:this.serviceType,service:this.name}),this.isAdvertised=!0)},r.prototype.unadvertise=function(){this.isAdvertised&&(this.ros.callOnConnection({op:"unadvertise_service",service:this.name}),this.isAdvertised=!1)},r.prototype._serviceResponse=function(n){var i={},o=this._serviceCallback(n.args,i),d={op:"service_response",service:this.name,values:new e(i),result:o};n.id&&(d.id=n.id),this.ros.callOnConnection(d)},zt=r,zt}var jt,wn;function Dr(){if(wn)return jt;wn=1;var e=yi(),t=gs(),r=ws(),n=Ct(),i=st(),o=Ge,d=qe().EventEmitter2;function c(l){l=l||{};var f=this;this.socket=null,this.idCounter=0,this.isConnected=!1,this.transportLibrary=l.transportLibrary||"websocket",this.transportOptions=l.transportOptions||{},this._sendFunc=function(u){f.sendEncodedMessage(u)},typeof l.groovyCompatibility>"u"?this.groovyCompatibility=!0:this.groovyCompatibility=l.groovyCompatibility,this.setMaxListeners(0),l.url&&this.connect(l.url)}return c.prototype.__proto__=d.prototype,c.prototype.connect=function(l){if(this.transportLibrary==="socket.io")this.socket=o(io(l,{"force new connection":!0}),r(this)),this.socket.on("connect",this.socket.onopen),this.socket.on("data",this.socket.onmessage),this.socket.on("close",this.socket.onclose),this.socket.on("error",this.socket.onerror);else if(this.transportLibrary.constructor.name==="RTCPeerConnection")this.socket=o(this.transportLibrary.createDataChannel(l,this.transportOptions),r(this));else if(this.transportLibrary==="websocket"){if(!this.socket||this.socket.readyState===e.CLOSED){var f=new e(l);f.binaryType="arraybuffer",this.socket=o(f,r(this))}}else if(this.transportLibrary==="workersocket")this.socket=o(new t(l),r(this));else throw"Unknown transportLibrary: "+this.transportLibrary.toString()},c.prototype.close=function(){this.socket&&this.socket.close()},c.prototype.authenticate=function(l,f,u,p,a,h,_){var L={op:"auth",mac:l,client:f,dest:u,rand:p,t:a,level:h,end:_};this.callOnConnection(L)},c.prototype.sendEncodedMessage=function(l){var f=null,u=this;this.transportLibrary==="socket.io"?f=function(p){u.socket.emit("operation",p)}:f=function(p){u.socket.send(p)},this.isConnected?f(l):u.once("connection",function(){f(l)})},c.prototype.callOnConnection=function(l){this.transportOptions.encoder?this.transportOptions.encoder(l,this._sendFunc):this._sendFunc(JSON.stringify(l))},c.prototype.setStatusLevel=function(l,f){var u={op:"set_level",level:l,id:f};this.callOnConnection(u)},c.prototype.getActionServers=function(l,f){var u=new n({ros:this,name:"/rosapi/action_servers",serviceType:"rosapi/GetActionServers"}),p=new i({});typeof f=="function"?u.callService(p,function(a){l(a.action_servers)},function(a){f(a)}):u.callService(p,function(a){l(a.action_servers)})},c.prototype.getTopics=function(l,f){var u=new n({ros:this,name:"/rosapi/topics",serviceType:"rosapi/Topics"}),p=new i;typeof f=="function"?u.callService(p,function(a){l(a)},function(a){f(a)}):u.callService(p,function(a){l(a)})},c.prototype.getTopicsForType=function(l,f,u){var p=new n({ros:this,name:"/rosapi/topics_for_type",serviceType:"rosapi/TopicsForType"}),a=new i({type:l});typeof u=="function"?p.callService(a,function(h){f(h.topics)},function(h){u(h)}):p.callService(a,function(h){f(h.topics)})},c.prototype.getServices=function(l,f){var u=new n({ros:this,name:"/rosapi/services",serviceType:"rosapi/Services"}),p=new i;typeof f=="function"?u.callService(p,function(a){l(a.services)},function(a){f(a)}):u.callService(p,function(a){l(a.services)})},c.prototype.getServicesForType=function(l,f,u){var p=new n({ros:this,name:"/rosapi/services_for_type",serviceType:"rosapi/ServicesForType"}),a=new i({type:l});typeof u=="function"?p.callService(a,function(h){f(h.services)},function(h){u(h)}):p.callService(a,function(h){f(h.services)})},c.prototype.getServiceRequestDetails=function(l,f,u){var p=new n({ros:this,name:"/rosapi/service_request_details",serviceType:"rosapi/ServiceRequestDetails"}),a=new i({type:l});typeof u=="function"?p.callService(a,function(h){f(h)},function(h){u(h)}):p.callService(a,function(h){f(h)})},c.prototype.getServiceResponseDetails=function(l,f,u){var p=new n({ros:this,name:"/rosapi/service_response_details",serviceType:"rosapi/ServiceResponseDetails"}),a=new i({type:l});typeof u=="function"?p.callService(a,function(h){f(h)},function(h){u(h)}):p.callService(a,function(h){f(h)})},c.prototype.getNodes=function(l,f){var u=new n({ros:this,name:"/rosapi/nodes",serviceType:"rosapi/Nodes"}),p=new i;typeof f=="function"?u.callService(p,function(a){l(a.nodes)},function(a){f(a)}):u.callService(p,function(a){l(a.nodes)})},c.prototype.getNodeDetails=function(l,f,u){var p=new n({ros:this,name:"/rosapi/node_details",serviceType:"rosapi/NodeDetails"}),a=new i({node:l});typeof u=="function"?p.callService(a,function(h){f(h.subscribing,h.publishing,h.services)},function(h){u(h)}):p.callService(a,function(h){f(h)})},c.prototype.getParams=function(l,f){var u=new n({ros:this,name:"/rosapi/get_param_names",serviceType:"rosapi/GetParamNames"}),p=new i;typeof f=="function"?u.callService(p,function(a){l(a.names)},function(a){f(a)}):u.callService(p,function(a){l(a.names)})},c.prototype.getTopicType=function(l,f,u){var p=new n({ros:this,name:"/rosapi/topic_type",serviceType:"rosapi/TopicType"}),a=new i({topic:l});typeof u=="function"?p.callService(a,function(h){f(h.type)},function(h){u(h)}):p.callService(a,function(h){f(h.type)})},c.prototype.getServiceType=function(l,f,u){var p=new n({ros:this,name:"/rosapi/service_type",serviceType:"rosapi/ServiceType"}),a=new i({service:l});typeof u=="function"?p.callService(a,function(h){f(h.type)},function(h){u(h)}):p.callService(a,function(h){f(h.type)})},c.prototype.getMessageDetails=function(l,f,u){var p=new n({ros:this,name:"/rosapi/message_details",serviceType:"rosapi/MessageDetails"}),a=new i({type:l});typeof u=="function"?p.callService(a,function(h){f(h.typedefs)},function(h){u(h)}):p.callService(a,function(h){f(h.typedefs)})},c.prototype.decodeTypeDefs=function(l){var f=this,u=function(p,a){for(var h={},_=0;_<p.fieldnames.length;_++){var L=p.fieldarraylen[_],T=p.fieldnames[_],O=p.fieldtypes[_];if(O.indexOf("/")===-1)L===-1?h[T]=O:h[T]=[O];else{for(var N=!1,R=0;R<a.length;R++)if(a[R].type.toString()===O.toString()){N=a[R];break}if(N){var q=u(N,a);L===-1?h[T]=q:h[T]=[q]}else f.emit("error","Cannot find "+O+" in decodeTypeDefs")}}return h};return u(l[0],l)},c.prototype.getTopicsAndRawTypes=function(l,f){var u=new n({ros:this,name:"/rosapi/topics_and_raw_types",serviceType:"rosapi/TopicsAndRawTypes"}),p=new i;typeof f=="function"?u.callService(p,function(a){l(a)},function(a){f(a)}):u.callService(p,function(a){l(a)})},jt=c,jt}var Wt,En;function Xe(){if(En)return Wt;En=1;var e=Ge;function t(r){e(this,r)}return Wt=t,Wt}var Jt,Sn;function at(){if(Sn)return Jt;Sn=1;var e=qe().EventEmitter2,t=Xe();function r(n){n=n||{},this.ros=n.ros,this.name=n.name,this.messageType=n.messageType,this.isAdvertised=!1,this.compression=n.compression||"none",this.throttle_rate=n.throttle_rate||0,this.latch=n.latch||!1,this.queue_size=n.queue_size||100,this.queue_length=n.queue_length||0,this.reconnect_on_close=n.reconnect_on_close!==void 0?n.reconnect_on_close:!0,this.compression&&this.compression!=="png"&&this.compression!=="cbor"&&this.compression!=="cbor-raw"&&this.compression!=="none"&&(this.emit("warning",this.compression+" compression is not supported. No compression will be used."),this.compression="none"),this.throttle_rate<0&&(this.emit("warning",this.throttle_rate+" is not allowed. Set to 0"),this.throttle_rate=0);var i=this;this.reconnect_on_close?this.callForSubscribeAndAdvertise=function(o){i.ros.callOnConnection(o),i.waitForReconnect=!1,i.reconnectFunc=function(){i.waitForReconnect||(i.waitForReconnect=!0,i.ros.callOnConnection(o),i.ros.once("connection",function(){i.waitForReconnect=!1}))},i.ros.on("close",i.reconnectFunc)}:this.callForSubscribeAndAdvertise=this.ros.callOnConnection,this._messageCallback=function(o){i.emit("message",new t(o))}}return r.prototype.__proto__=e.prototype,r.prototype.subscribe=function(n){typeof n=="function"&&this.on("message",n),!this.subscribeId&&(this.ros.on(this.name,this._messageCallback),this.subscribeId="subscribe:"+this.name+":"+ ++this.ros.idCounter,this.callForSubscribeAndAdvertise({op:"subscribe",id:this.subscribeId,type:this.messageType,topic:this.name,compression:this.compression,throttle_rate:this.throttle_rate,queue_length:this.queue_length}))},r.prototype.unsubscribe=function(n){n&&(this.off("message",n),this.listeners("message").length)||this.subscribeId&&(this.ros.off(this.name,this._messageCallback),this.reconnect_on_close&&this.ros.off("close",this.reconnectFunc),this.emit("unsubscribe"),this.ros.callOnConnection({op:"unsubscribe",id:this.subscribeId,topic:this.name}),this.subscribeId=null)},r.prototype.advertise=function(){if(!this.isAdvertised&&(this.advertiseId="advertise:"+this.name+":"+ ++this.ros.idCounter,this.callForSubscribeAndAdvertise({op:"advertise",id:this.advertiseId,type:this.messageType,topic:this.name,latch:this.latch,queue_size:this.queue_size}),this.isAdvertised=!0,!this.reconnect_on_close)){var n=this;this.ros.on("close",function(){n.isAdvertised=!1})}},r.prototype.unadvertise=function(){this.isAdvertised&&(this.reconnect_on_close&&this.ros.off("close",this.reconnectFunc),this.emit("unadvertise"),this.ros.callOnConnection({op:"unadvertise",id:this.advertiseId,topic:this.name}),this.isAdvertised=!1)},r.prototype.publish=function(n){this.isAdvertised||this.advertise(),this.ros.idCounter++;var i={op:"publish",id:"publish:"+this.name+":"+this.ros.idCounter,topic:this.name,msg:n,latch:this.latch};this.ros.callOnConnection(i)},Jt=r,Jt}var Yt,Tn;function Es(){if(Tn)return Yt;Tn=1;var e=Ct(),t=st();function r(n){n=n||{},this.ros=n.ros,this.name=n.name}return r.prototype.get=function(n,i){var o=new e({ros:this.ros,name:"/rosapi/get_param",serviceType:"rosapi/GetParam"}),d=new t({name:this.name});o.callService(d,function(c){var l=JSON.parse(c.value);n(l)},i)},r.prototype.set=function(n,i,o){var d=new e({ros:this.ros,name:"/rosapi/set_param",serviceType:"rosapi/SetParam"}),c=new t({name:this.name,value:JSON.stringify(n)});d.callService(c,i,o)},r.prototype.delete=function(n,i){var o=new e({ros:this.ros,name:"/rosapi/delete_param",serviceType:"rosapi/DeleteParam"}),d=new t({name:this.name});o.callService(d,n,i)},Yt=r,Yt}var Cn;function Ss(){if(Cn)return Ot.exports;Cn=1;var e=Ur(),t=Ot.exports={Ros:Dr(),Topic:at(),Message:Xe(),Param:Es(),Service:Ct(),ServiceRequest:st(),ServiceResponse:_i()};return e(t.Ros,["Param","Service","Topic"],t),Ot.exports}var Xt={exports:{}},Ht,Ln;function bi(){if(Ln)return Ht;Ln=1;var e=at(),t=Xe(),r=qe().EventEmitter2;function n(i){var o=this;i=i||{},this.ros=i.ros,this.serverName=i.serverName,this.actionName=i.actionName,this.timeout=i.timeout,this.omitFeedback=i.omitFeedback,this.omitStatus=i.omitStatus,this.omitResult=i.omitResult,this.goals={};var d=!1;this.feedbackListener=new e({ros:this.ros,name:this.serverName+"/feedback",messageType:this.actionName+"Feedback"}),this.statusListener=new e({ros:this.ros,name:this.serverName+"/status",messageType:"actionlib_msgs/GoalStatusArray"}),this.resultListener=new e({ros:this.ros,name:this.serverName+"/result",messageType:this.actionName+"Result"}),this.goalTopic=new e({ros:this.ros,name:this.serverName+"/goal",messageType:this.actionName+"Goal"}),this.cancelTopic=new e({ros:this.ros,name:this.serverName+"/cancel",messageType:"actionlib_msgs/GoalID"}),this.goalTopic.advertise(),this.cancelTopic.advertise(),this.omitStatus||this.statusListener.subscribe(function(c){d=!0,c.status_list.forEach(function(l){var f=o.goals[l.goal_id.id];f&&f.emit("status",l)})}),this.omitFeedback||this.feedbackListener.subscribe(function(c){var l=o.goals[c.status.goal_id.id];l&&(l.emit("status",c.status),l.emit("feedback",c.feedback))}),this.omitResult||this.resultListener.subscribe(function(c){var l=o.goals[c.status.goal_id.id];l&&(l.emit("status",c.status),l.emit("result",c.result))}),this.timeout&&setTimeout(function(){d||o.emit("timeout")},this.timeout)}return n.prototype.__proto__=r.prototype,n.prototype.cancel=function(){var i=new t;this.cancelTopic.publish(i)},n.prototype.dispose=function(){this.goalTopic.unadvertise(),this.cancelTopic.unadvertise(),this.omitStatus||this.statusListener.unsubscribe(),this.omitFeedback||this.feedbackListener.unsubscribe(),this.omitResult||this.resultListener.unsubscribe()},Ht=n,Ht}var Zt,Mn;function Ts(){if(Mn)return Zt;Mn=1;var e=at();Xe();var t=qe().EventEmitter2;function r(n){var i=this;n=n||{},this.ros=n.ros,this.serverName=n.serverName,this.actionName=n.actionName;var o=new e({ros:this.ros,name:this.serverName+"/goal",messageType:this.actionName+"Goal"}),d=new e({ros:this.ros,name:this.serverName+"/feedback",messageType:this.actionName+"Feedback"}),c=new e({ros:this.ros,name:this.serverName+"/status",messageType:"actionlib_msgs/GoalStatusArray"}),l=new e({ros:this.ros,name:this.serverName+"/result",messageType:this.actionName+"Result"});o.subscribe(function(f){i.emit("goal",f)}),c.subscribe(function(f){f.status_list.forEach(function(u){i.emit("status",u)})}),d.subscribe(function(f){i.emit("status",f.status),i.emit("feedback",f.feedback)}),l.subscribe(function(f){i.emit("status",f.status),i.emit("result",f.result)})}return r.prototype.__proto__=t.prototype,Zt=r,Zt}var Qt,On;function wi(){if(On)return Qt;On=1;var e=Xe(),t=qe().EventEmitter2;function r(n){var i=this;this.actionClient=n.actionClient,this.goalMessage=n.goalMessage,this.isFinished=!1;var o=new Date;this.goalID="goal_"+Math.random()+"_"+o.getTime(),this.goalMessage=new e({goal_id:{stamp:{secs:0,nsecs:0},id:this.goalID},goal:this.goalMessage}),this.on("status",function(d){i.status=d}),this.on("result",function(d){i.isFinished=!0,i.result=d}),this.on("feedback",function(d){i.feedback=d}),this.actionClient.goals[this.goalID]=this}return r.prototype.__proto__=t.prototype,r.prototype.send=function(n){var i=this;i.actionClient.goalTopic.publish(i.goalMessage),n&&setTimeout(function(){i.isFinished||i.emit("timeout")},n)},r.prototype.cancel=function(){var n=new e({id:this.goalID});this.actionClient.cancelTopic.publish(n)},Qt=r,Qt}var Kt,In;function Cs(){if(In)return Kt;In=1;var e=at(),t=Xe(),r=qe().EventEmitter2;function n(i){var o=this;i=i||{},this.ros=i.ros,this.serverName=i.serverName,this.actionName=i.actionName,this.feedbackPublisher=new e({ros:this.ros,name:this.serverName+"/feedback",messageType:this.actionName+"Feedback"}),this.feedbackPublisher.advertise();var d=new e({ros:this.ros,name:this.serverName+"/status",messageType:"actionlib_msgs/GoalStatusArray"});d.advertise(),this.resultPublisher=new e({ros:this.ros,name:this.serverName+"/result",messageType:this.actionName+"Result"}),this.resultPublisher.advertise();var c=new e({ros:this.ros,name:this.serverName+"/goal",messageType:this.actionName+"Goal"}),l=new e({ros:this.ros,name:this.serverName+"/cancel",messageType:"actionlib_msgs/GoalID"});this.statusMessage=new t({header:{stamp:{secs:0,nsecs:100},frame_id:""},status_list:[]}),this.currentGoal=null,this.nextGoal=null,c.subscribe(function(u){o.currentGoal?(o.nextGoal=u,o.emit("cancel")):(o.statusMessage.status_list=[{goal_id:u.goal_id,status:1}],o.currentGoal=u,o.emit("goal",u.goal))});var f=function(u,p){return u.secs>p.secs?!1:u.secs<p.secs?!0:u.nsecs<p.nsecs};l.subscribe(function(u){u.stamp.secs===0&&u.stamp.secs===0&&u.id===""?(o.nextGoal=null,o.currentGoal&&o.emit("cancel")):(o.currentGoal&&u.id===o.currentGoal.goal_id.id?o.emit("cancel"):o.nextGoal&&u.id===o.nextGoal.goal_id.id&&(o.nextGoal=null),o.nextGoal&&f(o.nextGoal.goal_id.stamp,u.stamp)&&(o.nextGoal=null),o.currentGoal&&f(o.currentGoal.goal_id.stamp,u.stamp)&&o.emit("cancel"))}),setInterval(function(){var u=new Date,p=Math.floor(u.getTime()/1e3),a=Math.round(1e9*(u.getTime()/1e3-p));o.statusMessage.header.stamp.secs=p,o.statusMessage.header.stamp.nsecs=a,d.publish(o.statusMessage)},500)}return n.prototype.__proto__=r.prototype,n.prototype.setSucceeded=function(i){var o=new t({status:{goal_id:this.currentGoal.goal_id,status:3},result:i});this.resultPublisher.publish(o),this.statusMessage.status_list=[],this.nextGoal?(this.currentGoal=this.nextGoal,this.nextGoal=null,this.emit("goal",this.currentGoal.goal)):this.currentGoal=null},n.prototype.setAborted=function(i){var o=new t({status:{goal_id:this.currentGoal.goal_id,status:4},result:i});this.resultPublisher.publish(o),this.statusMessage.status_list=[],this.nextGoal?(this.currentGoal=this.nextGoal,this.nextGoal=null,this.emit("goal",this.currentGoal.goal)):this.currentGoal=null},n.prototype.sendFeedback=function(i){var o=new t({status:{goal_id:this.currentGoal.goal_id,status:1},feedback:i});this.feedbackPublisher.publish(o)},n.prototype.setPreempted=function(){this.statusMessage.status_list=[];var i=new t({status:{goal_id:this.currentGoal.goal_id,status:2}});this.resultPublisher.publish(i),this.nextGoal?(this.currentGoal=this.nextGoal,this.nextGoal=null,this.emit("goal",this.currentGoal.goal)):this.currentGoal=null},Kt=n,Kt}var An;function Ls(){if(An)return Xt.exports;An=1;var e=Dr(),t=Ur(),r=Xt.exports={ActionClient:bi(),ActionListener:Ts(),Goal:wi(),SimpleActionServer:Cs()};return t(e,["ActionClient","SimpleActionServer"],r),Xt.exports}var $t,Nn;function Ve(){if(Nn)return $t;Nn=1;function e(t){t=t||{},this.x=t.x||0,this.y=t.y||0,this.z=t.z||0}return e.prototype.add=function(t){this.x+=t.x,this.y+=t.y,this.z+=t.z},e.prototype.subtract=function(t){this.x-=t.x,this.y-=t.y,this.z-=t.z},e.prototype.multiplyQuaternion=function(t){var r=t.w*this.x+t.y*this.z-t.z*this.y,n=t.w*this.y+t.z*this.x-t.x*this.z,i=t.w*this.z+t.x*this.y-t.y*this.x,o=-t.x*this.x-t.y*this.y-t.z*this.z;this.x=r*t.w+o*-t.x+n*-t.z-i*-t.y,this.y=n*t.w+o*-t.y+i*-t.x-r*-t.z,this.z=i*t.w+o*-t.z+r*-t.y-n*-t.x},e.prototype.clone=function(){return new e(this)},$t=e,$t}var er,xn;function ut(){if(xn)return er;xn=1;function e(t){t=t||{},this.x=t.x||0,this.y=t.y||0,this.z=t.z||0,this.w=typeof t.w=="number"?t.w:1}return e.prototype.conjugate=function(){this.x*=-1,this.y*=-1,this.z*=-1},e.prototype.norm=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},e.prototype.normalize=function(){var t=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);t===0?(this.x=0,this.y=0,this.z=0,this.w=1):(t=1/t,this.x=this.x*t,this.y=this.y*t,this.z=this.z*t,this.w=this.w*t)},e.prototype.invert=function(){this.conjugate(),this.normalize()},e.prototype.multiply=function(t){var r=this.x*t.w+this.y*t.z-this.z*t.y+this.w*t.x,n=-this.x*t.z+this.y*t.w+this.z*t.x+this.w*t.y,i=this.x*t.y-this.y*t.x+this.z*t.w+this.w*t.z,o=-this.x*t.x-this.y*t.y-this.z*t.z+this.w*t.w;this.x=r,this.y=n,this.z=i,this.w=o},e.prototype.clone=function(){return new e(this)},er=e,er}var tr,Rn;function Br(){if(Rn)return tr;Rn=1;var e=Ve(),t=ut();function r(n){n=n||{},this.position=new e(n.position),this.orientation=new t(n.orientation)}return r.prototype.applyTransform=function(n){this.position.multiplyQuaternion(n.rotation),this.position.add(n.translation);var i=n.rotation.clone();i.multiply(this.orientation),this.orientation=i},r.prototype.clone=function(){return new r(this)},r.prototype.multiply=function(n){var i=n.clone();return i.applyTransform({rotation:this.orientation,translation:this.position}),i},r.prototype.getInverse=function(){var n=this.clone();return n.orientation.invert(),n.position.multiplyQuaternion(n.orientation),n.position.x*=-1,n.position.y*=-1,n.position.z*=-1,n},tr=r,tr}var rr,Pn;function Ei(){if(Pn)return rr;Pn=1;var e=Ve(),t=ut();function r(n){n=n||{},this.translation=new e(n.translation),this.rotation=new t(n.rotation)}return r.prototype.clone=function(){return new r(this)},rr=r,rr}var nr,Fn;function Ms(){return Fn||(Fn=1,nr={Pose:Br(),Quaternion:ut(),Transform:Ei(),Vector3:Ve()}),nr}var ir={exports:{}},or,kn;function Os(){if(kn)return or;kn=1;var e=bi(),t=wi(),r=Ct(),n=st(),i=at(),o=Ei();function d(c){c=c||{},this.ros=c.ros,this.fixedFrame=c.fixedFrame||"base_link",this.angularThres=c.angularThres||2,this.transThres=c.transThres||.01,this.rate=c.rate||10,this.updateDelay=c.updateDelay||50;var l=c.topicTimeout||2,f=Math.floor(l),u=Math.floor((l-f)*1e9);this.topicTimeout={secs:f,nsecs:u},this.serverName=c.serverName||"/tf2_web_republisher",this.repubServiceName=c.repubServiceName||"/republish_tfs",this.currentGoal=!1,this.currentTopic=!1,this.frameInfos={},this.republisherUpdateRequested=!1,this._subscribeCB=null,this._isDisposed=!1,this.actionClient=new e({ros:c.ros,serverName:this.serverName,actionName:"tf2_web_republisher/TFSubscriptionAction",omitStatus:!0,omitResult:!0}),this.serviceClient=new r({ros:c.ros,name:this.repubServiceName,serviceType:"tf2_web_republisher/RepublishTFs"})}return d.prototype.processTFArray=function(c){c.transforms.forEach(function(l){var f=l.child_frame_id;f[0]==="/"&&(f=f.substring(1));var u=this.frameInfos[f];u&&(u.transform=new o({translation:l.transform.translation,rotation:l.transform.rotation}),u.cbs.forEach(function(p){p(u.transform)}))},this)},d.prototype.updateGoal=function(){var c={source_frames:Object.keys(this.frameInfos),target_frame:this.fixedFrame,angular_thres:this.angularThres,trans_thres:this.transThres,rate:this.rate};if(this.ros.groovyCompatibility)this.currentGoal&&this.currentGoal.cancel(),this.currentGoal=new t({actionClient:this.actionClient,goalMessage:c}),this.currentGoal.on("feedback",this.processTFArray.bind(this)),this.currentGoal.send();else{c.timeout=this.topicTimeout;var l=new n(c);this.serviceClient.callService(l,this.processResponse.bind(this))}this.republisherUpdateRequested=!1},d.prototype.processResponse=function(c){this._isDisposed||(this.currentTopic&&this.currentTopic.unsubscribe(this._subscribeCB),this.currentTopic=new i({ros:this.ros,name:c.topic_name,messageType:"tf2_web_republisher/TFArray"}),this._subscribeCB=this.processTFArray.bind(this),this.currentTopic.subscribe(this._subscribeCB))},d.prototype.subscribe=function(c,l){c[0]==="/"&&(c=c.substring(1)),this.frameInfos[c]?this.frameInfos[c].transform&&l(this.frameInfos[c].transform):(this.frameInfos[c]={cbs:[]},this.republisherUpdateRequested||(setTimeout(this.updateGoal.bind(this),this.updateDelay),this.republisherUpdateRequested=!0)),this.frameInfos[c].cbs.push(l)},d.prototype.unsubscribe=function(c,l){c[0]==="/"&&(c=c.substring(1));for(var f=this.frameInfos[c],u=f&&f.cbs||[],p=u.length;p--;)u[p]===l&&u.splice(p,1);(!l||u.length===0)&&delete this.frameInfos[c]},d.prototype.dispose=function(){this._isDisposed=!0,this.actionClient.dispose(),this.currentTopic&&this.currentTopic.unsubscribe(this._subscribeCB)},or=d,or}var Un;function Is(){if(Un)return ir.exports;Un=1;var e=Dr(),t=Ur(),r=ir.exports={TFClient:Os()};return t(e,["TFClient"],r),ir.exports}var sr,Dn;function ct(){return Dn||(Dn=1,sr={URDF_SPHERE:0,URDF_BOX:1,URDF_CYLINDER:2,URDF_MESH:3}),sr}var ar,Bn;function Si(){if(Bn)return ar;Bn=1;var e=Ve(),t=ct();function r(n){this.dimension=null,this.type=t.URDF_BOX;var i=n.xml.getAttribute("size").split(" ");this.dimension=new e({x:parseFloat(i[0]),y:parseFloat(i[1]),z:parseFloat(i[2])})}return ar=r,ar}var ur,Gn;function Ti(){if(Gn)return ur;Gn=1;function e(t){var r=t.xml.getAttribute("rgba").split(" ");this.r=parseFloat(r[0]),this.g=parseFloat(r[1]),this.b=parseFloat(r[2]),this.a=parseFloat(r[3])}return ur=e,ur}var cr,qn;function Ci(){if(qn)return cr;qn=1;var e=ct();function t(r){this.type=e.URDF_CYLINDER,this.length=parseFloat(r.xml.getAttribute("length")),this.radius=parseFloat(r.xml.getAttribute("radius"))}return cr=t,cr}var lr,Vn;function Gr(){if(Vn)return lr;Vn=1;var e=Ti();function t(n){this.textureFilename=null,this.color=null,this.name=n.xml.getAttribute("name");var i=n.xml.getElementsByTagName("texture");i.length>0&&(this.textureFilename=i[0].getAttribute("filename"));var o=n.xml.getElementsByTagName("color");o.length>0&&(this.color=new e({xml:o[0]}))}t.prototype.isLink=function(){return this.color===null&&this.textureFilename===null};var r=Ge;return t.prototype.assign=function(n){return r(this,n)},lr=t,lr}var fr,zn;function Li(){if(zn)return fr;zn=1;var e=Ve(),t=ct();function r(n){this.scale=null,this.type=t.URDF_MESH,this.filename=n.xml.getAttribute("filename");var i=n.xml.getAttribute("scale");if(i){var o=i.split(" ");this.scale=new e({x:parseFloat(o[0]),y:parseFloat(o[1]),z:parseFloat(o[2])})}}return fr=r,fr}var hr,jn;function Mi(){if(jn)return hr;jn=1;var e=ct();function t(r){this.type=e.URDF_SPHERE,this.radius=parseFloat(r.xml.getAttribute("radius"))}return hr=t,hr}var dr,Wn;function Oi(){if(Wn)return dr;Wn=1;var e=Br(),t=Ve(),r=ut(),n=Ci(),i=Si(),o=Gr(),d=Li(),c=Mi();function l(f){var u=f.xml;this.origin=null,this.geometry=null,this.material=null,this.name=f.xml.getAttribute("name");var p=u.getElementsByTagName("origin");if(p.length===0)this.origin=new e;else{var a=p[0].getAttribute("xyz"),h=new t;a&&(a=a.split(" "),h=new t({x:parseFloat(a[0]),y:parseFloat(a[1]),z:parseFloat(a[2])}));var _=p[0].getAttribute("rpy"),L=new r;if(_){_=_.split(" ");var T=parseFloat(_[0]),O=parseFloat(_[1]),N=parseFloat(_[2]),R=T/2,q=O/2,F=N/2,j=Math.sin(R)*Math.cos(q)*Math.cos(F)-Math.cos(R)*Math.sin(q)*Math.sin(F),te=Math.cos(R)*Math.sin(q)*Math.cos(F)+Math.sin(R)*Math.cos(q)*Math.sin(F),ee=Math.cos(R)*Math.cos(q)*Math.sin(F)-Math.sin(R)*Math.sin(q)*Math.cos(F),H=Math.cos(R)*Math.cos(q)*Math.cos(F)+Math.sin(R)*Math.sin(q)*Math.sin(F);L=new r({x:j,y:te,z:ee,w:H}),L.normalize()}this.origin=new e({position:h,orientation:L})}var z=u.getElementsByTagName("geometry");if(z.length>0){for(var I=z[0],U=null,k=0;k<I.childNodes.length;k++){var G=I.childNodes[k];if(G.nodeType===1){U=G;break}}var A=U.nodeName;A==="sphere"?this.geometry=new c({xml:U}):A==="box"?this.geometry=new i({xml:U}):A==="cylinder"?this.geometry=new n({xml:U}):A==="mesh"?this.geometry=new d({xml:U}):console.warn("Unknown geometry type "+A)}var V=u.getElementsByTagName("material");V.length>0&&(this.material=new o({xml:V[0]}))}return dr=l,dr}var pr,Jn;function Ii(){if(Jn)return pr;Jn=1;var e=Oi();function t(r){this.name=r.xml.getAttribute("name"),this.visuals=[];for(var n=r.xml.getElementsByTagName("visual"),i=0;i<n.length;i++)this.visuals.push(new e({xml:n[i]}))}return pr=t,pr}var mr,Yn;function As(){if(Yn)return mr;Yn=1;var e=Br(),t=Ve(),r=ut();function n(i){this.name=i.xml.getAttribute("name"),this.type=i.xml.getAttribute("type");var o=i.xml.getElementsByTagName("parent");o.length>0&&(this.parent=o[0].getAttribute("link"));var d=i.xml.getElementsByTagName("child");d.length>0&&(this.child=d[0].getAttribute("link"));var c=i.xml.getElementsByTagName("limit");c.length>0&&(this.minval=parseFloat(c[0].getAttribute("lower")),this.maxval=parseFloat(c[0].getAttribute("upper")));var l=i.xml.getElementsByTagName("origin");if(l.length===0)this.origin=new e;else{var f=l[0].getAttribute("xyz"),u=new t;f&&(f=f.split(" "),u=new t({x:parseFloat(f[0]),y:parseFloat(f[1]),z:parseFloat(f[2])}));var p=l[0].getAttribute("rpy"),a=new r;if(p){p=p.split(" ");var h=parseFloat(p[0]),_=parseFloat(p[1]),L=parseFloat(p[2]),T=h/2,O=_/2,N=L/2,R=Math.sin(T)*Math.cos(O)*Math.cos(N)-Math.cos(T)*Math.sin(O)*Math.sin(N),q=Math.cos(T)*Math.sin(O)*Math.cos(N)+Math.sin(T)*Math.cos(O)*Math.sin(N),F=Math.cos(T)*Math.cos(O)*Math.sin(N)-Math.sin(T)*Math.sin(O)*Math.cos(N),j=Math.cos(T)*Math.cos(O)*Math.cos(N)+Math.sin(T)*Math.sin(O)*Math.sin(N);a=new r({x:R,y:q,z:F,w:j}),a.normalize()}this.origin=new e({position:u,orientation:a})}}return mr=n,mr}var tt={},Xn;function Ns(){return Xn||(Xn=1,tt.DOMImplementation=window.DOMImplementation,tt.XMLSerializer=window.XMLSerializer,tt.DOMParser=window.DOMParser),tt}var gr,Hn;function xs(){if(Hn)return gr;Hn=1;var e=Gr(),t=Ii(),r=As(),n=Ns().DOMParser;function i(o){o=o||{};var d=o.xml,c=o.string;if(this.materials={},this.links={},this.joints={},c){var l=new n;d=l.parseFromString(c,"text/xml")}var f=d.documentElement;this.name=f.getAttribute("name");for(var u=f.childNodes,p=0;p<u.length;p++){var a=u[p];if(a.tagName==="material"){var h=new e({xml:a});this.materials[h.name]!==void 0?this.materials[h.name].isLink()?this.materials[h.name].assign(h):console.warn("Material "+h.name+"is not unique."):this.materials[h.name]=h}else if(a.tagName==="link"){var _=new t({xml:a});if(this.links[_.name]!==void 0)console.warn("Link "+_.name+" is not unique.");else{for(var L=0;L<_.visuals.length;L++){var T=_.visuals[L].material;T!==null&&T.name&&(this.materials[T.name]!==void 0?_.visuals[L].material=this.materials[T.name]:this.materials[T.name]=T)}this.links[_.name]=_}}else if(a.tagName==="joint"){var O=new r({xml:a});this.joints[O.name]=O}}}return gr=i,gr}var vr,Zn;function Rs(){return Zn||(Zn=1,vr=Ge({UrdfBox:Si(),UrdfColor:Ti(),UrdfCylinder:Ci(),UrdfLink:Ii(),UrdfMaterial:Gr(),UrdfMesh:Li(),UrdfModel:xs(),UrdfSphere:Mi(),UrdfVisual:Oi()},ct())),vr}var He=ei.ROSLIB||{REVISION:"1.4.1"},lt=Ge;lt(He,Ss());lt(He,Ls());lt(He,Ms());lt(He,Is());lt(He,Rs());var Ps=He;const yr=Mr(Ps);class Fs{constructor(t,r){Wr(this,"ros");let n=`ws://${t}:${r}`;this.ros=new yr.Ros({url:n})}createPublisher(t,r){return new yr.Topic({ros:this.ros,name:t,messageType:r})}createSubscriber(t,r,n){const i=new yr.Topic({ros:this.ros,name:t,messageType:r});return i.subscribe(n),i}disconnect(){this.ros.close()}}var ks=rt("<!> <!> <!>",1),Us=rt(`<div class="overflow-hidden h-full w-full"><div class="flex flex-col h-full w-full"><div class="grow"><!></div></div> <button class="rounded-input bg-dark text-background shadow-mini hover:bg-dark/95 inline-flex
    h-12 items-center justify-center px-[21px] text-[15px]
    font-semibold active:scale-[0.98] active:transition-all relative left-[80%] bottom-[100px]"><!></button> <div class="absolute mx-auto top-0 left-0 w-[100vw] flex flex-row justify-center pt-2"><div class="rounded-input bg-background text-dark shadow-mini hover:bg-dark/95 inline-flex
        h-12 items-center justify-center px-[21px] text-sm opacity-70
        font-semibold active:scale-[0.98] active:transition-all w-[75%]"> </div></div></div>`);function Qs(e,t){Pe(t,!0);let r=be(void 0),n=be("Idle"),i=be(ce([-79.94119494375119,40.439986846804885])),o=[[40.44014339030923,-79.94124065145725],[40.44006511860286,-79.94122636779917],[40.439986846804885,-79.94119494375119],[40.43991074913629,-79.9412435081891],[40.4398389998274,-79.94115780624013]],d;function c(){let F=new Tt({displayControlsDefault:!1,controls:{line_string:!0,trash:!0}});const j=F.onAdd.bind(F);return F.onAdd=te=>{let ee=j(te);return ee.classList.add("maplibregl-ctrl-group"),ee.classList.add("maplibregl-ctrl"),ee},F}function l(){console.log("Publishing waypoints");let F=JSON.stringify(o);console.log(F),d==null||d.publish({data:JSON.stringify(o)})}let f=be(ce([]));Wi(()=>{const F=new Fs("172.26.179.119",9090);return d=F.createPublisher("/waypoints_string","std_msgs/String"),F.createSubscriber("/diagnostics","diagnostic_msgs/DiagnosticStatus",j=>{j.name=="trajectory_planner"&&(console.log(j),pe(n,ce(j.message)))}),F.createSubscriber("/gnss/fix","sensor_msgs/NavSatFix",j=>{console.log(j),pe(i,ce([j.longitude,j.latitude]))}),o.forEach(j=>{pe(f,ce([...M(f),{lngLat:{lat:j[0],lng:j[1]}}]))}),()=>{F.disconnect()}});let u=c();he(()=>{var F,j;M(r).addControl(u),(F=M(r))==null||F.on("click",te=>{p(te),console.log("["),M(f).forEach(ee=>{console.log(`[${ee.lngLat.lat}, ${ee.lngLat.lng}]`)}),console.log("]"),console.log(M(f))}),(j=M(r))==null||j.on("touchend",te=>{u.getAll().features.forEach(ee=>{console.log(ee)})})});function p(F){console.log(F),pe(f,ce([...M(f),{lngLat:F.lngLat}]))}var a=Us(),h=Ue(a),_=Ue(h),L=Ue(_);So(L,{center:[-79.94119494375119,40.439986846804885],zoom:19,class:"map",standardControls:!0,style:"https://api.maptiler.com/maps/outdoor-v2/style.json?key=WYBGJJDhMhxLW8Icu2a0",get map(){return M(r)},set map(F){pe(r,ce(F))},children:(F,j)=>{var te=ks(),ee=ze(te);uo(ee,{onclick:p});var H=Ae(ee,2);Ui(H,17,()=>M(f),Bi,(I,U)=>{oo(I,{get lngLat(){return M(U).lngLat}})});var z=Ae(H,2);Qi(z,{get lngLat(){return M(i)},class:"grid h-8 w-8 place-items-center rounded-full border border-gray-200 bg-amber-300 text-black shadow-2xl focus:outline-2 focus:outline-black",children:(I,U)=>{Di(I,{})},$$slots:{default:!0}}),xe(F,te)},$$slots:{default:!0}}),De(_),De(h);var T=Ae(h,2);T.__click=l;var O=Ue(T);no(O,{}),De(T);var N=Ae(T,2),R=Ue(N),q=Ue(R,!0);De(R),De(N),De(a),Kn(()=>Pi(q,M(n))),xe(e,a),Fe()}qi(["click"]);export{Qs as component};

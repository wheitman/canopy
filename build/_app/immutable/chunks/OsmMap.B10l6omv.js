const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./leaflet-src.gPfWyBzh.js","./_commonjsHelpers.BosuxZz1.js"])))=>i.map(i=>d[i]);
import{_ as x}from"./preload-helper.C1FmrZbK.js";import{s as H,e as K,c as Q,b as X,f as C,l as D,i as $,n as k,m as ee,o as te}from"./scheduler.Dej_xGUE.js";import{S as ne,i as oe}from"./index.LdiSmlfv.js";import{s as ae,e as se,a as re,b as A,w as ie}from"./stores.C8XAdwxS.js";import"./OsmMap.svelte_svelte_type_style_lang.C77KIKrc.js";import{b as z}from"./paths.i9bIx48T.js";function le(m){let o;return{c(){o=K("div"),this.h()},l(s){o=Q(s,"DIV",{id:!0,class:!0}),X(o).forEach(C),this.h()},h(){D(o,"id","map"),D(o,"class","z-0 svelte-140f54t")},m(s,f){$(s,o,f)},p:k,i:k,o:k,d(s){s&&C(o)}}}function ce(m,o,s){const f=ee();let i,{useCurrentPos:h=!1}=o,a,b,p,c,d,g,t,_,E,M=!1,{seedlings:y=[]}=o,v=!1,u=[],w=[],{selected_action:l=1}=o,{draw:L=!1}=o,{hide_seedlings:P=!1}=o;function N(){v=!0}function O(){w.forEach(e=>{e.remove(),console.log(`Removing ${e} from map.`)}),w=[]}async function R(e,n){if(P){console.log("Seedlings hidden");return}var r=t.marker([e[0],e[1]],{icon:new E({iconUrl:`${z}/res/leaves/${n.icon}.svg`})}).addTo(a);M&&r.bindPopup(`<strong>${n.common}</strong><br/><i>${n.scientific}</i>`),w.push(r)}ae.subscribe(e=>{console.log("Seedling reached!"),e!=!1&&addReachedSeedlingMarker()}),se.subscribe(e=>{if(d=e,!(t==null||!g))if(!c)c=t.marker([d,g],{icon:p}).addTo(a);else{var n=new t.LatLng(d,g);c.setLatLng(n)}}),re.subscribe(e=>{if(g=e,!(t==null||!d))if(!c)c=t.marker([d,g],{icon:p}).addTo(a);else{var n=new t.LatLng(d,g);c.setLatLng(n)}}),A.subscribe(e=>{if(t==null||!A)return;let n=document.getElementById("ego-icon");if(!n)return;let r=-e+Math.PI/2;n.style.transform=`rotate(${r}rad)`});function G(e){console.log(`Setting to ${e}`),i?i.setData(e):console.log("CONTROL NOT READY")}function V(e){if(v){var n=t.marker(e.latlng,{icon:b}).addTo(a),r=u.pop();r!=null&&r.removeFrom(a),u.push(n),v=!1,console.log(`There are now ${u.length} waypoints on the map.`);let S=[];u.forEach(B=>{let I=B.getLatLng();S.push([I.lat,I.lng])}),console.log(S),ie.set(S)}}function F(e){(l==0||l==3)&&f("geomchanged")}te(async()=>{t=await x(()=>import("./leaflet-src.gPfWyBzh.js").then(e=>e.l),__vite__mapDeps([0,1]),import.meta.url),await x(()=>import("./leaflet.draw.cJkf-kdY.js"),[],import.meta.url),await x(()=>import("./Leaflet.PaintPolygon.BL41ABOh.js"),[],import.meta.url),M=!0,E=t.Icon.extend({options:{iconUrl:`${z}/res/leaves/silver_maple.svg`,iconSize:[24,24],iconAnchor:[12,12],shadowSize:[50,64],shadowAnchor:[4,62],popupAnchor:[0,0]}}),h?a=t.map("map",{zoomControl:!1}).locate({setView:!0,maxZoom:19}):a=t.map("map",{zoomControl:!1}).setView([40.44002092,-79.9409749],19),_=t.popup(),b=t.divIcon({html:`<span class="material-symbols-outlined">
flag
</span>`,className:"div-icon"}),p=t.divIcon({html:`<div class="icon-container flex justify-center" id="ego-icon">
  <span
    class="material-symbols-rounded my-auto"
    style="--icon-color: #ff0000; --size: 1rem; --fill: 1"
  >
    navigation
  </span>
</div>`,className:"div-icon"}),t.divIcon({html:`<div class="icon-container flex justify-center" id="seedling-icon" style="">
  <span
    class="material-symbols-rounded my-auto"
    style="--icon-color: #ff0000; --size: 1rem; --fill: 1"
  >
    check
  </span>
</div>`,className:"div-icon",iconAnchor:[0,20]}),t.tileLayer("https://tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:20,attribution:'&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'}).addTo(a),i=t.control.paintPolygon({menu:!1}).addTo(a),a.on("click",V),a.on("mouseup",F),L&&T()});function J(){return i.getData()}function W(){return y}function T(){s(0,l=0),i.startDraw()}function Y(){s(0,l=3),i.startErase()}function j(){s(0,l=1),i.stop()}function U(){i.eraseAll(),O()}function Z(e){let n=t.latLng(e[0],e[1]);_.setLatLng(n).setContent("You clicked the map at "+n.toString()).openOn(a),t.marker(n).addTo(a),console.log(`Adding point at ${e[0]}, ${e[1]}`)}function q(e){e.forEach(n=>{let r=t.latLng(n[0],n[1]);_.setLatLng(r).setContent("You clicked the map at "+r.toString()).openOn(a),t.marker(r).addTo(a),console.log(`Adding point at ${n[0]}, ${n[1]}`)})}return m.$$set=e=>{"useCurrentPos"in e&&s(1,h=e.useCurrentPos),"seedlings"in e&&s(2,y=e.seedlings),"selected_action"in e&&s(0,l=e.selected_action),"draw"in e&&s(3,L=e.draw),"hide_seedlings"in e&&s(4,P=e.hide_seedlings)},[l,h,y,L,P,N,O,R,G,J,W,T,Y,j,U,Z,q]}class pe extends ne{constructor(o){super(),oe(this,o,ce,le,H,{useCurrentPos:1,seedlings:2,selected_action:0,draw:3,hide_seedlings:4,listenForWaypoint:5,clearSeedlingMarkers:6,addSeedlingMarker:7,setGeometry:8,getGeoJSON:9,getPlanSeedlings:10,startDraw:11,startErase:12,startPan:13,clear:14,addPoint:15,addPoints:16},null,[-1,-1])}get listenForWaypoint(){return this.$$.ctx[5]}get clearSeedlingMarkers(){return this.$$.ctx[6]}get addSeedlingMarker(){return this.$$.ctx[7]}get setGeometry(){return this.$$.ctx[8]}get getGeoJSON(){return this.$$.ctx[9]}get getPlanSeedlings(){return this.$$.ctx[10]}get startDraw(){return this.$$.ctx[11]}get startErase(){return this.$$.ctx[12]}get startPan(){return this.$$.ctx[13]}get clear(){return this.$$.ctx[14]}get addPoint(){return this.$$.ctx[15]}get addPoints(){return this.$$.ctx[16]}}export{pe as O};
